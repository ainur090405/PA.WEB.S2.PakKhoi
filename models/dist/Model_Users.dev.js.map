{"version":3,"sources":["Model_Users.js"],"names":["connection","require","bcrypt","Model_Users","Promise","resolve","reject","query","err","rows","Data","result","email","id","id_user","token","expiresDate","plainPassword","hash","module","exports"],"mappings":"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","sourcesContent":["// models/Model_Users.js\r\nconst connection = require('../config/database');\r\nconst bcrypt = require('bcryptjs'); // untuk hash password\r\n\r\nclass Model_Users {\r\n\r\n  // =========================\r\n  // FUNGSI EXISTING (TIDAK DIUBAH)\r\n  // =========================\r\n  static async getAll(){\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'SELECT * FROM users ORDER BY id_user DESC',\r\n        (err, rows) => {\r\n          if (err) reject(err); else resolve(rows);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  static async Store(Data){\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'INSERT INTO users SET ?',\r\n        Data,\r\n        (err, result) => {\r\n          if (err) reject(err); else resolve(result);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  static async getByEmail(email){\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'SELECT * FROM users WHERE email = ?',\r\n        [email],\r\n        (err, result) => {\r\n          if (err) reject(err); else resolve(result); // array\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  static async getById(id){\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'SELECT * FROM users WHERE id_user = ?',\r\n        [id],\r\n        (err, result) => {\r\n          if (err) reject(err); else resolve(result);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  static async Update(id, Data){\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'UPDATE users SET ? WHERE id_user = ?',\r\n        [Data, id],\r\n        (err, result) => {\r\n          if (err) reject(err); else resolve(result);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  static async Delete(id){\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'DELETE FROM users WHERE id_user = ?',\r\n        [id],\r\n        (err, result) => {\r\n          if (err) reject(err); else resolve(result);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  // =========================\r\n  // TAMBAHAN UNTUK LUPA PASSWORD\r\n  // =========================\r\n\r\n  // Versi yang langsung balikin 1 user (bukan array)\r\n  static async findOneByEmail(email) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'SELECT * FROM users WHERE email = ? LIMIT 1',\r\n        [email],\r\n        (err, rows) => {\r\n          if (err) return reject(err);\r\n          resolve(rows[0] || null);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  // Simpan token reset + waktu expired ke user\r\n  static async setResetToken(id_user, token, expiresDate) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'UPDATE users SET reset_token = ?, reset_token_expires = ? WHERE id_user = ?',\r\n        [token, expiresDate, id_user],\r\n        (err, result) => {\r\n          if (err) reject(err); else resolve(result);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  // Cari user berdasarkan token reset yang masih berlaku\r\n  static async findByResetToken(token) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        `\r\n          SELECT * FROM users\r\n          WHERE reset_token = ?\r\n            AND reset_token_expires IS NOT NULL\r\n            AND reset_token_expires > NOW()\r\n          LIMIT 1\r\n        `,\r\n        [token],\r\n        (err, rows) => {\r\n          if (err) return reject(err);\r\n          resolve(rows[0] || null);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  // Hapus token reset setelah dipakai / kadaluarsa\r\n  static async clearResetToken(id_user) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'UPDATE users SET reset_token = NULL, reset_token_expires = NULL WHERE id_user = ?',\r\n        [id_user],\r\n        (err, result) => {\r\n          if (err) reject(err); else resolve(result);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  // Update password (plain â†’ hash bcrypt) untuk lupa password\r\n  static async updatePassword(id_user, plainPassword) {\r\n    const hash = await bcrypt.hash(plainPassword, 10);\r\n\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'UPDATE users SET password = ? WHERE id_user = ?',\r\n        [hash, id_user],\r\n        (err, result) => {\r\n          if (err) reject(err); else resolve(result);\r\n        }\r\n      );\r\n    });\r\n  }\r\n}\r\n\r\nmodule.exports = Model_Users;\r\n"],"file":"Model_Users.dev.js"}