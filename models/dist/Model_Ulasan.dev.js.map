{"version":3,"sources":["Model_Ulasan.js"],"names":["connection","require","Model_Ulasan","id_user","Promise","resolve","reject","sql","query","err","rows","id","id_reservasi","Data","result","id_arena","module","exports"],"mappings":"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","sourcesContent":["// models/Model_Ulasan.js\r\nconst connection = require('../config/database');\r\n\r\nclass Model_Ulasan {\r\n\r\n  static async getByUser(id_user) {\r\n    return new Promise((resolve, reject) => {\r\n      const sql = `\r\n        SELECT u.rating, u.komentar, u.tanggal_ulasan, a.nama_arena\r\n        FROM ulasan u\r\n        JOIN reservasi r ON u.id_reservasi = r.id_reservasi\r\n        JOIN arena a ON r.id_arena = a.id_arena\r\n        WHERE u.id_user = ?\r\n        ORDER BY u.tanggal_ulasan DESC\r\n      `;\r\n      connection.query(sql, [id_user], (err, rows) => {\r\n        if (err) reject(err);\r\n        else resolve(rows);\r\n      });\r\n    });\r\n  }\r\n\r\n  static async getAll() {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query('SELECT * FROM ulasan', (err, rows) => {\r\n        if (err) reject(err);\r\n        else resolve(rows);\r\n      });\r\n    });\r\n  }\r\n\r\n  static async getById(id) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query('SELECT * FROM ulasan WHERE id_ulasan = ?', [id], (err, rows) => {\r\n        if (err) reject(err);\r\n        else resolve(rows);\r\n      });\r\n    });\r\n  }\r\n\r\n  // âœ… tambahan fix: get ulasan berdasarkan id_reservasi\r\n  static async getByReservasi(id_reservasi) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query('SELECT * FROM ulasan WHERE id_reservasi = ?', [id_reservasi], (err, rows) => {\r\n        if (err) reject(err);\r\n        else resolve(rows);\r\n      });\r\n    });\r\n  }\r\n\r\n  static async Store(Data) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query('INSERT INTO ulasan SET ?', Data, (err, result) => {\r\n        if (err) reject(err);\r\n        else resolve(result);\r\n      });\r\n    });\r\n  }\r\n\r\n  static async Update(id_reservasi, Data) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query('UPDATE ulasan SET ? WHERE id_reservasi = ?', [Data, id_reservasi], (err, result) => {\r\n        if (err) reject(err);\r\n        else resolve(result);\r\n      });\r\n    });\r\n  }\r\n\r\n  static async Delete(id_reservasi) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query('DELETE FROM ulasan WHERE id_reservasi = ?', [id_reservasi], (err, result) => {\r\n        if (err) reject(err);\r\n        else resolve(result);\r\n      });\r\n    });\r\n  }\r\n\r\n  static async getByArena(id_arena) {\r\n    return new Promise((resolve, reject) => {\r\n      const sql = `\r\n        SELECT u.rating, u.komentar, u.tanggal_ulasan, usr.nama as nama_user\r\n        FROM ulasan u\r\n        JOIN reservasi r ON u.id_reservasi = r.id_reservasi\r\n        JOIN users usr ON u.id_user = usr.id_user\r\n        WHERE r.id_arena = ?\r\n        ORDER BY u.tanggal_ulasan DESC\r\n      `;\r\n      connection.query(sql, [id_arena], (err, rows) => {\r\n        if (err) reject(err);\r\n        else resolve(rows);\r\n      });\r\n    });\r\n  }\r\nstatic async UpdateByReservasi(id_reservasi, Data) {\r\n  return new Promise((resolve, reject) => {\r\n    const sql = 'UPDATE ulasan SET ? WHERE id_reservasi = ?';\r\n    connection.query(sql, [Data, id_reservasi], (err, result) => {\r\n      if (err) reject(err);\r\n      else resolve(result);\r\n    });\r\n  });\r\n}\r\n\r\n  static async getAverageRating(id_arena) {\r\n    return new Promise((resolve, reject) => {\r\n      const sql = `\r\n        SELECT AVG(u.rating) as avg_rating, COUNT(u.id_ulasan) as total_reviews\r\n        FROM ulasan u\r\n        JOIN reservasi r ON u.id_reservasi = r.id_reservasi\r\n        WHERE r.id_arena = ?\r\n      `;\r\n      connection.query(sql, [id_arena], (err, rows) => {\r\n        if (err) reject(err);\r\n        else resolve(rows[0]);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nmodule.exports = Model_Ulasan;\r\n"],"file":"Model_Ulasan.dev.js"}