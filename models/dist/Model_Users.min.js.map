{"version":3,"sources":["Model_Users.js"],"names":["connection","require","bcrypt","Model_Users","Promise","resolve","reject","err","rows","Data","query","result","email","id","id_user","token","expiresDate","plainPassword","hash","module","exports"],"mappings":"mZACA,IAAMA,WAAaC,QAAQ,sBACrBC,OAASD,QAAQ,YAEjBE,gOAMK,IAAIC,QAAQ,SAACC,EAASC,GAR3BJ,WAASD,MAUP,4CACA,SAACM,EAAKC,GATRL,EAUaG,EAAOC,GAAWF,EAAQG,0EAMxBC,4GACV,IAAIL,QAAQ,SAACC,EAASC,GAC3BN,WAAWU,MAhBf,0BACAD,EACA,SAAAF,EAAAI,GAkBYJ,EAAKD,EAAOC,GAAWF,EAAQM,+EAf7BC,4GAGN,IAAAR,QAAIG,SAAAA,EAAWD,GAChBN,WAJHU,MAMD,sCAmBG,CAACE,GACD,SAACL,EAAKI,GACAJ,EAAKD,EAAOC,GAAWF,EAAQM,4EAMtBE,4GACZ,IAAIT,QAAQ,SAACC,EAASC,GAC3BN,WAAWU,MACT,wCACA,CAACG,GACD,SAACN,EAAKI,GACAJ,EAAKD,EAAOC,GAAWF,EAAQM,2EAMvBE,EAAIJ,4GACf,IAAIL,QAAQ,SAACC,EAASC,GAC3BN,WAAWU,MACT,uCACA,CAACD,EAAMI,GACP,SAACN,EAAKI,GACAJ,EAAKD,EAAOC,GAAWF,EAAQM,2EAMvBE,4GACX,IAAIT,QAAQ,SAACC,EAASC,GAC3BN,WAAWU,MACT,sCArCFV,CAAAA,GAII,SAAAO,EAAAI,GACDJ,EALHD,EAAAC,GAAAF,EAAAM,mFAmDwBC,4GACnB,IAAIR,QAAQ,SAACC,EAASC,GAC3BN,WAAWU,MACT,8CACA,CAACE,GACD,SAACL,EAAKC,GACJ,GAAID,EAAK,OAAOD,EAAOC,GA7C3BP,EAAAA,EAAAA,IAAWU,qFAqDYI,EAASC,EAAOC,4GAClC,IAAIZ,QAAQ,SAACC,EAASC,GAC3BN,WAAWU,MACT,8EACA,CAACK,EAAOC,EAAaF,GACrB,SAACP,EAAKI,GACAJ,EAAKD,EAAOC,GAAWF,EAAQM,qFA/CvCI,4GAII,IAAAX,QAAIG,SAAAA,EAAWD,GAChBN,WALHU,MAKG,8LA2DD,CAACK,GACD,SAACR,EAAKC,GACJ,GAAID,EAAK,OAAOD,EAAOC,GACvBF,EAAQG,EAAK,IAAM,uFAvDZE,4GAIP,IAAAN,QAAIG,SAAAA,EAAWD,GAChBN,WALHU,MAOD,oFA2DG,CAACI,GACD,SAACP,EAAKI,GACAJ,EAAKD,EAAOC,GAAWF,EAAQM,mFAxD3CG,EAAAG,kIAEAf,OAAAgB,KAAAD,EAAA,mBAAAC,2BAgES,IAAId,QAAQ,SAACC,EAASC,GAC3BN,WAAWU,MACT,kDACA,CAACQ,EAAMJ,GACP,SAACP,EAAKI,GACAJ,EAAKD,EAAOC,GAAWF,EAAQM,qDA1DxCQ,OAAAC,QAiEYjB","file":"Model_Users.min.js","sourcesContent":["// models/Model_Users.js\r\nconst connection = require('../config/database');\r\nconst bcrypt = require('bcryptjs'); // untuk hash password\r\n\r\nclass Model_Users {\r\n\r\n  // =========================\r\n  // FUNGSI EXISTING (TIDAK DIUBAH)\r\n  // =========================\r\n  static async getAll(){\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'SELECT * FROM users ORDER BY id_user DESC',\r\n        (err, rows) => {\r\n          if (err) reject(err); else resolve(rows);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  static async Store(Data){\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'INSERT INTO users SET ?',\r\n        Data,\r\n        (err, result) => {\r\n          if (err) reject(err); else resolve(result);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  static async getByEmail(email){\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'SELECT * FROM users WHERE email = ?',\r\n        [email],\r\n        (err, result) => {\r\n          if (err) reject(err); else resolve(result); // array\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  static async getById(id){\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'SELECT * FROM users WHERE id_user = ?',\r\n        [id],\r\n        (err, result) => {\r\n          if (err) reject(err); else resolve(result);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  static async Update(id, Data){\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'UPDATE users SET ? WHERE id_user = ?',\r\n        [Data, id],\r\n        (err, result) => {\r\n          if (err) reject(err); else resolve(result);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  static async Delete(id){\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'DELETE FROM users WHERE id_user = ?',\r\n        [id],\r\n        (err, result) => {\r\n          if (err) reject(err); else resolve(result);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  // =========================\r\n  // TAMBAHAN UNTUK LUPA PASSWORD\r\n  // =========================\r\n\r\n  // Versi yang langsung balikin 1 user (bukan array)\r\n  static async findOneByEmail(email) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'SELECT * FROM users WHERE email = ? LIMIT 1',\r\n        [email],\r\n        (err, rows) => {\r\n          if (err) return reject(err);\r\n          resolve(rows[0] || null);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  // Simpan token reset + waktu expired ke user\r\n  static async setResetToken(id_user, token, expiresDate) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'UPDATE users SET reset_token = ?, reset_token_expires = ? WHERE id_user = ?',\r\n        [token, expiresDate, id_user],\r\n        (err, result) => {\r\n          if (err) reject(err); else resolve(result);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  // Cari user berdasarkan token reset yang masih berlaku\r\n  static async findByResetToken(token) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        `\r\n          SELECT * FROM users\r\n          WHERE reset_token = ?\r\n            AND reset_token_expires IS NOT NULL\r\n            AND reset_token_expires > NOW()\r\n          LIMIT 1\r\n        `,\r\n        [token],\r\n        (err, rows) => {\r\n          if (err) return reject(err);\r\n          resolve(rows[0] || null);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  // Hapus token reset setelah dipakai / kadaluarsa\r\n  static async clearResetToken(id_user) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'UPDATE users SET reset_token = NULL, reset_token_expires = NULL WHERE id_user = ?',\r\n        [id_user],\r\n        (err, result) => {\r\n          if (err) reject(err); else resolve(result);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  // Update password (plain â†’ hash bcrypt) untuk lupa password\r\n  static async updatePassword(id_user, plainPassword) {\r\n    const hash = await bcrypt.hash(plainPassword, 10);\r\n\r\n    return new Promise((resolve, reject) => {\r\n      connection.query(\r\n        'UPDATE users SET password = ? WHERE id_user = ?',\r\n        [hash, id_user],\r\n        (err, result) => {\r\n          if (err) reject(err); else resolve(result);\r\n        }\r\n      );\r\n    });\r\n  }\r\n}\r\n\r\nmodule.exports = Model_Users;\r\n"]}