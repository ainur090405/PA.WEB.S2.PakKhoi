"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var r=0;r<n.length;r++){var a=n[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,n,r){return n&&_defineProperties(e.prototype,n),r&&_defineProperties(e,r),e}var connection=require("../config/database"),Model_Pembayaran=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getAllWithUserArena",value:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(r,a){connection.query("\n        SELECT \n          p.*,\n          r.status AS status_reservasi,\n          u.nama AS nama_user,\n          a.nama_arena\n        FROM pembayaran p\n        JOIN reservasi r ON p.id_reservasi = r.id_reservasi\n        JOIN users u ON r.id_user = u.id_user\n        JOIN arena a ON r.id_arena = a.id_arena\n        ORDER BY p.tanggal_pembayaran DESC\n      ",function(e,n){if(e)return a(e);r(n)})}));case 1:case"end":return e.stop()}})}},{key:"getById",value:function(n){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(r,a){connection.query("SELECT * FROM pembayaran WHERE id_pembayaran = ?",[n],function(e,n){if(e)return a(e);r(n)})}));case 1:case"end":return e.stop()}})}},{key:"getByReservasi",value:function(n){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(r,a){connection.query("SELECT * FROM pembayaran WHERE id_reservasi = ? LIMIT 1",[n],function(e,n){if(e)return a(e);r(n)})}));case 1:case"end":return e.stop()}})}},{key:"Store",value:function(n){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(r,a){connection.query("INSERT INTO pembayaran SET ?",n,function(e,n){if(e)return a(e);r(n)})}));case 1:case"end":return e.stop()}})}},{key:"Update",value:function(n,t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(r,a){connection.query("UPDATE pembayaran SET ? WHERE id_pembayaran = ?",[t,n],function(e,n){if(e)return a(e);r(n)})}));case 1:case"end":return e.stop()}})}},{key:"Delete",value:function(n){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(r,a){connection.query("DELETE FROM pembayaran WHERE id_pembayaran = ?",[n],function(e,n){if(e)return a(e);r(n)})}));case 1:case"end":return e.stop()}})}},{key:"createCODByReservasi",value:function(n,r){var a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return a={id_reservasi:n,metode_pembayaran:"cod",status_pembayaran:"unpaid",jumlah:r,status_bukti:"pending",konfirmasi_admin:!1,tanggal_pembayaran:new Date,created_at:new Date,updated_at:new Date},e.abrupt("return",this.Store(a));case 2:case"end":return e.stop()}},null,this)}},{key:"uploadBuktiByReservasi",value:function(u,i){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(a,t){var e={bukti_pembayaran:i,status_bukti:"uploaded",status_pembayaran:"pending",tanggal_pembayaran:new Date,konfirmasi_admin:!1,updated_at:new Date};connection.query("UPDATE pembayaran SET ? WHERE id_reservasi = ?",[e,u],function(e,n){if(e)return t(e);if(0===n.affectedRows){var r={id_reservasi:u,metode_pembayaran:"transaksi",status_pembayaran:"pending",status_bukti:"uploaded",bukti_pembayaran:i,jumlah:0,konfirmasi_admin:!1,tanggal_pembayaran:new Date,created_at:new Date,updated_at:new Date};connection.query("INSERT INTO pembayaran SET ?",r,function(e,n){if(e)return t(e);a(n)})}else a(n)})}));case 1:case"end":return e.stop()}})}},{key:"confirmPaymentByReservasi",value:function(n,t){var u,r=arguments;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return u=2<r.length&&void 0!==r[2]?r[2]:null,e.abrupt("return",new Promise(function(r,a){var e={status_pembayaran:t,status_bukti:"confirmed"===t||"paid"===t?"uploaded":void 0,konfirmasi_admin:!0,catatan_admin:u,updated_at:new Date};connection.query("UPDATE pembayaran SET ? WHERE id_reservasi = ?",[e,n],function(e,n){if(e)return a(e);r(n)})}));case 2:case"end":return e.stop()}})}},{key:"getPendingPayments",value:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(r,a){connection.query("\n        SELECT \n          p.*,\n          r.status AS status_reservasi,\n          u.nama AS nama_user,\n          a.nama_arena\n        FROM pembayaran p\n        JOIN reservasi r ON p.id_reservasi = r.id_reservasi\n        JOIN users u ON r.id_user = u.id_user\n        JOIN arena a ON r.id_arena = a.id_arena\n        WHERE p.status_pembayaran = 'pending'\n        ORDER BY p.tanggal_pembayaran ASC\n      ",function(e,n){if(e)return a(e);r(n)})}));case 1:case"end":return e.stop()}})}}]),e}();module.exports=Model_Pembayaran;
//# sourceMappingURL=Model_Pembayaran.min.js.map
