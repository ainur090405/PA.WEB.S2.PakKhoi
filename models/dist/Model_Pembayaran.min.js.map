{"version":3,"sources":["Model_Pembayaran.js"],"names":["connection","require","Model_Pembayaran","Promise","resolve","reject","query","err","rows","id","sql","id_reservasi","Data","result","data","status_pembayaran","status","konfirmasi_admin","catatan_admin","id_pembayaran","module","exports"],"mappings":"mZAAA,IAAMA,WAAaC,QAAQ,sBAErBC,qOAGK,IAAIC,QAAQ,SAACC,EAASC,GAS3BL,WAAWM,MARF,6TAQa,SAACC,EAAKC,GACtBD,EAAKF,EAAOE,GACXH,EAAQI,4EAKEC,4GACZ,IAAIN,QAAQ,SAACC,EAASC,GAC3BL,WAAWM,MAAM,mDAAoD,CAACG,GAAK,SAACF,EAAKC,GAC3ED,EAAKF,EAAOE,GAlBlBH,EAAMM,mFAwBkBC,4GACnB,IAAIR,QAAQ,SAACC,EAASC,GAC3BL,WAAWM,MAAM,kDAAmD,CAACK,GAAe,SAACJ,EAAKC,GACpFD,EAAKF,EAAOE,GACXH,EAAQI,0EAKAI,4GACV,IAAIT,QAAQ,SAACC,EAASC,GAC3BL,WAAWM,MAAM,+BAAgCM,EAAM,SAACL,EAAKM,GACvDN,EAAKF,EAAOE,GACXH,EAAQS,2EApBfJ,EAAAG,4GAID,IALMT,QA2BY,SAACC,EAASC,GAC3BL,WAAWM,MAAM,kDAAmD,CAACM,EAAMH,GAAK,SAACF,EAAKM,GAChFN,EAAKF,EAAOE,GACXH,EAAQS,2EAKCJ,4GACX,IAAIN,QAAQ,SAACC,EAASC,GAC3BL,WAAWM,MAAM,iDAAkD,CAACG,GAAK,SAACF,EAAKM,GACzEN,EAAKF,EAAOE,GACXH,EAAQS,mFA5BJR,EACJD,4GAAQI,iCAAR,uBACN,IAAAL,QAHD,SAAAC,EAAAC,GAID,IAAAS,EAiCc,CACXC,kBAAmBC,EACnBC,kBAAkB,EAClBC,cAAeA,GAEjBlB,WAAWM,MAAM,kDAAmD,CAACQ,EAAMK,GAAgB,SAACZ,EAAKM,GAC3FN,EAAKF,EAAOE,GACXH,EAAQS,kMAOV,IAAIV,QAAQ,SAACC,EAASC,GAU3BL,WAAWM,MATF,0YASa,SAACC,EAAKC,GACtBD,EAAKF,EAAOE,GACXH,EAAQI,qDAMrBY,OAAOC,QAAUnB","file":"Model_Pembayaran.min.js","sourcesContent":["const connection = require('../config/database');\r\n\r\nclass Model_Pembayaran {\r\n\r\n  static async getAll() {\r\n    return new Promise((resolve, reject) => {\r\n      const sql = `\r\n        SELECT p.*, r.id_user, r.id_arena, a.nama_arena, u.nama as nama_user\r\n        FROM pembayaran p\r\n        JOIN reservasi r ON p.id_reservasi = r.id_reservasi\r\n        JOIN arena a ON r.id_arena = a.id_arena\r\n        JOIN users u ON r.id_user = u.id_user\r\n        ORDER BY p.tanggal_pembayaran DESC\r\n      `;\r\n      connection.query(sql, (err, rows) => {\r\n        if (err) reject(err);\r\n        else resolve(rows);\r\n      });\r\n    });\r\n  }\r\n\r\n  static async getById(id) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query('SELECT * FROM pembayaran WHERE id_pembayaran = ?', [id], (err, rows) => {\r\n        if (err) reject(err);\r\n        else resolve(rows);\r\n      });\r\n    });\r\n  }\r\n\r\n  static async getByReservasi(id_reservasi) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query('SELECT * FROM pembayaran WHERE id_reservasi = ?', [id_reservasi], (err, rows) => {\r\n        if (err) reject(err);\r\n        else resolve(rows);\r\n      });\r\n    });\r\n  }\r\n\r\n  static async Store(Data) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query('INSERT INTO pembayaran SET ?', Data, (err, result) => {\r\n        if (err) reject(err);\r\n        else resolve(result);\r\n      });\r\n    });\r\n  }\r\n\r\n  static async Update(id, Data) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query('UPDATE pembayaran SET ? WHERE id_pembayaran = ?', [Data, id], (err, result) => {\r\n        if (err) reject(err);\r\n        else resolve(result);\r\n      });\r\n    });\r\n  }\r\n\r\n  static async Delete(id) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query('DELETE FROM pembayaran WHERE id_pembayaran = ?', [id], (err, result) => {\r\n        if (err) reject(err);\r\n        else resolve(result);\r\n      });\r\n    });\r\n  }\r\n\r\n  // Confirm payment by admin\r\n  static async confirmPayment(id_pembayaran, status, catatan_admin = null) {\r\n    return new Promise((resolve, reject) => {\r\n      const data = {\r\n        status_pembayaran: status,\r\n        konfirmasi_admin: true,\r\n        catatan_admin: catatan_admin\r\n      };\r\n      connection.query('UPDATE pembayaran SET ? WHERE id_pembayaran = ?', [data, id_pembayaran], (err, result) => {\r\n        if (err) reject(err);\r\n        else resolve(result);\r\n      });\r\n    });\r\n  }\r\n\r\n  // Get pending payments for admin confirmation\r\n  static async getPendingPayments() {\r\n    return new Promise((resolve, reject) => {\r\n      const sql = `\r\n        SELECT p.*, r.id_user, r.id_arena, a.nama_arena, u.nama as nama_user\r\n        FROM pembayaran p\r\n        JOIN reservasi r ON p.id_reservasi = r.id_reservasi\r\n        JOIN arena a ON r.id_arena = a.id_arena\r\n        JOIN users u ON r.id_user = u.id_user\r\n        WHERE p.status_pembayaran = 'pending' AND p.konfirmasi_admin = false\r\n        ORDER BY p.tanggal_pembayaran ASC\r\n      `;\r\n      connection.query(sql, (err, rows) => {\r\n        if (err) reject(err);\r\n        else resolve(rows);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nmodule.exports = Model_Pembayaran;\r\n"]}