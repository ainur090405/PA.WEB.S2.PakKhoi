"use strict";function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,n){for(var r=0;r<n.length;r++){var e=n[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(a,e.key,e)}}function _createClass(a,n,r){return n&&_defineProperties(a.prototype,n),r&&_defineProperties(a,r),a}var connection=require("../config/database");function runQuery(a){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return new Promise(function(r,e){connection.query(a,n,function(a,n){if(a)return e(a);r(n)})})}var Model_Arena=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"getAll",value:function(){return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return"\n      SELECT a.*, f.url_foto AS foto_cover \n      FROM arena a\n      LEFT JOIN foto_arena f ON a.id_foto_cover = f.id_foto\n      ORDER BY a.id_arena DESC\n    ",a.abrupt("return",runQuery("\n      SELECT a.*, f.url_foto AS foto_cover \n      FROM arena a\n      LEFT JOIN foto_arena f ON a.id_foto_cover = f.id_foto\n      ORDER BY a.id_arena DESC\n    "));case 2:case"end":return a.stop()}})}},{key:"getById",value:function(n){return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return"\n      SELECT \n        a.*,\n        f.url_foto AS foto_cover,\n        COALESCE(ur.avg_rating, 0)   AS avg_rating,\n        COALESCE(ur.total_review, 0) AS total_review\n      FROM arena a\n      LEFT JOIN foto_arena f ON a.id_foto_cover = f.id_foto\n      LEFT JOIN (\n        SELECT \n          r.id_arena,\n          AVG(u.rating)  AS avg_rating,\n          COUNT(*)       AS total_review\n        FROM ulasan u\n        JOIN reservasi r ON u.id_reservasi = r.id_reservasi\n        GROUP BY r.id_arena\n      ) ur ON ur.id_arena = a.id_arena\n      WHERE a.id_arena = ?\n    ",a.abrupt("return",runQuery("\n      SELECT \n        a.*,\n        f.url_foto AS foto_cover,\n        COALESCE(ur.avg_rating, 0)   AS avg_rating,\n        COALESCE(ur.total_review, 0) AS total_review\n      FROM arena a\n      LEFT JOIN foto_arena f ON a.id_foto_cover = f.id_foto\n      LEFT JOIN (\n        SELECT \n          r.id_arena,\n          AVG(u.rating)  AS avg_rating,\n          COUNT(*)       AS total_review\n        FROM ulasan u\n        JOIN reservasi r ON u.id_reservasi = r.id_reservasi\n        GROUP BY r.id_arena\n      ) ur ON ur.id_arena = a.id_arena\n      WHERE a.id_arena = ?\n    ",[n]));case 2:case"end":return a.stop()}})}},{key:"getPublic",value:function(n){var r,e;return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return r=[],e="\n      SELECT \n        a.*,\n        f.url_foto AS foto_cover,\n        COALESCE(ur.avg_rating, 0)   AS avg_rating,\n        COALESCE(ur.total_review, 0) AS total_review\n      FROM arena a\n      LEFT JOIN foto_arena f ON a.id_foto_cover = f.id_foto\n      LEFT JOIN (\n        SELECT \n          r.id_arena,\n          AVG(u.rating)  AS avg_rating,\n          COUNT(*)       AS total_review\n        FROM ulasan u\n        JOIN reservasi r ON u.id_reservasi = r.id_reservasi\n        GROUP BY r.id_arena\n      ) ur ON ur.id_arena = a.id_arena\n      WHERE a.status = 'aktif'\n    ",n.lokasi&&(e+=" AND a.lokasi LIKE ?",r.push("%"+n.lokasi+"%")),n.jenis&&(e+=" AND a.jenis_olahraga = ?",r.push(n.jenis)),e+=" ORDER BY a.nama_arena ASC",a.abrupt("return",runQuery(e,r));case 6:case"end":return a.stop()}})}},{key:"getFeatured",value:function(){return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return"\n      SELECT \n        a.*,\n        f.url_foto AS foto_cover,\n        COALESCE(ur.avg_rating, 0)   AS avg_rating,\n        COALESCE(ur.total_review, 0) AS total_review\n      FROM arena a \n      LEFT JOIN foto_arena f ON a.id_foto_cover = f.id_foto\n      LEFT JOIN (\n        SELECT \n          r.id_arena,\n          AVG(u.rating)  AS avg_rating,\n          COUNT(*)       AS total_review\n        FROM ulasan u\n        JOIN reservasi r ON u.id_reservasi = r.id_reservasi\n        GROUP BY r.id_arena\n      ) ur ON ur.id_arena = a.id_arena\n      WHERE a.status = 'aktif' \n        AND a.id_foto_cover IS NOT NULL\n      ORDER BY ur.avg_rating DESC, ur.total_review DESC, a.id_arena DESC\n      LIMIT 3\n    ",a.abrupt("return",runQuery("\n      SELECT \n        a.*,\n        f.url_foto AS foto_cover,\n        COALESCE(ur.avg_rating, 0)   AS avg_rating,\n        COALESCE(ur.total_review, 0) AS total_review\n      FROM arena a \n      LEFT JOIN foto_arena f ON a.id_foto_cover = f.id_foto\n      LEFT JOIN (\n        SELECT \n          r.id_arena,\n          AVG(u.rating)  AS avg_rating,\n          COUNT(*)       AS total_review\n        FROM ulasan u\n        JOIN reservasi r ON u.id_reservasi = r.id_reservasi\n        GROUP BY r.id_arena\n      ) ur ON ur.id_arena = a.id_arena\n      WHERE a.status = 'aktif' \n        AND a.id_foto_cover IS NOT NULL\n      ORDER BY ur.avg_rating DESC, ur.total_review DESC, a.id_arena DESC\n      LIMIT 3\n    "));case 2:case"end":return a.stop()}})}},{key:"getJenisOlahragaList",value:function(){return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return"\n      SELECT DISTINCT jenis_olahraga \n      FROM arena \n      WHERE status = 'aktif' AND jenis_olahraga IS NOT NULL \n      ORDER BY jenis_olahraga ASC\n    ",a.abrupt("return",runQuery("\n      SELECT DISTINCT jenis_olahraga \n      FROM arena \n      WHERE status = 'aktif' AND jenis_olahraga IS NOT NULL \n      ORDER BY jenis_olahraga ASC\n    "));case 2:case"end":return a.stop()}})}},{key:"getTopWithRating",value:function(){var n,r=arguments;return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return n=0<r.length&&void 0!==r[0]?r[0]:3,"\n      SELECT \n        a.*,\n        f.url_foto AS foto_cover,\n        COALESCE(AVG(u.rating), 0) AS avg_rating,\n        COUNT(u.id_ulasan)         AS total_ulasan\n      FROM arena a\n      LEFT JOIN foto_arena f ON a.id_foto_cover = f.id_foto\n      LEFT JOIN reservasi r ON r.id_arena = a.id_arena\n      LEFT JOIN ulasan u     ON u.id_reservasi = r.id_reservasi\n      WHERE a.status = 'aktif'\n      GROUP BY a.id_arena\n      ORDER BY avg_rating DESC, total_ulasan DESC, a.id_arena DESC\n      LIMIT ?\n    ",a.abrupt("return",runQuery("\n      SELECT \n        a.*,\n        f.url_foto AS foto_cover,\n        COALESCE(AVG(u.rating), 0) AS avg_rating,\n        COUNT(u.id_ulasan)         AS total_ulasan\n      FROM arena a\n      LEFT JOIN foto_arena f ON a.id_foto_cover = f.id_foto\n      LEFT JOIN reservasi r ON r.id_arena = a.id_arena\n      LEFT JOIN ulasan u     ON u.id_reservasi = r.id_reservasi\n      WHERE a.status = 'aktif'\n      GROUP BY a.id_arena\n      ORDER BY avg_rating DESC, total_ulasan DESC, a.id_arena DESC\n      LIMIT ?\n    ",[Number(n)||3]));case 3:case"end":return a.stop()}})}},{key:"setCover",value:function(n,r){return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return"UPDATE arena SET id_foto_cover = ? WHERE id_arena = ?",a.abrupt("return",runQuery("UPDATE arena SET id_foto_cover = ? WHERE id_arena = ?",[r,n]));case 2:case"end":return a.stop()}})}},{key:"Store",value:function(n){return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return"INSERT INTO arena SET ?",a.abrupt("return",runQuery("INSERT INTO arena SET ?",[n]));case 2:case"end":return a.stop()}})}},{key:"Update",value:function(n,r){return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return"UPDATE arena SET ? WHERE id_arena = ?",a.abrupt("return",runQuery("UPDATE arena SET ? WHERE id_arena = ?",[r,n]));case 2:case"end":return a.stop()}})}},{key:"Delete",value:function(n){return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return"DELETE FROM arena WHERE id_arena = ?",a.abrupt("return",runQuery("DELETE FROM arena WHERE id_arena = ?",[n]));case 2:case"end":return a.stop()}})}}]),a}();module.exports=Model_Arena;
//# sourceMappingURL=Model_Arena.min.js.map
