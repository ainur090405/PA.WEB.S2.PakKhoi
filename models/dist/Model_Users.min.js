"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,n,r){return n&&_defineProperties(e.prototype,n),r&&_defineProperties(e,r),e}var connection=require("../config/database"),bcrypt=require("bcryptjs"),Model_Users=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getAll",value:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(r,t){connection.query("SELECT * FROM users ORDER BY id_user DESC",function(e,n){e?t(e):r(n)})}));case 1:case"end":return e.stop()}})}},{key:"Store",value:function(n){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(r,t){connection.query("INSERT INTO users SET ?",n,function(e,n){e?t(e):r(n)})}));case 1:case"end":return e.stop()}})}},{key:"getByEmail",value:function(n){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(r,t){connection.query("SELECT * FROM users WHERE email = ?",[n],function(e,n){e?t(e):r(n)})}));case 1:case"end":return e.stop()}})}},{key:"getById",value:function(n){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(r,t){connection.query("SELECT * FROM users WHERE id_user = ?",[n],function(e,n){e?t(e):r(n)})}));case 1:case"end":return e.stop()}})}},{key:"Update",value:function(n,u){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(r,t){connection.query("UPDATE users SET ? WHERE id_user = ?",[u,n],function(e,n){e?t(e):r(n)})}));case 1:case"end":return e.stop()}})}},{key:"Delete",value:function(n){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(r,t){connection.query("DELETE FROM users WHERE id_user = ?",[n],function(e,n){e?t(e):r(n)})}));case 1:case"end":return e.stop()}})}},{key:"findOneByEmail",value:function(n){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(r,t){connection.query("SELECT * FROM users WHERE email = ? LIMIT 1",[n],function(e,n){if(e)return t(e);r(n[0]||null)})}));case 1:case"end":return e.stop()}})}},{key:"setResetToken",value:function(n,u,s){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(r,t){connection.query("UPDATE users SET reset_token = ?, reset_token_expires = ? WHERE id_user = ?",[u,s,n],function(e,n){e?t(e):r(n)})}));case 1:case"end":return e.stop()}})}},{key:"findByResetToken",value:function(n){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(r,t){connection.query("\n          SELECT * FROM users\n          WHERE reset_token = ?\n            AND reset_token_expires IS NOT NULL\n            AND reset_token_expires > NOW()\n          LIMIT 1\n        ",[n],function(e,n){if(e)return t(e);r(n[0]||null)})}));case 1:case"end":return e.stop()}})}},{key:"clearResetToken",value:function(n){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(r,t){connection.query("UPDATE users SET reset_token = NULL, reset_token_expires = NULL WHERE id_user = ?",[n],function(e,n){e?t(e):r(n)})}));case 1:case"end":return e.stop()}})}},{key:"updatePassword",value:function(n,r){var u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(bcrypt.hash(r,10));case 2:return u=e.sent,e.abrupt("return",new Promise(function(r,t){connection.query("UPDATE users SET password = ? WHERE id_user = ?",[u,n],function(e,n){e?t(e):r(n)})}));case 4:case"end":return e.stop()}})}}]),e}();module.exports=Model_Users;
//# sourceMappingURL=Model_Users.min.js.map
