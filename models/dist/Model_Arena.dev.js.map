{"version":3,"sources":["Model_Arena.js"],"names":["connection","require","runQuery","sql","params","Promise","resolve","reject","query","err","rows","Model_Arena","id","filter","lokasi","push","jenis","limit","Number","id_arena","id_foto","Data","module","exports"],"mappings":";;;;;;;;AAAA;AACA,IAAMA,UAAU,GAAGC,OAAO,CAAC,oBAAD,CAA1B,C,CAEA;;;AACA,SAASC,QAAT,CAAkBC,GAAlB,EAAoC;AAAA,MAAbC,MAAa,uEAAJ,EAAI;AAClC,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCP,IAAAA,UAAU,CAACQ,KAAX,CAAiBL,GAAjB,EAAsBC,MAAtB,EAA8B,UAACK,GAAD,EAAMC,IAAN,EAAe;AAC3C,UAAID,GAAJ,EAAS,OAAOF,MAAM,CAACE,GAAD,CAAb;AACTH,MAAAA,OAAO,CAACI,IAAD,CAAP;AACD,KAHD;AAID,GALM,CAAP;AAMD;;IAEKC,W;;;;;;;;;AAEJ;;;;;;;AAEQR,cAAAA,G;+CAMCD,QAAQ,CAACC,GAAD,C;;;;;;;;MAGjB;;;;4BACqBS,E;;;;;;AACbT,cAAAA,G;gDAmBCD,QAAQ,CAACC,GAAD,EAAM,CAACS,EAAD,CAAN,C;;;;;;;;MAGjB;;;;8BACuBC,M;;;;;;AACjBT,cAAAA,M,GAAS,E;AACTD,cAAAA,G;;AAoBJ,kBAAIU,MAAM,CAACC,MAAX,EAAmB;AACjBX,gBAAAA,GAAG,IAAI,sBAAP;AACAC,gBAAAA,MAAM,CAACW,IAAP,CAAY,MAAMF,MAAM,CAACC,MAAb,GAAsB,GAAlC;AACD;;AACD,kBAAID,MAAM,CAACG,KAAX,EAAkB;AAChBb,gBAAAA,GAAG,IAAI,2BAAP;AACAC,gBAAAA,MAAM,CAACW,IAAP,CAAYF,MAAM,CAACG,KAAnB;AACD;;AAEDb,cAAAA,GAAG,IAAI,4BAAP;gDAEOD,QAAQ,CAACC,GAAD,EAAMC,MAAN,C;;;;;;;;MAGjB;;;;;;;;;;AAEQD,cAAAA,G;gDAsBCD,QAAQ,CAACC,GAAD,C;;;;;;;;MAGjB;;;;;;;;;;AAEQA,cAAAA,G;gDAMCD,QAAQ,CAACC,GAAD,C;;;;;;;;MAGjB;;;;;;;;;;;;AAC8Bc,cAAAA,K,8DAAQ,C;AAC9Bd,cAAAA,G;gDAeCD,QAAQ,CAACC,GAAD,EAAM,CAACe,MAAM,CAACD,KAAD,CAAN,IAAiB,CAAlB,CAAN,C;;;;;;;;MAGjB;;;;6BACsBE,Q,EAAUC,O;;;;;;AACxBjB,cAAAA,G,GAAM,uD;gDACLD,QAAQ,CAACC,GAAD,EAAM,CAACiB,OAAD,EAAUD,QAAV,CAAN,C;;;;;;;;MAGjB;;;;0BACmBE,I;;;;;;AACXlB,cAAAA,G,GAAM,yB;gDACLD,QAAQ,CAACC,GAAD,EAAM,CAACkB,IAAD,CAAN,C;;;;;;;;;;;2BAGGT,E,EAAIS,I;;;;;;AAChBlB,cAAAA,G,GAAM,uC;gDACLD,QAAQ,CAACC,GAAD,EAAM,CAACkB,IAAD,EAAOT,EAAP,CAAN,C;;;;;;;;;;;2BAGGA,E;;;;;;AACZT,cAAAA,G,GAAM,sC;iDACLD,QAAQ,CAACC,GAAD,EAAM,CAACS,EAAD,CAAN,C;;;;;;;;;;;;;;AAInBU,MAAM,CAACC,OAAP,GAAiBZ,WAAjB","sourcesContent":["// models/Model_Arena.js\r\nconst connection = require('../config/database');\r\n\r\n// helper query pakai Promise\r\nfunction runQuery(sql, params = []) {\r\n  return new Promise((resolve, reject) => {\r\n    connection.query(sql, params, (err, rows) => {\r\n      if (err) return reject(err);\r\n      resolve(rows);\r\n    });\r\n  });\r\n}\r\n\r\nclass Model_Arena {\r\n\r\n  // Ambil semua arena (untuk admin) + cover\r\n  static async getAll() {\r\n    const sql = `\r\n      SELECT a.*, f.url_foto AS foto_cover \r\n      FROM arena a\r\n      LEFT JOIN foto_arena f ON a.id_foto_cover = f.id_foto\r\n      ORDER BY a.id_arena DESC\r\n    `;\r\n    return runQuery(sql);\r\n  }\r\n\r\n  // Ambil 1 arena (detail) + cover + rata-rata rating\r\n  static async getById(id) {\r\n    const sql = `\r\n      SELECT \r\n        a.*,\r\n        f.url_foto AS foto_cover,\r\n        COALESCE(ur.avg_rating, 0)   AS avg_rating,\r\n        COALESCE(ur.total_review, 0) AS total_review\r\n      FROM arena a\r\n      LEFT JOIN foto_arena f ON a.id_foto_cover = f.id_foto\r\n      LEFT JOIN (\r\n        SELECT \r\n          r.id_arena,\r\n          AVG(u.rating)  AS avg_rating,\r\n          COUNT(*)       AS total_review\r\n        FROM ulasan u\r\n        JOIN reservasi r ON u.id_reservasi = r.id_reservasi\r\n        GROUP BY r.id_arena\r\n      ) ur ON ur.id_arena = a.id_arena\r\n      WHERE a.id_arena = ?\r\n    `;\r\n    return runQuery(sql, [id]);\r\n  }\r\n\r\n  // Ambil arena untuk publik (/venues) + cover + rating\r\n  static async getPublic(filter) {\r\n    let params = [];\r\n    let sql = `\r\n      SELECT \r\n        a.*,\r\n        f.url_foto AS foto_cover,\r\n        COALESCE(ur.avg_rating, 0)   AS avg_rating,\r\n        COALESCE(ur.total_review, 0) AS total_review\r\n      FROM arena a\r\n      LEFT JOIN foto_arena f ON a.id_foto_cover = f.id_foto\r\n      LEFT JOIN (\r\n        SELECT \r\n          r.id_arena,\r\n          AVG(u.rating)  AS avg_rating,\r\n          COUNT(*)       AS total_review\r\n        FROM ulasan u\r\n        JOIN reservasi r ON u.id_reservasi = r.id_reservasi\r\n        GROUP BY r.id_arena\r\n      ) ur ON ur.id_arena = a.id_arena\r\n      WHERE a.status = 'aktif'\r\n    `;\r\n\r\n    if (filter.lokasi) {\r\n      sql += ' AND a.lokasi LIKE ?';\r\n      params.push('%' + filter.lokasi + '%');\r\n    }\r\n    if (filter.jenis) {\r\n      sql += ' AND a.jenis_olahraga = ?';\r\n      params.push(filter.jenis);\r\n    }\r\n\r\n    sql += ' ORDER BY a.nama_arena ASC';\r\n\r\n    return runQuery(sql, params);\r\n  }\r\n\r\n  // Ambil arena untuk Home (rekomendasi) + cover + rating\r\n  static async getFeatured() {\r\n    const sql = `\r\n      SELECT \r\n        a.*,\r\n        f.url_foto AS foto_cover,\r\n        COALESCE(ur.avg_rating, 0)   AS avg_rating,\r\n        COALESCE(ur.total_review, 0) AS total_review\r\n      FROM arena a \r\n      LEFT JOIN foto_arena f ON a.id_foto_cover = f.id_foto\r\n      LEFT JOIN (\r\n        SELECT \r\n          r.id_arena,\r\n          AVG(u.rating)  AS avg_rating,\r\n          COUNT(*)       AS total_review\r\n        FROM ulasan u\r\n        JOIN reservasi r ON u.id_reservasi = r.id_reservasi\r\n        GROUP BY r.id_arena\r\n      ) ur ON ur.id_arena = a.id_arena\r\n      WHERE a.status = 'aktif' \r\n        AND a.id_foto_cover IS NOT NULL\r\n      ORDER BY ur.avg_rating DESC, ur.total_review DESC, a.id_arena DESC\r\n      LIMIT 3\r\n    `;\r\n    return runQuery(sql);\r\n  }\r\n\r\n  // Jenis olahraga unik (filter di /venues)\r\n  static async getJenisOlahragaList() {\r\n    const sql = `\r\n      SELECT DISTINCT jenis_olahraga \r\n      FROM arena \r\n      WHERE status = 'aktif' AND jenis_olahraga IS NOT NULL \r\n      ORDER BY jenis_olahraga ASC\r\n    `;\r\n    return runQuery(sql);\r\n  }\r\n\r\n  // Arena teratas berdasarkan rating (buat statistik / rekomendasi khusus)\r\n  static async getTopWithRating(limit = 3) {\r\n    const sql = `\r\n      SELECT \r\n        a.*,\r\n        f.url_foto AS foto_cover,\r\n        COALESCE(AVG(u.rating), 0) AS avg_rating,\r\n        COUNT(u.id_ulasan)         AS total_ulasan\r\n      FROM arena a\r\n      LEFT JOIN foto_arena f ON a.id_foto_cover = f.id_foto\r\n      LEFT JOIN reservasi r ON r.id_arena = a.id_arena\r\n      LEFT JOIN ulasan u     ON u.id_reservasi = r.id_reservasi\r\n      WHERE a.status = 'aktif'\r\n      GROUP BY a.id_arena\r\n      ORDER BY avg_rating DESC, total_ulasan DESC, a.id_arena DESC\r\n      LIMIT ?\r\n    `;\r\n    return runQuery(sql, [Number(limit) || 3]);\r\n  }\r\n\r\n  // Set foto cover\r\n  static async setCover(id_arena, id_foto) {\r\n    const sql = 'UPDATE arena SET id_foto_cover = ? WHERE id_arena = ?';\r\n    return runQuery(sql, [id_foto, id_arena]);\r\n  }\r\n  \r\n  // --- CRUD standar ---\r\n  static async Store(Data) {\r\n    const sql = 'INSERT INTO arena SET ?';\r\n    return runQuery(sql, [Data]);\r\n  }\r\n\r\n  static async Update(id, Data) {\r\n    const sql = 'UPDATE arena SET ? WHERE id_arena = ?';\r\n    return runQuery(sql, [Data, id]);\r\n  }\r\n\r\n  static async Delete(id) {\r\n    const sql = 'DELETE FROM arena WHERE id_arena = ?';\r\n    return runQuery(sql, [id]);\r\n  }\r\n}\r\n\r\nmodule.exports = Model_Arena;\r\n"],"file":"Model_Arena.dev.js"}