{"version":3,"sources":["Model_Arena.js"],"names":["connection","require","runQuery","sql","params","arguments","length","undefined","Promise","resolve","reject","query","err","rows","id","filter","lokasi","push","jenis","limit","Number","id_arena","id_foto","Data","Model_Arena"],"mappings":"mZACA,IAAMA,WAAaC,QAAQ,sBAG3B,SAASC,SAASC,GAAkB,IAAbC,EAAa,EAAAC,UAAAC,aAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAJ,GAC9B,OAAO,IAAIG,QAAQ,SAACC,EAASC,GAC3BV,WAAWW,MAAMR,EAAKC,EAAQ,SAACQ,EAAKC,GAClC,GAAID,EAAK,OAAOF,EAAOE,GAP7BH,EAAAI,WAIuBT,sYAmBZF,sPAIYY,mrBADrBZ,ilBAAA,CAAAY,2EAyBuBC,kGACjBX,EAAS,GACTD,8kBAoBAY,EAAOC,SACTb,GAAO,uBACPC,EAAOa,KAAK,IAAMF,EAAOC,OAAS,MAtBhCb,EAAAA,QAyBFA,GAAO,4BALTC,EAAAa,KAAIF,EAAOC,QAGVb,GAAA,+CACDD,SAAIa,EAAOG,s4BAkCJhB,0jCAWAA,uWAIqBiB,iCAAQ,4hBAgB7BjB,ihBAAc,CAACkB,OAAOD,IAAU,0EAInBE,EAAUC,yFAClB,0EArBgBH,SAqBhB,wDACS,CAACG,EAASD,uEAIdE,yFACL,4CACLrB,SADK,0BACS,CAACqB,wEAGJT,EAAIS,yFAZxB,0DAcSrB,SAdT,wCAcuB,CAACqB,EAAMT,wEAGVA,yFACN,yDACLZ,SADK,uCACS,CAACY,kDAjBhBX,OAAAA,QAqBOqB","file":"Model_Arena.min.js","sourcesContent":["// models/Model_Arena.js\r\nconst connection = require('../config/database');\r\n\r\n// helper query pakai Promise\r\nfunction runQuery(sql, params = []) {\r\n  return new Promise((resolve, reject) => {\r\n    connection.query(sql, params, (err, rows) => {\r\n      if (err) return reject(err);\r\n      resolve(rows);\r\n    });\r\n  });\r\n}\r\n\r\nclass Model_Arena {\r\n\r\n  // Ambil semua arena (untuk admin) + cover\r\n  static async getAll() {\r\n    const sql = `\r\n      SELECT a.*, f.url_foto AS foto_cover \r\n      FROM arena a\r\n      LEFT JOIN foto_arena f ON a.id_foto_cover = f.id_foto\r\n      ORDER BY a.id_arena DESC\r\n    `;\r\n    return runQuery(sql);\r\n  }\r\n\r\n  // Ambil 1 arena (detail) + cover + rata-rata rating\r\n  static async getById(id) {\r\n    const sql = `\r\n      SELECT \r\n        a.*,\r\n        f.url_foto AS foto_cover,\r\n        COALESCE(ur.avg_rating, 0)   AS avg_rating,\r\n        COALESCE(ur.total_review, 0) AS total_review\r\n      FROM arena a\r\n      LEFT JOIN foto_arena f ON a.id_foto_cover = f.id_foto\r\n      LEFT JOIN (\r\n        SELECT \r\n          r.id_arena,\r\n          AVG(u.rating)  AS avg_rating,\r\n          COUNT(*)       AS total_review\r\n        FROM ulasan u\r\n        JOIN reservasi r ON u.id_reservasi = r.id_reservasi\r\n        GROUP BY r.id_arena\r\n      ) ur ON ur.id_arena = a.id_arena\r\n      WHERE a.id_arena = ?\r\n    `;\r\n    return runQuery(sql, [id]);\r\n  }\r\n\r\n  // Ambil arena untuk publik (/venues) + cover + rating\r\n  static async getPublic(filter) {\r\n    let params = [];\r\n    let sql = `\r\n      SELECT \r\n        a.*,\r\n        f.url_foto AS foto_cover,\r\n        COALESCE(ur.avg_rating, 0)   AS avg_rating,\r\n        COALESCE(ur.total_review, 0) AS total_review\r\n      FROM arena a\r\n      LEFT JOIN foto_arena f ON a.id_foto_cover = f.id_foto\r\n      LEFT JOIN (\r\n        SELECT \r\n          r.id_arena,\r\n          AVG(u.rating)  AS avg_rating,\r\n          COUNT(*)       AS total_review\r\n        FROM ulasan u\r\n        JOIN reservasi r ON u.id_reservasi = r.id_reservasi\r\n        GROUP BY r.id_arena\r\n      ) ur ON ur.id_arena = a.id_arena\r\n      WHERE a.status = 'aktif'\r\n    `;\r\n\r\n    if (filter.lokasi) {\r\n      sql += ' AND a.lokasi LIKE ?';\r\n      params.push('%' + filter.lokasi + '%');\r\n    }\r\n    if (filter.jenis) {\r\n      sql += ' AND a.jenis_olahraga = ?';\r\n      params.push(filter.jenis);\r\n    }\r\n\r\n    sql += ' ORDER BY a.nama_arena ASC';\r\n\r\n    return runQuery(sql, params);\r\n  }\r\n\r\n  // Ambil arena untuk Home (rekomendasi) + cover + rating\r\n  static async getFeatured() {\r\n    const sql = `\r\n      SELECT \r\n        a.*,\r\n        f.url_foto AS foto_cover,\r\n        COALESCE(ur.avg_rating, 0)   AS avg_rating,\r\n        COALESCE(ur.total_review, 0) AS total_review\r\n      FROM arena a \r\n      LEFT JOIN foto_arena f ON a.id_foto_cover = f.id_foto\r\n      LEFT JOIN (\r\n        SELECT \r\n          r.id_arena,\r\n          AVG(u.rating)  AS avg_rating,\r\n          COUNT(*)       AS total_review\r\n        FROM ulasan u\r\n        JOIN reservasi r ON u.id_reservasi = r.id_reservasi\r\n        GROUP BY r.id_arena\r\n      ) ur ON ur.id_arena = a.id_arena\r\n      WHERE a.status = 'aktif' \r\n        AND a.id_foto_cover IS NOT NULL\r\n      ORDER BY ur.avg_rating DESC, ur.total_review DESC, a.id_arena DESC\r\n      LIMIT 3\r\n    `;\r\n    return runQuery(sql);\r\n  }\r\n\r\n  // Jenis olahraga unik (filter di /venues)\r\n  static async getJenisOlahragaList() {\r\n    const sql = `\r\n      SELECT DISTINCT jenis_olahraga \r\n      FROM arena \r\n      WHERE status = 'aktif' AND jenis_olahraga IS NOT NULL \r\n      ORDER BY jenis_olahraga ASC\r\n    `;\r\n    return runQuery(sql);\r\n  }\r\n\r\n  // Arena teratas berdasarkan rating (buat statistik / rekomendasi khusus)\r\n  static async getTopWithRating(limit = 3) {\r\n    const sql = `\r\n      SELECT \r\n        a.*,\r\n        f.url_foto AS foto_cover,\r\n        COALESCE(AVG(u.rating), 0) AS avg_rating,\r\n        COUNT(u.id_ulasan)         AS total_ulasan\r\n      FROM arena a\r\n      LEFT JOIN foto_arena f ON a.id_foto_cover = f.id_foto\r\n      LEFT JOIN reservasi r ON r.id_arena = a.id_arena\r\n      LEFT JOIN ulasan u     ON u.id_reservasi = r.id_reservasi\r\n      WHERE a.status = 'aktif'\r\n      GROUP BY a.id_arena\r\n      ORDER BY avg_rating DESC, total_ulasan DESC, a.id_arena DESC\r\n      LIMIT ?\r\n    `;\r\n    return runQuery(sql, [Number(limit) || 3]);\r\n  }\r\n\r\n  // Set foto cover\r\n  static async setCover(id_arena, id_foto) {\r\n    const sql = 'UPDATE arena SET id_foto_cover = ? WHERE id_arena = ?';\r\n    return runQuery(sql, [id_foto, id_arena]);\r\n  }\r\n  \r\n  // --- CRUD standar ---\r\n  static async Store(Data) {\r\n    const sql = 'INSERT INTO arena SET ?';\r\n    return runQuery(sql, [Data]);\r\n  }\r\n\r\n  static async Update(id, Data) {\r\n    const sql = 'UPDATE arena SET ? WHERE id_arena = ?';\r\n    return runQuery(sql, [Data, id]);\r\n  }\r\n\r\n  static async Delete(id) {\r\n    const sql = 'DELETE FROM arena WHERE id_arena = ?';\r\n    return runQuery(sql, [id]);\r\n  }\r\n}\r\n\r\nmodule.exports = Model_Arena;\r\n"]}