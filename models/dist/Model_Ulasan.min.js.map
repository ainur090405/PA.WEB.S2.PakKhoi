{"version":3,"sources":["Model_Ulasan.js"],"names":["connection","require","Model_Ulasan","id_user","Promise","resolve","reject","query","err","rows","sql","id","id_reservasi","Data","result","id_arena","module","exports"],"mappings":"mZACA,IAAMA,WAAaC,QAAQ,sBAErBC,yHAEmBC,4GACd,IAAIC,QAAQ,SAACC,EAASC,GAS3BN,WAAWO,MARF,0RAQa,CAACJ,GAAU,SAACK,EAAKC,GACjCD,EAAKF,EAAOE,GACXH,EAAQI,sLAMV,IAAIL,QAAQ,SAACC,EAASC,GAC3BN,WAAWO,MAAM,uBAAwB,SAACC,EAAKC,GACzCD,EAAKF,EAAOE,GAlBlBH,EAAMK,4EAwBWC,4GACZ,IAAIP,QAAQ,SAACC,EAASC,GAC3BN,WAAWO,MAAM,2CAA4C,CAACI,GAAK,SAACH,EAAKC,GACnED,EAAKF,EAAOE,GACXH,EAAQI,mFAMSG,4GACnB,IAAIR,QAAQ,SAACC,EAASC,GAC3BN,WAAWO,MAAM,8CAA+C,CAACK,GAAe,SAACJ,EAAKC,GAChFD,EAAKF,EAAOE,GACXH,EAAQI,0EAKAI,4GACV,IAAIT,QAAQ,SAACC,EAASC,GAC3BN,WAAWO,MAAM,2BAA4BM,EAAM,SAACL,EAAKM,GACnDN,EAAKF,EAAOE,GACXH,EAAQS,2EAKCF,EAAcC,4GACzB,IAAIT,QAAQ,SAACC,EAASC,GAC3BN,WAAWO,MAAM,6CAA8C,CAACM,EAAMD,GAAe,SAACJ,EAAKM,GACrFN,EAAKF,EAAOE,GACXH,EAAQS,2EA7BTN,4GAEL,IAAAJ,QAHD,SAAAC,EAAAC,GAIDN,WAiCYO,MAAM,4CAA6C,CAACK,GAAe,SAACJ,EAAKM,GAC9EN,EAAKF,EAAOE,GACXH,EAAQS,+EAKKC,4GArCxB,IAAAX,QAAA,SAAAC,EAAAC,GA+CIN,WAAWO,MARF,sSAQa,CAACQ,GAAW,SAACP,EAAKC,GA5CxCT,EAAAA,EAAAA,GACEK,EAAAI,sFAiDuBG,EAAcC,4GACpC,IAAIT,QAAQ,SAACC,EAASC,GAE3BN,WAAWO,MADC,6CACU,CAACM,EAAMD,GAAe,SAACJ,EAAKM,GAC5CN,EAAKF,EAAOE,GACXH,EAAQS,qFAKaC,4GACrB,IAAIX,QAAQ,SAACC,EAASC,GAhD5BN,WAuDYO,MANF,8MAMa,CAACQ,GAAW,SAACP,EAAKC,GAClCD,EAAKF,EAAOE,GACXH,EAAQI,EAAK,sDAM1BO,OAAOC,QAAUf","file":"Model_Ulasan.min.js","sourcesContent":["// models/Model_Ulasan.js\r\nconst connection = require('../config/database');\r\n\r\nclass Model_Ulasan {\r\n\r\n  static async getByUser(id_user) {\r\n    return new Promise((resolve, reject) => {\r\n      const sql = `\r\n        SELECT u.rating, u.komentar, u.tanggal_ulasan, a.nama_arena\r\n        FROM ulasan u\r\n        JOIN reservasi r ON u.id_reservasi = r.id_reservasi\r\n        JOIN arena a ON r.id_arena = a.id_arena\r\n        WHERE u.id_user = ?\r\n        ORDER BY u.tanggal_ulasan DESC\r\n      `;\r\n      connection.query(sql, [id_user], (err, rows) => {\r\n        if (err) reject(err);\r\n        else resolve(rows);\r\n      });\r\n    });\r\n  }\r\n\r\n  static async getAll() {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query('SELECT * FROM ulasan', (err, rows) => {\r\n        if (err) reject(err);\r\n        else resolve(rows);\r\n      });\r\n    });\r\n  }\r\n\r\n  static async getById(id) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query('SELECT * FROM ulasan WHERE id_ulasan = ?', [id], (err, rows) => {\r\n        if (err) reject(err);\r\n        else resolve(rows);\r\n      });\r\n    });\r\n  }\r\n\r\n  // âœ… tambahan fix: get ulasan berdasarkan id_reservasi\r\n  static async getByReservasi(id_reservasi) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query('SELECT * FROM ulasan WHERE id_reservasi = ?', [id_reservasi], (err, rows) => {\r\n        if (err) reject(err);\r\n        else resolve(rows);\r\n      });\r\n    });\r\n  }\r\n\r\n  static async Store(Data) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query('INSERT INTO ulasan SET ?', Data, (err, result) => {\r\n        if (err) reject(err);\r\n        else resolve(result);\r\n      });\r\n    });\r\n  }\r\n\r\n  static async Update(id_reservasi, Data) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query('UPDATE ulasan SET ? WHERE id_reservasi = ?', [Data, id_reservasi], (err, result) => {\r\n        if (err) reject(err);\r\n        else resolve(result);\r\n      });\r\n    });\r\n  }\r\n\r\n  static async Delete(id_reservasi) {\r\n    return new Promise((resolve, reject) => {\r\n      connection.query('DELETE FROM ulasan WHERE id_reservasi = ?', [id_reservasi], (err, result) => {\r\n        if (err) reject(err);\r\n        else resolve(result);\r\n      });\r\n    });\r\n  }\r\n\r\n  static async getByArena(id_arena) {\r\n    return new Promise((resolve, reject) => {\r\n      const sql = `\r\n        SELECT u.rating, u.komentar, u.tanggal_ulasan, usr.nama as nama_user\r\n        FROM ulasan u\r\n        JOIN reservasi r ON u.id_reservasi = r.id_reservasi\r\n        JOIN users usr ON u.id_user = usr.id_user\r\n        WHERE r.id_arena = ?\r\n        ORDER BY u.tanggal_ulasan DESC\r\n      `;\r\n      connection.query(sql, [id_arena], (err, rows) => {\r\n        if (err) reject(err);\r\n        else resolve(rows);\r\n      });\r\n    });\r\n  }\r\nstatic async UpdateByReservasi(id_reservasi, Data) {\r\n  return new Promise((resolve, reject) => {\r\n    const sql = 'UPDATE ulasan SET ? WHERE id_reservasi = ?';\r\n    connection.query(sql, [Data, id_reservasi], (err, result) => {\r\n      if (err) reject(err);\r\n      else resolve(result);\r\n    });\r\n  });\r\n}\r\n\r\n  static async getAverageRating(id_arena) {\r\n    return new Promise((resolve, reject) => {\r\n      const sql = `\r\n        SELECT AVG(u.rating) as avg_rating, COUNT(u.id_ulasan) as total_reviews\r\n        FROM ulasan u\r\n        JOIN reservasi r ON u.id_reservasi = r.id_reservasi\r\n        WHERE r.id_arena = ?\r\n      `;\r\n      connection.query(sql, [id_arena], (err, rows) => {\r\n        if (err) reject(err);\r\n        else resolve(rows[0]);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nmodule.exports = Model_Ulasan;\r\n"]}