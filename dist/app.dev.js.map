{"version":3,"sources":["app.js"],"names":["createError","require","express","path","cookieParser","logger","session","flash","indexRouter","usersRouter","authRouter","adminRouter","pemainRouter","jadwalRouter","reservasiRouter","arenaRouter","venuesRouter","bookingRouter","fotoRouter","ulasanRouter","pembayaranRouter","notifikasiRouter","activityRouter","app","set","join","__dirname","use","json","urlencoded","extended","secret","resave","saveUninitialized","cookie","secure","maxAge","fs","uploadsDirs","forEach","dir","existsSync","mkdirSync","recursive","console","log","err","error","req","res","next","locals","success_msg","error_msg","user","role","Model_Notifikasi","getByUser","id","notifications","getUnreadCount","unreadCount","message","get","status","render","title","cron","Model_Reservasi","schedule","autoUpdateStatus","Date","module","exports"],"mappings":"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","sourcesContent":["var createError = require('http-errors');\r\nvar express = require('express');\r\nvar path = require('path');\r\nvar cookieParser = require('cookie-parser');\r\nvar logger = require('morgan');\r\nvar session = require('express-session');\r\nvar flash = require('connect-flash');\r\n\r\n\r\n// Impor Rute\r\nvar indexRouter = require('./routes/index');\r\nvar usersRouter = require('./routes/users'); // Rute CRUD Master User\r\nvar authRouter = require('./routes/auth'); // Rute Login/Register\r\nvar adminRouter = require('./routes/admin'); // Rute Dashboard Admin\r\nvar pemainRouter = require('./routes/pemain'); // Rute Dashboard Pemain\r\nvar jadwalRouter = require('./routes/jadwal');\r\nconst reservasiRouter = require('./routes/reservasi');\r\nvar arenaRouter = require('./routes/arena');\r\nvar venuesRouter = require('./routes/venues');\r\nvar bookingRouter = require('./routes/booking');\r\nvar fotoRouter = require('./routes/foto');\r\nvar ulasanRouter = require('./routes/ulasan');\r\nvar pembayaranRouter = require('./routes/pembayaran');\r\nvar notifikasiRouter = require('./routes/notifikasi');\r\nconst activityRouter = require('./routes/activity');\r\n\r\n\r\nvar app = express();\r\n\r\n// view engine setup\r\napp.set('views', path.join(__dirname, 'views'));\r\napp.set('view engine', 'ejs');\r\n\r\napp.use(logger('dev'));\r\napp.use(express.json());\r\napp.use(express.urlencoded({ extended: false }));\r\napp.use(cookieParser());\r\n\r\n// Serve static files (including uploaded files under public/uploads)\r\napp.use(express.static(path.join(__dirname, 'public')));\r\napp.use('/uploads', express.static(path.join(__dirname, 'public', 'uploads')));\r\n\r\n// Konfigurasi Session (Tanpa .env)\r\napp.use(session({\r\n  secret: 'kunci-rahasia-untuk-arenago-project', // Kunci rahasia\r\n  resave: false,\r\n  saveUninitialized: true,\r\n  cookie: {\r\n    secure: false, // Set 'true' jika pakai HTTPS\r\n    maxAge: 1000 * 60 * 60 * 24 // Cookie berlaku 1 hari\r\n  }\r\n}));\r\n\r\n// Konfigurasi Flash Message\r\napp.use(flash());\r\n\r\n// ============================\r\n// Pastikan folder upload ada\r\n// ============================\r\nconst fs = require('fs');\r\nconst uploadsDirs = [\r\n  path.join(__dirname, 'public', 'uploads'),\r\n  path.join(__dirname, 'public', 'uploads', 'arena'),\r\n  path.join(__dirname, 'public', 'uploads', 'bukti_pembayaran')\r\n];\r\n\r\nuploadsDirs.forEach(dir => {\r\n  try {\r\n    if (!fs.existsSync(dir)) {\r\n      fs.mkdirSync(dir, { recursive: true });\r\n      console.log('Membuat folder upload:', dir);\r\n    }\r\n  } catch (err) {\r\n    console.error('Gagal membuat folder uploads:', dir, err);\r\n  }\r\n});\r\n\r\n// [Middleware Global PENTING]\r\n// Mengirim pesan flash & info user ke SEMUA file .ejs\r\napp.use(async (req, res, next) => {\r\n  res.locals.success_msg = req.flash('success_msg');\r\n  res.locals.error_msg = req.flash('error_msg');\r\n  res.locals.user = req.session.user || null; // Info user yang login\r\n\r\n  // Jika user adalah pemain, ambil notifikasi (opsional)\r\n  if (req.session.user && req.session.user.role === 'pemain') {\r\n    const Model_Notifikasi = require('./models/Model_Notifikasi');\r\n    try {\r\n      res.locals.notifications = await Model_Notifikasi.getByUser(req.session.user.id);\r\n      res.locals.unreadCount = await Model_Notifikasi.getUnreadCount(req.session.user.id);\r\n    } catch (err) {\r\n      console.error('Error loading notifications:', err);\r\n      res.locals.notifications = [];\r\n      res.locals.unreadCount = 0;\r\n    }\r\n  } else {\r\n    res.locals.notifications = [];\r\n    res.locals.unreadCount = 0;\r\n  }\r\n\r\n  next();\r\n});\r\n\r\n// Pendaftaran Rute\r\napp.use('/', indexRouter);\r\napp.use('/auth', authRouter);\r\napp.use('/admin', adminRouter);\r\napp.use('/pemain', pemainRouter);\r\napp.use('/users', usersRouter); // Ini untuk CRUD Master User oleh Admin\r\napp.use('/arena', arenaRouter);\r\napp.use('/admin/reservasi', reservasiRouter);\r\napp.use('/jadwal', jadwalRouter);\r\napp.use('/venues', venuesRouter);\r\napp.use('/booking', bookingRouter);\r\napp.use('/foto', fotoRouter);\r\napp.use('/ulasan', ulasanRouter);\r\napp.use('/admin/pembayaran', pembayaranRouter);\r\napp.use('/notifikasi', notifikasiRouter);\r\napp.use('/activity', activityRouter);\r\n\r\n\r\n// catch 404 and forward to error handler\r\napp.use(function(req, res, next) {\r\n  next(createError(404));\r\n});\r\n\r\n// error handler\r\napp.use(function(err, req, res, next) {\r\n  // set locals, only providing error in development\r\n  res.locals.message = err.message;\r\n  res.locals.error = req.app.get('env') === 'development' ? err : {};\r\n\r\n  // render the error page\r\n  res.status(err.status || 500);\r\n  res.render('error', { title: 'Error' });\r\n});\r\n\r\nconst cron = require('node-cron');\r\nconst Model_Reservasi = require('./models/Model_Reservasi');\r\n\r\n// Jalankan setiap 1 menit\r\ncron.schedule('* * * * *', async () => {\r\n  try {\r\n    await Model_Reservasi.autoUpdateStatus();\r\n    console.log('Auto update status selesai -', new Date());\r\n  } catch (err) {\r\n    console.error('Gagal auto update:', err);\r\n  }\r\n});\r\n\r\nmodule.exports = app;\r\n"],"file":"app.dev.js"}