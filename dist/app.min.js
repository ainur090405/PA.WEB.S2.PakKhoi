"use strict";var createError=require("http-errors"),express=require("express"),path=require("path"),cookieParser=require("cookie-parser"),logger=require("morgan"),session=require("express-session"),flash=require("connect-flash"),indexRouter=require("./routes/index"),usersRouter=require("./routes/users"),authRouter=require("./routes/auth"),adminRouter=require("./routes/admin"),pemainRouter=require("./routes/pemain"),jadwalRouter=require("./routes/jadwal"),reservasiRouter=require("./routes/reservasi"),arenaRouter=require("./routes/arena"),venuesRouter=require("./routes/venues"),bookingRouter=require("./routes/booking"),fotoRouter=require("./routes/foto"),ulasanRouter=require("./routes/ulasan"),pembayaranRouter=require("./routes/pembayaran"),notifikasiRouter=require("./routes/notifikasi"),app=express();app.set("views",path.join(__dirname,"views")),app.set("view engine","ejs"),app.use(logger("dev")),app.use(express.json()),app.use(express.urlencoded({extended:!1})),app.use(cookieParser()),app.use(express.static(path.join(__dirname,"public"))),app.use(session({secret:"kunci-rahasia-untuk-arenago-project",resave:!1,saveUninitialized:!0,cookie:{secure:!1,maxAge:864e5}})),app.use(flash()),app.use(function(r,s,a){var o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(s.locals.success_msg=r.flash("success_msg"),s.locals.error_msg=r.flash("error_msg"),s.locals.user=r.session.user||null,r.session.user&&"pemain"===r.session.user.role)return o=require("./models/Model_Notifikasi"),e.prev=5,e.next=8,regeneratorRuntime.awrap(o.getByUser(r.session.user.id));e.next=21;break;case 8:return s.locals.notifications=e.sent,e.next=11,regeneratorRuntime.awrap(o.getUnreadCount(r.session.user.id));case 11:s.locals.unreadCount=e.sent,e.next=19;break;case 14:e.prev=14,e.t0=e.catch(5),console.error("Error loading notifications:",e.t0),s.locals.notifications=[],s.locals.unreadCount=0;case 19:e.next=23;break;case 21:s.locals.notifications=[],s.locals.unreadCount=0;case 23:a();case 24:case"end":return e.stop()}},null,null,[[5,14]])}),app.use("/",indexRouter),app.use("/auth",authRouter),app.use("/admin",adminRouter),app.use("/pemain",pemainRouter),app.use("/users",usersRouter),app.use("/arena",arenaRouter),app.use("/admin/reservasi",reservasiRouter),app.use("/jadwal",jadwalRouter),app.use("/venues",venuesRouter),app.use("/booking",bookingRouter),app.use("/foto",fotoRouter),app.use("/ulasan",ulasanRouter),app.use("/admin/pembayaran",pembayaranRouter),app.use("/notifikasi",notifikasiRouter),app.use(function(e,r,s){s(createError(404))}),app.use(function(e,r,s,a){s.locals.message=e.message,s.locals.error="development"===r.app.get("env")?e:{},s.status(e.status||500),s.render("error",{title:"Error"})});var port=process.env.PORT||3e3;app.listen(port,function(){console.log("Server running on port ".concat(port))});var cron=require("node-cron"),Model_Reservasi=require("./models/Model_Reservasi");cron.schedule("* * * * *",function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(Model_Reservasi.autoUpdateStatus());case 3:console.log("Auto update status selesai -",new Date),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.error("Gagal auto update:",e.t0);case 9:case"end":return e.stop()}},null,null,[[0,6]])}),module.exports=app;
//# sourceMappingURL=app.min.js.map
