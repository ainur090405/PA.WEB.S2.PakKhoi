{"version":3,"sources":["app.js"],"names":["createError","require","express","cookieParser","session","path","logger","usersRouter","adminRouter","flash","jadwalRouter","reservasiRouter","indexRouter","venuesRouter","fotoRouter","ulasanRouter","authRouter","notifikasiRouter","app","pemainRouter","__dirname","set","use","json","extended","join","secret","resave","saveUninitialized","cookie","pembayaranRouter","secure","fs","forEach","dir","existsSync","recursive","log","err","maxAge","error","req","res","next","Model_Notifikasi","regeneratorRuntime","async","_context","prev","locals","success_msg","error_msg","user","uploadsDirs","role","awrap","getByUser","id","mkdirSync","sent","getUnreadCount","unreadCount","t0","console","notifications","stop","arenaRouter","bookingRouter","message","get","status","render","title","Model_Reservasi","cron","schedule","_context2","autoUpdateStatus","Date","module","exports"],"mappings":"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","file":"app.min.js","sourcesContent":["var createError = require('http-errors');\r\nvar express = require('express');\r\nvar path = require('path');\r\nvar cookieParser = require('cookie-parser');\r\nvar logger = require('morgan');\r\nvar session = require('express-session');\r\nvar flash = require('connect-flash');\r\n\r\n\r\n// Impor Rute\r\nvar indexRouter = require('./routes/index');\r\nvar usersRouter = require('./routes/users'); // Rute CRUD Master User\r\nvar authRouter = require('./routes/auth'); // Rute Login/Register\r\nvar adminRouter = require('./routes/admin'); // Rute Dashboard Admin\r\nvar pemainRouter = require('./routes/pemain'); // Rute Dashboard Pemain\r\nvar jadwalRouter = require('./routes/jadwal');\r\nconst reservasiRouter = require('./routes/reservasi');\r\nvar arenaRouter = require('./routes/arena');\r\nvar venuesRouter = require('./routes/venues');\r\nvar bookingRouter = require('./routes/booking');\r\nvar fotoRouter = require('./routes/foto');\r\nvar ulasanRouter = require('./routes/ulasan');\r\nvar pembayaranRouter = require('./routes/pembayaran');\r\nvar notifikasiRouter = require('./routes/notifikasi');\r\n\r\nvar app = express();\r\n\r\n// view engine setup\r\napp.set('views', path.join(__dirname, 'views'));\r\napp.set('view engine', 'ejs');\r\n\r\napp.use(logger('dev'));\r\napp.use(express.json());\r\napp.use(express.urlencoded({ extended: false }));\r\napp.use(cookieParser());\r\n\r\n// Serve static files (including uploaded files under public/uploads)\r\napp.use(express.static(path.join(__dirname, 'public')));\r\napp.use('/uploads', express.static(path.join(__dirname, 'public', 'uploads')));\r\n\r\n// Konfigurasi Session (Tanpa .env)\r\napp.use(session({\r\n  secret: 'kunci-rahasia-untuk-arenago-project', // Kunci rahasia\r\n  resave: false,\r\n  saveUninitialized: true,\r\n  cookie: {\r\n    secure: false, // Set 'true' jika pakai HTTPS\r\n    maxAge: 1000 * 60 * 60 * 24 // Cookie berlaku 1 hari\r\n  }\r\n}));\r\n\r\n// Konfigurasi Flash Message\r\napp.use(flash());\r\n\r\n// ============================\r\n// Pastikan folder upload ada\r\n// ============================\r\nconst fs = require('fs');\r\nconst uploadsDirs = [\r\n  path.join(__dirname, 'public', 'uploads'),\r\n  path.join(__dirname, 'public', 'uploads', 'arena'),\r\n  path.join(__dirname, 'public', 'uploads', 'bukti_pembayaran')\r\n];\r\n\r\nuploadsDirs.forEach(dir => {\r\n  try {\r\n    if (!fs.existsSync(dir)) {\r\n      fs.mkdirSync(dir, { recursive: true });\r\n      console.log('Membuat folder upload:', dir);\r\n    }\r\n  } catch (err) {\r\n    console.error('Gagal membuat folder uploads:', dir, err);\r\n  }\r\n});\r\n\r\n// [Middleware Global PENTING]\r\n// Mengirim pesan flash & info user ke SEMUA file .ejs\r\napp.use(async (req, res, next) => {\r\n  res.locals.success_msg = req.flash('success_msg');\r\n  res.locals.error_msg = req.flash('error_msg');\r\n  res.locals.user = req.session.user || null; // Info user yang login\r\n\r\n  // Jika user adalah pemain, ambil notifikasi (opsional)\r\n  if (req.session.user && req.session.user.role === 'pemain') {\r\n    const Model_Notifikasi = require('./models/Model_Notifikasi');\r\n    try {\r\n      res.locals.notifications = await Model_Notifikasi.getByUser(req.session.user.id);\r\n      res.locals.unreadCount = await Model_Notifikasi.getUnreadCount(req.session.user.id);\r\n    } catch (err) {\r\n      console.error('Error loading notifications:', err);\r\n      res.locals.notifications = [];\r\n      res.locals.unreadCount = 0;\r\n    }\r\n  } else {\r\n    res.locals.notifications = [];\r\n    res.locals.unreadCount = 0;\r\n  }\r\n\r\n  next();\r\n});\r\n\r\n// Pendaftaran Rute\r\napp.use('/', indexRouter);\r\napp.use('/auth', authRouter);\r\napp.use('/admin', adminRouter);\r\napp.use('/pemain', pemainRouter);\r\napp.use('/users', usersRouter); // Ini untuk CRUD Master User oleh Admin\r\napp.use('/arena', arenaRouter);\r\napp.use('/admin/reservasi', reservasiRouter);\r\napp.use('/jadwal', jadwalRouter);\r\napp.use('/venues', venuesRouter);\r\napp.use('/booking', bookingRouter);\r\napp.use('/foto', fotoRouter);\r\napp.use('/ulasan', ulasanRouter);\r\napp.use('/admin/pembayaran', pembayaranRouter);\r\napp.use('/notifikasi', notifikasiRouter);\r\n\r\n// catch 404 and forward to error handler\r\napp.use(function(req, res, next) {\r\n  next(createError(404));\r\n});\r\n\r\n// error handler\r\napp.use(function(err, req, res, next) {\r\n  // set locals, only providing error in development\r\n  res.locals.message = err.message;\r\n  res.locals.error = req.app.get('env') === 'development' ? err : {};\r\n\r\n  // render the error page\r\n  res.status(err.status || 500);\r\n  res.render('error', { title: 'Error' });\r\n});\r\n\r\nconst cron = require('node-cron');\r\nconst Model_Reservasi = require('./models/Model_Reservasi');\r\n\r\n// Jalankan setiap 1 menit\r\ncron.schedule('* * * * *', async () => {\r\n  try {\r\n    await Model_Reservasi.autoUpdateStatus();\r\n    console.log('Auto update status selesai -', new Date());\r\n  } catch (err) {\r\n    console.error('Gagal auto update:', err);\r\n  }\r\n});\r\n\r\nmodule.exports = app;\r\n"]}