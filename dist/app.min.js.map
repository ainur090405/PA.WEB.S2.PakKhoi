{"version":3,"sources":["app.js"],"names":["createError","require","express","cookieParser","session","path","logger","usersRouter","adminRouter","flash","jadwalRouter","reservasiRouter","indexRouter","venuesRouter","fotoRouter","ulasanRouter","authRouter","notifikasiRouter","activityRouter","app","set","join","__dirname","use","json","arenaRouter","urlencoded","extended","bookingRouter","secret","resave","pembayaranRouter","saveUninitialized","cookie","secure","fs","forEach","dir","existsSync","recursive","log","err","maxAge","error","req","res","next","Model_Notifikasi","regeneratorRuntime","async","_context","prev","locals","success_msg","error_msg","user","uploadsDirs","role","awrap","getByUser","id","mkdirSync","sent","getUnreadCount","unreadCount","t0","console","notifications","stop","message","get","status","cron","Model_Reservasi","schedule","_context2","Date","module","exports"],"mappings":"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","file":"app.min.js","sourcesContent":["var createError = require('http-errors');\r\nvar express = require('express');\r\nvar path = require('path');\r\nvar cookieParser = require('cookie-parser');\r\nvar logger = require('morgan');\r\nvar session = require('express-session');\r\nvar flash = require('connect-flash');\r\n\r\n\r\n// Impor Rute\r\nvar indexRouter = require('./routes/index');\r\nvar usersRouter = require('./routes/users'); // Rute CRUD Master User\r\nvar authRouter = require('./routes/auth'); // Rute Login/Register\r\nvar adminRouter = require('./routes/admin'); // Rute Dashboard Admin\r\nvar pemainRouter = require('./routes/pemain'); // Rute Dashboard Pemain\r\nvar jadwalRouter = require('./routes/jadwal');\r\nconst reservasiRouter = require('./routes/reservasi');\r\nvar arenaRouter = require('./routes/arena');\r\nvar venuesRouter = require('./routes/venues');\r\nvar bookingRouter = require('./routes/booking');\r\nvar fotoRouter = require('./routes/foto');\r\nvar ulasanRouter = require('./routes/ulasan');\r\nvar pembayaranRouter = require('./routes/pembayaran');\r\nvar notifikasiRouter = require('./routes/notifikasi');\r\nconst activityRouter = require('./routes/activity');\r\n\r\n\r\nvar app = express();\r\n\r\n// view engine setup\r\napp.set('views', path.join(__dirname, 'views'));\r\napp.set('view engine', 'ejs');\r\n\r\napp.use(logger('dev'));\r\napp.use(express.json());\r\napp.use(express.urlencoded({ extended: false }));\r\napp.use(cookieParser());\r\n\r\n// Serve static files (including uploaded files under public/uploads)\r\napp.use(express.static(path.join(__dirname, 'public')));\r\napp.use('/uploads', express.static(path.join(__dirname, 'public', 'uploads')));\r\n\r\n// Konfigurasi Session (Tanpa .env)\r\napp.use(session({\r\n  secret: 'kunci-rahasia-untuk-arenago-project', // Kunci rahasia\r\n  resave: false,\r\n  saveUninitialized: true,\r\n  cookie: {\r\n    secure: false, // Set 'true' jika pakai HTTPS\r\n    maxAge: 1000 * 60 * 60 * 24 // Cookie berlaku 1 hari\r\n  }\r\n}));\r\n\r\n// Konfigurasi Flash Message\r\napp.use(flash());\r\n\r\n// ============================\r\n// Pastikan folder upload ada\r\n// ============================\r\nconst fs = require('fs');\r\nconst uploadsDirs = [\r\n  path.join(__dirname, 'public', 'uploads'),\r\n  path.join(__dirname, 'public', 'uploads', 'arena'),\r\n  path.join(__dirname, 'public', 'uploads', 'bukti_pembayaran')\r\n];\r\n\r\nuploadsDirs.forEach(dir => {\r\n  try {\r\n    if (!fs.existsSync(dir)) {\r\n      fs.mkdirSync(dir, { recursive: true });\r\n      console.log('Membuat folder upload:', dir);\r\n    }\r\n  } catch (err) {\r\n    console.error('Gagal membuat folder uploads:', dir, err);\r\n  }\r\n});\r\n\r\n// [Middleware Global PENTING]\r\n// Mengirim pesan flash & info user ke SEMUA file .ejs\r\napp.use(async (req, res, next) => {\r\n  res.locals.success_msg = req.flash('success_msg');\r\n  res.locals.error_msg = req.flash('error_msg');\r\n  res.locals.user = req.session.user || null; // Info user yang login\r\n\r\n  // Jika user adalah pemain, ambil notifikasi (opsional)\r\n  if (req.session.user && req.session.user.role === 'pemain') {\r\n    const Model_Notifikasi = require('./models/Model_Notifikasi');\r\n    try {\r\n      res.locals.notifications = await Model_Notifikasi.getByUser(req.session.user.id);\r\n      res.locals.unreadCount = await Model_Notifikasi.getUnreadCount(req.session.user.id);\r\n    } catch (err) {\r\n      console.error('Error loading notifications:', err);\r\n      res.locals.notifications = [];\r\n      res.locals.unreadCount = 0;\r\n    }\r\n  } else {\r\n    res.locals.notifications = [];\r\n    res.locals.unreadCount = 0;\r\n  }\r\n\r\n  next();\r\n});\r\n\r\n// Pendaftaran Rute\r\napp.use('/', indexRouter);\r\napp.use('/auth', authRouter);\r\napp.use('/admin', adminRouter);\r\napp.use('/pemain', pemainRouter);\r\napp.use('/users', usersRouter); // Ini untuk CRUD Master User oleh Admin\r\napp.use('/arena', arenaRouter);\r\napp.use('/admin/reservasi', reservasiRouter);\r\napp.use('/jadwal', jadwalRouter);\r\napp.use('/venues', venuesRouter);\r\napp.use('/booking', bookingRouter);\r\napp.use('/foto', fotoRouter);\r\napp.use('/ulasan', ulasanRouter);\r\napp.use('/admin/pembayaran', pembayaranRouter);\r\napp.use('/notifikasi', notifikasiRouter);\r\napp.use('/activity', activityRouter);\r\n\r\n\r\n// catch 404 and forward to error handler\r\napp.use(function(req, res, next) {\r\n  next(createError(404));\r\n});\r\n\r\n// error handler\r\napp.use(function(err, req, res, next) {\r\n  // set locals, only providing error in development\r\n  res.locals.message = err.message;\r\n  res.locals.error = req.app.get('env') === 'development' ? err : {};\r\n\r\n  // render the error page\r\n  res.status(err.status || 500);\r\n  res.render('error', { title: 'Error' });\r\n});\r\n\r\nconst cron = require('node-cron');\r\nconst Model_Reservasi = require('./models/Model_Reservasi');\r\n\r\n// Jalankan setiap 1 menit\r\ncron.schedule('* * * * *', async () => {\r\n  try {\r\n    await Model_Reservasi.autoUpdateStatus();\r\n    console.log('Auto update status selesai -', new Date());\r\n  } catch (err) {\r\n    console.error('Gagal auto update:', err);\r\n  }\r\n});\r\n\r\nmodule.exports = app;\r\n"]}