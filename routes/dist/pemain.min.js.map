{"version":3,"sources":["pemain.js"],"names":["express","require","router","Router","fs","path","PDFDocument","connection","Model_Jadwal","Model_Users","Model_Reservasi","Model_Ulasan","Model_Pembayaran","isAuthenticated","isPemain","uploadBuktiPembayaran","isBusy","autoUpdateStatus","regeneratorRuntime","async","_context","prev","next","abrupt","awrap","autoRejectNoProof","autoRejectLateConfirmed","console","log","concat","Date","toISOString","t0","error","finish","stop","setInterval","use","req","res","redirect","userId","_ref","_ref2","reservasiData","notifications","stats","_context2","user","id","Promise","all","getByUser","Model_Notifikasi","sent","_slicedToArray","totalBookings","length","activeBookings","filter","r","status","totalSpent","reduce","sum","pembayaran_jumlah","title","recentBookings","slice","flash","get","_ref3","_ref4","userData","ulasanData","_context3","session","getById","render","ulasan","reservasi","_context4","Store","id_user","id_reservasi","params","rating","body","komentar","post","_context5","_ref5","_ref6","_context6","parseInt","single","err","msg","reservasiRows","_context7","message","file","unlink","uploadBuktiByReservasi","filename","rows","pembayaran","_context8","pembayaran_metode","jumlah","status_pembayaran","pembayaran_status","status_bukti","pembayaran_status_bukti","tanggal_pembayaran","pembayaran_tanggal","bukti_pembayaran","pembayaran_bukti","catatan_admin","pembayaran_catatan","success","json","reason","_context9","skipped","rejectAndFreeSlot","Update","id_jadwal","status_slot","warn","setExpiredByReservasi","markRejectedByReservasi","judul","isi_pesan","nama_arena","jenis_notif","tipe","t1","buktiFilename","buktiPath","doc","metode","statusPemb","ext","imgBuffer","catatan","_context10","margin","autoFirstPage","setHeader","pipe","text","align","fontSize","moveDown","nama_user","tanggal","toLocaleDateString","jam_mulai","substring","jam_selesai","underline","Number","toLocaleString","existsSync","extname","toLowerCase","includes","addPage","image","fit","valign","fillColor","imgErr","metode_pembayaran","module","exports"],"mappings":"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","file":"pemain.min.js","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst fs = require('fs');\r\nconst path = require('path');\r\nconst PDFDocument = require('pdfkit');\r\nconst connection = require('../config/database');   // <== BARU\r\nconst Model_Jadwal = require('../models/Model_Jadwal'); // <== BARU\r\nconst Model_Users = require('../models/Model_Users');\r\nconst Model_Reservasi = require('../models/Model_Reservasi');\r\nconst Model_Ulasan = require('../models/Model_Ulasan');\r\nconst Model_Notifikasi = require('../models/Model_Notifikasi');\r\nconst Model_Pembayaran = require('../models/Model_Pembayaran');\r\n\r\nconst { isAuthenticated, isPemain } = require('../middleware/authMiddleware');\r\nconst { uploadBuktiPembayaran } = require('../middleware/uploadMiddleware');\r\n\r\nrouter.use(isAuthenticated, isPemain);\r\n\r\n// AUTO UPDATE STATUS (tetap sama)\r\nlet isBusy = false;\r\nasync function autoUpdateStatus() {\r\n  if (isBusy) return;\r\n  isBusy = true;\r\n  try {\r\n    await Model_Reservasi.autoUpdateStatus();\r\n    await Model_Pembayaran.autoRejectNoProof();       // ⬅️ auto tolak tanpa bukti\r\n    await Model_Pembayaran.autoRejectLateConfirmed(); // ⬅️ auto tolak belum dikonfirmasi\r\n    console.log(`AUTO UPDATE OK - ${new Date().toISOString()}`);\r\n  } catch (err) {\r\n    console.error('AUTO UPDATE ERROR:', err);\r\n  } finally {\r\n    isBusy = false;\r\n  }\r\n}\r\nsetInterval(autoUpdateStatus, 60 * 1000);\r\n\r\nrouter.use((req, res, next) => {\r\n  if (isBusy) {\r\n    req.flash('error_msg', 'Server sedang update, coba sebentar lagi.');\r\n    return res.redirect('back');\r\n  }\r\n  next();\r\n});\r\n\r\n// DASHBOARD\r\nrouter.get('/dashboard', async (req, res) => {\r\n  try {\r\n    const userId = req.session.user.id;\r\n\r\n    const [reservasiData, notifications] = await Promise.all([\r\n      Model_Reservasi.getByUser(userId),\r\n      Model_Notifikasi.getByUser(userId)\r\n    ]);\r\n\r\n    const stats = {\r\n      totalBookings: reservasiData.length,\r\n      activeBookings: reservasiData.filter(r => r.status === 'disetujui' || r.status === 'menunggu').length,\r\n      totalSpent: reservasiData.reduce((sum, r) => sum + (r.pembayaran_jumlah || 0), 0)\r\n    };\r\n\r\n    res.render('pemain/dashboard', {\r\n      title: 'Dashboard Pemain',\r\n      stats,\r\n      recentBookings: reservasiData.slice(0, 5),\r\n      notifications\r\n    });\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Gagal memuat dashboard.');\r\n    res.redirect('/');\r\n  }\r\n});\r\n\r\n// ========================\r\n// Profil\r\n// ========================\r\nrouter.get('/profile', async (req, res) => {\r\n  try {\r\n    const userId = req.session.user.id;\r\n\r\n    const [userData, ulasanData, reservasiData] = await Promise.all([\r\n      Model_Users.getById(userId),\r\n      Model_Ulasan.getByUser(userId),\r\n      Model_Reservasi.getByUser(userId)\r\n    ]);\r\n\r\n    if (!userData || userData.length === 0) {\r\n      req.flash('error_msg', 'User tidak ditemukan.');\r\n      return res.redirect('/pemain/dashboard');\r\n    }\r\n\r\n    res.render('pemain/profile', {\r\n      title: 'Profil Saya',\r\n      user: userData[0],\r\n      ulasan: ulasanData,\r\n      reservasi: reservasiData\r\n    });\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Gagal memuat halaman profil.');\r\n    res.redirect('/pemain/dashboard');\r\n  }\r\n});\r\n\r\n// ========================\r\n// CREATE ULASAN\r\n// ========================\r\nrouter.post('/ulasan/create/:id', async (req, res) => {\r\n  try {\r\n    await Model_Ulasan.Store({\r\n      id_user: req.session.user.id,\r\n      id_reservasi: req.params.id,\r\n      rating: req.body.rating,\r\n      komentar: req.body.komentar\r\n    });\r\n\r\n    req.flash('success_msg', 'Ulasan berhasil disimpan!');\r\n    res.redirect('/pemain/riwayat-ulasan');\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Gagal menyimpan ulasan');\r\n    res.redirect('/pemain/riwayat-ulasan');\r\n  }\r\n});\r\n\r\n// ========================\r\n// UPDATE ULASAN\r\n// ========================\r\nrouter.post('/ulasan/update/:id', async (req, res) => {\r\n  try {\r\n    await Model_Ulasan.UpdateByReservasi(req.params.id, {\r\n      rating: req.body.rating,\r\n      komentar: req.body.komentar\r\n    });\r\n\r\n    req.flash('success_msg', 'Ulasan berhasil diperbarui!');\r\n    res.redirect('/pemain/riwayat-ulasan');\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Gagal memperbarui ulasan');\r\n    res.redirect('/pemain/riwayat-ulasan');\r\n  }\r\n});\r\n\r\n// ========================\r\n// Halaman Riwayat\r\n// ========================\r\nrouter.get('/riwayat-ulasan', async (req, res) => {\r\n  try {\r\n    const userId = req.session.user.id;\r\n\r\n    const [userData, ulasanData, reservasiData] = await Promise.all([\r\n      Model_Users.getById(userId),\r\n      Model_Ulasan.getByUser(userId),\r\n      Model_Reservasi.getByUser(userId)\r\n    ]);\r\n\r\n    res.render('pemain/riwayat-ulasan', {\r\n      title: 'Riwayat & Ulasan',\r\n      user: userData[0] || null,\r\n      ulasan: ulasanData || [],\r\n      reservasi: reservasiData || []\r\n    });\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Gagal memuat halaman.');\r\n    res.redirect('/pemain/dashboard');\r\n  }\r\n});\r\n\r\nrouter.post('/upload-bukti/:id_reservasi', (req, res) => {\r\n  const id_reservasi = parseInt(req.params.id_reservasi, 10);\r\n  const userId = req.session.user.id;\r\n\r\n  uploadBuktiPembayaran.single('bukti_pembayaran')(req, res, async function (err) {\r\n    try {\r\n      if (err) {\r\n        console.error('MULTER ERROR:', err);\r\n        const msg = err.code === 'LIMIT_FILE_SIZE'\r\n          ? 'File terlalu besar (maks 5MB).'\r\n          : (err.message || 'Gagal mengupload file.');\r\n        req.flash('error_msg', msg);\r\n        return res.redirect('/pemain/riwayat-ulasan');\r\n      }\r\n\r\n      // validasi reservasi & owner\r\n      const reservasiRows = await Model_Reservasi.getById(id_reservasi);\r\n      if (!reservasiRows || reservasiRows.length === 0 || reservasiRows[0].id_user !== userId) {\r\n        if (req.file && req.file.path) fs.unlink(req.file.path, () => {});\r\n        req.flash('error_msg', 'Reservasi tidak valid atau tidak memiliki akses.');\r\n        return res.redirect('/pemain/riwayat-ulasan');\r\n      }\r\n\r\n      if (!req.file) {\r\n        req.flash('error_msg', 'Silakan pilih file bukti pembayaran.');\r\n        return res.redirect('/pemain/riwayat-ulasan');\r\n      }\r\n\r\n      // CUKUP: langsung simpan ke tabel pembayaran\r\n      await Model_Pembayaran.uploadBuktiByReservasi(id_reservasi, req.file.filename);\r\n\r\n      req.flash('success_msg', 'Bukti berhasil diupload! Menunggu konfirmasi admin.');\r\n      return res.redirect('/pemain/riwayat-ulasan');\r\n\r\n    } catch (catchErr) {\r\n      console.error('UPLOAD HANDLER ERROR:', catchErr);\r\n      if (req.file && req.file.path) fs.unlink(req.file.path, () => {});\r\n      req.flash('error_msg', 'Terjadi kesalahan saat mengupload bukti.');\r\n      return res.redirect('/pemain/riwayat-ulasan');\r\n    }\r\n  });\r\n});\r\n\r\n// ========================\r\n// DETAIL PEMBAYARAN (AJAX/modal)\r\n// ========================\r\nrouter.get('/detail-pembayaran/:id_reservasi', async (req, res) => {\r\n  try {\r\n    const id_reservasi = parseInt(req.params.id_reservasi, 10);\r\n    const userId = req.session.user.id;\r\n\r\n    const rows = await Model_Reservasi.getById(id_reservasi);\r\n    if (!rows || rows.length === 0 || rows[0].id_user !== userId) {\r\n      return res.json({ success: false, message: 'Akses ditolak' });\r\n    }\r\n\r\n    const r = rows[0];\r\n\r\n    const pembayaran = {\r\n      metode_pembayaran: r.pembayaran_metode,\r\n      jumlah: r.pembayaran_jumlah,\r\n      status_pembayaran: r.pembayaran_status,\r\n      status_bukti: r.pembayaran_status_bukti,\r\n      tanggal_pembayaran: r.pembayaran_tanggal,\r\n      bukti_pembayaran: r.pembayaran_bukti,\r\n      catatan_admin: r.pembayaran_catatan\r\n    };\r\n\r\n    return res.json({ success: true, pembayaran, reservasi: r });\r\n  } catch (err) {\r\n    console.error('Detail pembayaran error:', err);\r\n    return res.json({ success: false, message: 'Error server' });\r\n  }\r\n});\r\n\r\nrouter.post('/expire-upload/:id_reservasi', async (req, res) => {\r\n  try {\r\n    const id_reservasi = parseInt(req.params.id_reservasi, 10);\r\n    const userId = req.session.user.id;\r\n    const reason =\r\n      (req.body && req.body.reason) ||\r\n      'Batas waktu upload bukti pembayaran telah habis dan data tidak lengkap.';\r\n\r\n    const rows = await Model_Reservasi.getById(id_reservasi);\r\n    if (!rows || rows.length === 0 || rows[0].id_user !== userId) {\r\n      return res.status(403).json({ success: false, message: 'Akses ditolak' });\r\n    }\r\n\r\n    const r = rows[0];\r\n\r\n    // Kalau status bukan \"menunggu\" atau sudah ada bukti,\r\n    // berarti sudah diproses admin / user sudah upload → tidak usah apa-apa.\r\n    if (r.status !== 'menunggu' || r.pembayaran_bukti) {\r\n      return res.json({ success: true, skipped: true });\r\n    }\r\n\r\n    // 1) Update status reservasi → ditolak + kosongkan slot\r\n    if (typeof Model_Reservasi.rejectAndFreeSlot === 'function') {\r\n      // kalau kamu sudah buat helper ini di model, pakai ini\r\n      await Model_Reservasi.rejectAndFreeSlot(id_reservasi);\r\n    } else {\r\n      // fallback manual\r\n      await Model_Reservasi.Update(id_reservasi, { status: 'ditolak' });\r\n      if (r.id_jadwal) {\r\n        try {\r\n          await Model_Jadwal.Update(r.id_jadwal, { status_slot: 'kosong' });\r\n        } catch (e) {\r\n          console.warn('Gagal update jadwal saat expire-upload:', e);\r\n        }\r\n      }\r\n    }\r\n\r\n    // 2) Update status pembayaran kalau model-mu punya helper\r\n    if (typeof Model_Pembayaran.setExpiredByReservasi === 'function') {\r\n      await Model_Pembayaran.setExpiredByReservasi(id_reservasi, reason);\r\n    } else if (typeof Model_Pembayaran.markRejectedByReservasi === 'function') {\r\n      await Model_Pembayaran.markRejectedByReservasi(id_reservasi, reason);\r\n    }\r\n    // kalau helper itu belum ada, tidak error (cuma tidak update tabel pembayaran)\r\n\r\n    // 3) Kirim notifikasi ke pemain\r\n    if (r.id_user && typeof Model_Notifikasi.Store === 'function') {\r\n      await Model_Notifikasi.Store({\r\n        id_user: r.id_user,\r\n        judul: 'Pembayaran Ditolak (Waktu Upload Habis)',\r\n        isi_pesan: `Pembayaran Anda untuk arena ${\r\n          r.nama_arena || 'Arena'\r\n        } ditolak karena batas waktu upload bukti (20 menit) telah habis dan data pembayaran tidak lengkap.`,\r\n        jenis_notif: 'status',\r\n        tipe: 'payment',\r\n        dibaca: 0\r\n      });\r\n    }\r\n\r\n    return res.json({ success: true });\r\n  } catch (err) {\r\n    console.error('expire-upload error:', err);\r\n    return res.status(500).json({ success: false, message: 'Error server' });\r\n  }\r\n});\r\n\r\n// ========================\r\n// DOWNLOAD PDF PEMBAYARAN\r\n// ========================\r\nrouter.get('/download-pdf/:id_reservasi', async (req, res) => {\r\n  try {\r\n    const userId = req.session.user.id;\r\n    const id = parseInt(req.params.id_reservasi, 10);\r\n\r\n    const rows = await Model_Reservasi.getById(id);\r\n    if (!rows || rows.length === 0 || rows[0].id_user !== userId) {\r\n      req.flash('error_msg', 'Akses ditolak.');\r\n      return res.redirect('/pemain/riwayat-ulasan');\r\n    }\r\n\r\n    const r = rows[0];\r\n\r\n    const buktiFilename = r.pembayaran_bukti || null;\r\n    const buktiPath = buktiFilename\r\n      ? path.join(__dirname, '..', 'public', 'uploads', 'bukti_pembayaran', buktiFilename)\r\n      : null;\r\n\r\n    console.log('PDF download, bukti file =', buktiFilename);\r\n    console.log('Bukti path =', buktiPath);\r\n\r\n    const doc = new PDFDocument({ margin: 40, autoFirstPage: true });\r\n    const filename = `detail_pembayaran_${id}.pdf`;\r\n\r\n    res.setHeader('Content-Disposition', `attachment; filename=\"${filename}\"`);\r\n    res.setHeader('Content-Type', 'application/pdf');\r\n    doc.pipe(res);\r\n\r\n    // ========== HEADER ==========\r\n    doc.fontSize(18).text('Detail Pembayaran', { align: 'center' });\r\n    doc.moveDown(0.5);\r\n    doc.fontSize(10).text(`Tanggal Cetak: ${new Date().toLocaleString('id-ID')}`, { align: 'right' });\r\n    doc.moveDown(1);\r\n\r\n    // ========== INFORMASI RESERVASI ==========\r\n    doc.fontSize(12).text('Informasi Reservasi', { underline: true });\r\n    doc.moveDown(0.3);\r\n    doc.fontSize(11)\r\n      .text(`ID Reservasi : ${r.id_reservasi}`)\r\n      .text(`Pemesan      : ${r.nama_user || '-'}`)\r\n      .text(`Arena        : ${r.nama_arena || '-'}`)\r\n      .text(`Tanggal      : ${r.tanggal ? new Date(r.tanggal).toLocaleDateString('id-ID') : '-'}`)\r\n      .text(`Jam          : ${r.jam_mulai ? r.jam_mulai.substring(0,5) : '-'} - ${r.jam_selesai ? r.jam_selesai.substring(0,5) : '-'}`)\r\n      .text(`Status       : ${r.status || '-'}`)\r\n      .moveDown(0.8);\r\n\r\n    // ========== INFORMASI PEMBAYARAN ==========\r\n    doc.fontSize(12).text('Detail Pembayaran', { underline: true });\r\n    doc.moveDown(0.3);\r\n\r\n    const metode = r.pembayaran_metode || 'transaksi';\r\n    const jumlah = r.pembayaran_jumlah || 0;\r\n    const statusPemb = r.pembayaran_status || '-';\r\n\r\n    doc.fontSize(11)\r\n      .text(`Metode Pembayaran : ${metode}`)\r\n      .text(`Jumlah            : Rp ${Number(jumlah).toLocaleString('id-ID')}`)\r\n      .text(`Status Pembayaran : ${statusPemb}`)\r\n      .text(`Tanggal Pembayaran: ${r.pembayaran_tanggal ? new Date(r.pembayaran_tanggal).toLocaleString('id-ID') : '-'}`)\r\n      .moveDown(0.8);\r\n\r\n    // ========== REKENING TUJUAN (DUMMY / OPSIONAL) ==========\r\n    doc.fontSize(12).text('Rekening Tujuan', { underline: true });\r\n    doc.moveDown(0.3);\r\n    doc.fontSize(11)\r\n      .text(`Bank        : -`)\r\n      .text(`No. Rekening: -`)\r\n      .text(`Atas Nama   : -`)\r\n      .moveDown(0.8);\r\n\r\n    // ========== BUKTI PEMBAYARAN (GAMBAR) ==========\r\n    if (buktiPath && fs.existsSync(buktiPath)) {\r\n      try {\r\n        // cek ekstensi\r\n        const ext = path.extname(buktiFilename).toLowerCase();\r\n        console.log('Ekstensi bukti:', ext);\r\n\r\n        const allowedExt = ['.jpg', '.jpeg', '.png'];\r\n\r\n        if (!allowedExt.includes(ext)) {\r\n          // kalau format tidak didukung PDFKit\r\n          doc.addPage();\r\n          doc.fontSize(14).text('Bukti Pembayaran', { align: 'center' });\r\n          doc.moveDown(0.5);\r\n          doc\r\n            .fontSize(11)\r\n            .fillColor('red')\r\n            .text(`Format gambar bukti (${ext}) tidak didukung. Gunakan JPG/PNG untuk bisa muncul di PDF.`, {\r\n              align: 'center'\r\n            });\r\n          doc.fillColor('black');\r\n        } else {\r\n          // baca sebagai buffer\r\n          const imgBuffer = fs.readFileSync(buktiPath);\r\n\r\n          doc.addPage();\r\n          doc.fontSize(14).text('Bukti Pembayaran', { align: 'center' });\r\n          doc.moveDown(0.5);\r\n\r\n          doc.image(imgBuffer, {\r\n            fit: [450, 650],\r\n            align: 'center',\r\n            valign: 'center'\r\n          });\r\n        }\r\n      } catch (imgErr) {\r\n        console.error('Gagal sisipkan gambar ke PDF:', imgErr);\r\n        doc.addPage();\r\n        doc.fontSize(14).text('Bukti Pembayaran', { align: 'center' });\r\n        doc.moveDown(0.5);\r\n        doc\r\n          .fontSize(11)\r\n          .fillColor('red')\r\n          .text('Gagal memuat gambar bukti ke PDF.', { align: 'center' });\r\n        doc.fillColor('black');\r\n      }\r\n    } else {\r\n      // tidak ada file bukti\r\n      doc.moveDown(0.3);\r\n      doc.fontSize(10).fillColor('gray').text('Bukti pembayaran: -', { align: 'left' });\r\n      doc.fillColor('black');\r\n    }\r\n\r\n    // ========== CATATAN ADMIN ==========\r\n    const catatan = r.pembayaran_catatan || null;\r\n    if (catatan) {\r\n      doc.addPage();\r\n      doc.fontSize(12).text('Catatan Admin', { underline: true });\r\n      doc.moveDown(0.3);\r\n      doc.fontSize(11).text(catatan);\r\n    }\r\n\r\n    doc.end();\r\n  } catch (err) {\r\n    console.error('Download PDF error:', err);\r\n    req.flash('error_msg', 'Gagal membuat PDF. Silakan coba lagi.');\r\n    return res.redirect('/pemain/riwayat-ulasan');\r\n  }\r\n});\r\n\r\nmodule.exports = router;\r\n"]}