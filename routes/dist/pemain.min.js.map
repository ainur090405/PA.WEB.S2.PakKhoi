{"version":3,"sources":["pemain.js"],"names":["express","require","router","Router","fs","path","PDFDocument","Model_Users","Model_Reservasi","Model_Ulasan","Model_Notifikasi","uploadBuktiPembayaran","use","isAuthenticated","isPemain","autoUpdateStatus","regeneratorRuntime","async","_context","prev","next","abrupt","isBusy","awrap","Date","toISOString","t0","Model_Pembayaran","finish","stop","setInterval","req","res","redirect","get","userId","_ref","_ref2","reservasiData","notifications","stats","_context2","session","user","id","Promise","all","getByUser","sent","_slicedToArray","totalBookings","length","activeBookings","filter","r","status","reduce","sum","pembayaran_jumlah","render","title","console","slice","error","flash","_ref3","_ref4","userData","ulasanData","_context3","getById","ulasan","reservasi","post","_context4","Store","params","body","rating","komentar","totalSpent","_context5","UpdateByReservasi","_ref5","_ref6","_context6","parseInt","id_reservasi","single","err","msg","reservasiRows","_context7","message","id_user","file","unlink","uploadBuktiByReservasi","filename","rows","pembayaran","_context8","json","success","metode_pembayaran","pembayaran_metode","jumlah","status_pembayaran","pembayaran_status","status_bukti","pembayaran_status_bukti","tanggal_pembayaran","pembayaran_tanggal","bukti_pembayaran","pembayaran_bukti","catatan_admin","pembayaran_catatan","buktiFilename","buktiPath","doc","metode","statusPemb","catatan","_context9","join","__dirname","margin","autoFirstPage","concat","setHeader","pipe","text","moveDown","fontSize","toLocaleString","align","underline","nama_user","nama_arena","tanggal","toLocaleDateString","jam_mulai","substring","jam_selesai","Number","existsSync","image","fit","valign","imgErr","warn","fillColor","addPage","end","module","exports"],"mappings":"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","file":"pemain.min.js","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst fs = require('fs');\r\nconst path = require('path');\r\nconst PDFDocument = require('pdfkit');\r\n\r\nconst Model_Users = require('../models/Model_Users');\r\nconst Model_Reservasi = require('../models/Model_Reservasi');\r\nconst Model_Ulasan = require('../models/Model_Ulasan');\r\nconst Model_Notifikasi = require('../models/Model_Notifikasi');\r\nconst Model_Pembayaran = require('../models/Model_Pembayaran');\r\n\r\nconst { isAuthenticated, isPemain } = require('../middleware/authMiddleware');\r\nconst { uploadBuktiPembayaran } = require('../middleware/uploadMiddleware');\r\n\r\nrouter.use(isAuthenticated, isPemain);\r\n\r\n// AUTO UPDATE STATUS (tetap sama)\r\nlet isBusy = false;\r\nasync function autoUpdateStatus() {\r\n  if (isBusy) return;\r\n  isBusy = true;\r\n  try {\r\n    await Model_Reservasi.autoUpdateStatus();\r\n    console.log(`AUTO UPDATE OK - ${new Date().toISOString()}`);\r\n  } catch (err) {\r\n    console.error('AUTO UPDATE ERROR:', err);\r\n  } finally {\r\n    isBusy = false;\r\n  }\r\n}\r\nsetInterval(autoUpdateStatus, 60 * 1000);\r\n\r\nrouter.use((req, res, next) => {\r\n  if (isBusy) {\r\n    req.flash('error_msg', 'Server sedang update, coba sebentar lagi.');\r\n    return res.redirect('back');\r\n  }\r\n  next();\r\n});\r\n\r\n// DASHBOARD\r\nrouter.get('/dashboard', async (req, res) => {\r\n  try {\r\n    const userId = req.session.user.id;\r\n\r\n    const [reservasiData, notifications] = await Promise.all([\r\n      Model_Reservasi.getByUser(userId),\r\n      Model_Notifikasi.getByUser(userId)\r\n    ]);\r\n\r\n    const stats = {\r\n      totalBookings: reservasiData.length,\r\n      activeBookings: reservasiData.filter(r => r.status === 'disetujui' || r.status === 'menunggu').length,\r\n      totalSpent: reservasiData.reduce((sum, r) => sum + (r.pembayaran_jumlah || 0), 0)\r\n    };\r\n\r\n    res.render('pemain/dashboard', {\r\n      title: 'Dashboard Pemain',\r\n      stats,\r\n      recentBookings: reservasiData.slice(0, 5),\r\n      notifications\r\n    });\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Gagal memuat dashboard.');\r\n    res.redirect('/');\r\n  }\r\n});\r\n\r\n// ========================\r\n// Profil\r\n// ========================\r\nrouter.get('/profile', async (req, res) => {\r\n  try {\r\n    const userId = req.session.user.id;\r\n\r\n    const [userData, ulasanData, reservasiData] = await Promise.all([\r\n      Model_Users.getById(userId),\r\n      Model_Ulasan.getByUser(userId),\r\n      Model_Reservasi.getByUser(userId)\r\n    ]);\r\n\r\n    if (!userData || userData.length === 0) {\r\n      req.flash('error_msg', 'User tidak ditemukan.');\r\n      return res.redirect('/pemain/dashboard');\r\n    }\r\n\r\n    res.render('pemain/profile', {\r\n      title: 'Profil Saya',\r\n      user: userData[0],\r\n      ulasan: ulasanData,\r\n      reservasi: reservasiData\r\n    });\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Gagal memuat halaman profil.');\r\n    res.redirect('/pemain/dashboard');\r\n  }\r\n});\r\n\r\n// ========================\r\n// CREATE ULASAN\r\n// ========================\r\nrouter.post('/ulasan/create/:id', async (req, res) => {\r\n  try {\r\n    await Model_Ulasan.Store({\r\n      id_user: req.session.user.id,\r\n      id_reservasi: req.params.id,\r\n      rating: req.body.rating,\r\n      komentar: req.body.komentar\r\n    });\r\n\r\n    req.flash('success_msg', 'Ulasan berhasil disimpan!');\r\n    res.redirect('/pemain/riwayat-ulasan');\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Gagal menyimpan ulasan');\r\n    res.redirect('/pemain/riwayat-ulasan');\r\n  }\r\n});\r\n\r\n// ========================\r\n// UPDATE ULASAN\r\n// ========================\r\nrouter.post('/ulasan/update/:id', async (req, res) => {\r\n  try {\r\n    await Model_Ulasan.UpdateByReservasi(req.params.id, {\r\n      rating: req.body.rating,\r\n      komentar: req.body.komentar\r\n    });\r\n\r\n    req.flash('success_msg', 'Ulasan berhasil diperbarui!');\r\n    res.redirect('/pemain/riwayat-ulasan');\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Gagal memperbarui ulasan');\r\n    res.redirect('/pemain/riwayat-ulasan');\r\n  }\r\n});\r\n\r\n// ========================\r\n// Halaman Riwayat\r\n// ========================\r\nrouter.get('/riwayat-ulasan', async (req, res) => {\r\n  try {\r\n    const userId = req.session.user.id;\r\n\r\n    const [userData, ulasanData, reservasiData] = await Promise.all([\r\n      Model_Users.getById(userId),\r\n      Model_Ulasan.getByUser(userId),\r\n      Model_Reservasi.getByUser(userId)\r\n    ]);\r\n\r\n    res.render('pemain/riwayat-ulasan', {\r\n      title: 'Riwayat & Ulasan',\r\n      user: userData[0] || null,\r\n      ulasan: ulasanData || [],\r\n      reservasi: reservasiData || []\r\n    });\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Gagal memuat halaman.');\r\n    res.redirect('/pemain/dashboard');\r\n  }\r\n});\r\n\r\nrouter.post('/upload-bukti/:id_reservasi', (req, res) => {\r\n  const id_reservasi = parseInt(req.params.id_reservasi, 10);\r\n  const userId = req.session.user.id;\r\n\r\n  uploadBuktiPembayaran.single('bukti_pembayaran')(req, res, async function (err) {\r\n    try {\r\n      if (err) {\r\n        console.error('MULTER ERROR:', err);\r\n        const msg = err.code === 'LIMIT_FILE_SIZE'\r\n          ? 'File terlalu besar (maks 5MB).'\r\n          : (err.message || 'Gagal mengupload file.');\r\n        req.flash('error_msg', msg);\r\n        return res.redirect('/pemain/riwayat-ulasan');\r\n      }\r\n\r\n      // validasi reservasi & owner\r\n      const reservasiRows = await Model_Reservasi.getById(id_reservasi);\r\n      if (!reservasiRows || reservasiRows.length === 0 || reservasiRows[0].id_user !== userId) {\r\n        if (req.file && req.file.path) fs.unlink(req.file.path, () => {});\r\n        req.flash('error_msg', 'Reservasi tidak valid atau tidak memiliki akses.');\r\n        return res.redirect('/pemain/riwayat-ulasan');\r\n      }\r\n\r\n      if (!req.file) {\r\n        req.flash('error_msg', 'Silakan pilih file bukti pembayaran.');\r\n        return res.redirect('/pemain/riwayat-ulasan');\r\n      }\r\n\r\n      // CUKUP: langsung simpan ke tabel pembayaran\r\n      await Model_Pembayaran.uploadBuktiByReservasi(id_reservasi, req.file.filename);\r\n\r\n      req.flash('success_msg', 'Bukti berhasil diupload! Menunggu konfirmasi admin.');\r\n      return res.redirect('/pemain/riwayat-ulasan');\r\n\r\n    } catch (catchErr) {\r\n      console.error('UPLOAD HANDLER ERROR:', catchErr);\r\n      if (req.file && req.file.path) fs.unlink(req.file.path, () => {});\r\n      req.flash('error_msg', 'Terjadi kesalahan saat mengupload bukti.');\r\n      return res.redirect('/pemain/riwayat-ulasan');\r\n    }\r\n  });\r\n});\r\n\r\n// ========================\r\n// DETAIL PEMBAYARAN (AJAX/modal)\r\n// ========================\r\nrouter.get('/detail-pembayaran/:id_reservasi', async (req, res) => {\r\n  try {\r\n    const id_reservasi = parseInt(req.params.id_reservasi, 10);\r\n    const userId = req.session.user.id;\r\n\r\n    const rows = await Model_Reservasi.getById(id_reservasi);\r\n    if (!rows || rows.length === 0 || rows[0].id_user !== userId) {\r\n      return res.json({ success: false, message: 'Akses ditolak' });\r\n    }\r\n\r\n    const r = rows[0];\r\n\r\n    const pembayaran = {\r\n      metode_pembayaran: r.pembayaran_metode,\r\n      jumlah: r.pembayaran_jumlah,\r\n      status_pembayaran: r.pembayaran_status,\r\n      status_bukti: r.pembayaran_status_bukti,\r\n      tanggal_pembayaran: r.pembayaran_tanggal,\r\n      bukti_pembayaran: r.pembayaran_bukti,\r\n      catatan_admin: r.pembayaran_catatan\r\n    };\r\n\r\n    return res.json({ success: true, pembayaran, reservasi: r });\r\n  } catch (err) {\r\n    console.error('Detail pembayaran error:', err);\r\n    return res.json({ success: false, message: 'Error server' });\r\n  }\r\n});\r\n\r\n// ========================\r\n// DOWNLOAD PDF PEMBAYARAN\r\n// ========================\r\nrouter.get('/download-pdf/:id_reservasi', async (req, res) => {\r\n  try {\r\n    const userId = req.session.user.id;\r\n    const id = parseInt(req.params.id_reservasi, 10);\r\n\r\n    const rows = await Model_Reservasi.getById(id);\r\n    if (!rows || rows.length === 0 || rows[0].id_user !== userId) {\r\n      req.flash('error_msg', 'Akses ditolak.');\r\n      return res.redirect('/pemain/riwayat-ulasan');\r\n    }\r\n\r\n    const r = rows[0];\r\n\r\n    const buktiFilename = r.pembayaran_bukti || null;\r\n    const buktiPath = buktiFilename\r\n      ? path.join(__dirname, '..', 'public', 'uploads', 'bukti_pembayaran', buktiFilename)\r\n      : null;\r\n\r\n    const doc = new PDFDocument({ margin: 40, autoFirstPage: true });\r\n    const filename = `detail_pembayaran_${id}.pdf`;\r\n    res.setHeader('Content-Disposition', `attachment; filename=\"${filename}\"`);\r\n    res.setHeader('Content-Type', 'application/pdf');\r\n    doc.pipe(res);\r\n\r\n    // Header\r\n    doc.fontSize(18).text('Detail Pembayaran', { align: 'center' });\r\n    doc.moveDown(0.5);\r\n    doc.fontSize(10).text(`Tanggal Cetak: ${new Date().toLocaleString('id-ID')}`, { align: 'right' });\r\n    doc.moveDown(1);\r\n\r\n    // Informasi reservasi\r\n    doc.fontSize(12).text('Informasi Reservasi', { underline: true });\r\n    doc.moveDown(0.3);\r\n    doc.fontSize(11)\r\n      .text(`ID Reservasi: ${r.id_reservasi}`)\r\n      .text(`Pemesan     : ${r.nama_user || '-'}`)\r\n      .text(`Arena       : ${r.nama_arena || '-'}`)\r\n      .text(`Tanggal     : ${r.tanggal ? new Date(r.tanggal).toLocaleDateString('id-ID') : '-'}`)\r\n      .text(`Jam         : ${r.jam_mulai ? r.jam_mulai.substring(0,5) : '-'} - ${r.jam_selesai ? r.jam_selesai.substring(0,5) : '-'}`)\r\n      .text(`Status      : ${r.status || '-'}`)\r\n      .moveDown(0.8);\r\n\r\n    // Informasi pembayaran\r\n    doc.fontSize(12).text('Detail Pembayaran', { underline: true });\r\n    doc.moveDown(0.3);\r\n    const metode = r.pembayaran_metode || 'transaksi';\r\n    const jumlah = r.pembayaran_jumlah || 0;\r\n    const statusPemb = r.pembayaran_status || '-';\r\n    doc.fontSize(11)\r\n      .text(`Metode Pembayaran : ${metode}`)\r\n      .text(`Jumlah            : Rp ${Number(jumlah).toLocaleString('id-ID')}`)\r\n      .text(`Status Pembayaran : ${statusPemb}`)\r\n      .text(`Tanggal Pembayaran: ${r.pembayaran_tanggal ? new Date(r.pembayaran_tanggal).toLocaleString('id-ID') : '-'}`)\r\n      .moveDown(0.8);\r\n\r\n    // Rekening tujuan â€” opsional, kalau nanti kamu isi di tabel pembayaran\r\n    doc.fontSize(12).text('Rekening Tujuan', { underline: true });\r\n    doc.moveDown(0.3);\r\n    doc.fontSize(11)\r\n      .text(`Bank        : -`)\r\n      .text(`No. Rekening: -`)\r\n      .text(`Atas Nama   : -`)\r\n      .moveDown(0.8);\r\n\r\n    // Bukti pembayaran (gambar)\r\n    if (buktiPath && fs.existsSync(buktiPath)) {\r\n      try {\r\n        doc.addPage();\r\n        doc.fontSize(14).text('Bukti Pembayaran', { align: 'center' });\r\n        doc.moveDown(0.5);\r\n        doc.image(buktiPath, {\r\n          fit: [450, 650],\r\n          align: 'center',\r\n          valign: 'center'\r\n        });\r\n        doc.moveDown(0.5);\r\n      } catch (imgErr) {\r\n        console.warn('Gagal sisipkan gambar ke PDF:', imgErr);\r\n        doc.moveDown(0.5);\r\n        doc.fontSize(10).fillColor('red').text('Gagal memuat gambar bukti ke PDF.', { align: 'center' });\r\n        doc.fillColor('black');\r\n      }\r\n    } else {\r\n      doc.moveDown(0.3);\r\n      doc.fontSize(10).fillColor('gray').text('Bukti pembayaran: -', { align: 'left' });\r\n      doc.fillColor('black');\r\n    }\r\n\r\n    // Catatan admin\r\n    const catatan = r.pembayaran_catatan || null;\r\n    if (catatan) {\r\n      doc.addPage();\r\n      doc.fontSize(12).text('Catatan Admin', { underline: true });\r\n      doc.moveDown(0.3);\r\n      doc.fontSize(11).text(catatan);\r\n    }\r\n\r\n    doc.end();\r\n  } catch (err) {\r\n    console.error('Download PDF error:', err);\r\n    req.flash('error_msg', 'Gagal membuat PDF. Silakan coba lagi.');\r\n    return res.redirect('/pemain/riwayat-ulasan');\r\n  }\r\n});\r\n\r\nmodule.exports = router;\r\n"]}