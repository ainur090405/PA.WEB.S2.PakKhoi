"use strict";var express=require("express"),router=express.Router(),Model_Pembayaran=require("../models/Model_Pembayaran"),Model_Reservasi=require("../models/Model_Reservasi"),_require=require("../middleware/authMiddleware"),isAuthenticated=_require.isAuthenticated,isAdmin=_require.isAdmin;router.use(isAuthenticated,isAdmin),router.get("/",function(a,r){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(Model_Pembayaran.getPendingPayments());case 3:n=e.sent,r.render("admin/pembayaran/index",{title:"Konfirmasi Pembayaran",data:n}),e.next=12;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0),a.flash("error_msg","Gagal memuat data pembayaran."),r.redirect("/admin/dashboard");case 12:case"end":return e.stop()}},null,null,[[0,7]])}),router.post("/confirm/:id",function(a,r){var n,t,i,s,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=a.params.id,t=a.body.catatan_admin,e.next=5,regeneratorRuntime.awrap(Model_Pembayaran.confirmPayment(n,"confirmed",t));case 5:return e.next=7,regeneratorRuntime.awrap(Model_Pembayaran.getById(n));case 7:if(0<(i=e.sent).length)return e.next=11,regeneratorRuntime.awrap(Model_Reservasi.Update(i[0].id_reservasi,{status:"disetujui"}));e.next=15;break;case 11:return s=require("../models/Model_Notifikasi_new"),o={id_user:i[0].id_user,judul:"Pembayaran Dikonfirmasi",pesan:"Pembayaran Anda untuk arena ".concat(i[0].nama_arena," telah dikonfirmasi."),tipe:"payment",dibaca:0},e.next=15,regeneratorRuntime.awrap(s.Store(o));case 15:a.flash("success_msg","Pembayaran berhasil dikonfirmasi."),r.redirect("/admin/pembayaran"),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(0),console.error(e.t0),a.flash("error_msg","Gagal mengkonfirmasi pembayaran."),r.redirect("/admin/pembayaran");case 24:case"end":return e.stop()}},null,null,[[0,19]])}),router.post("/reject/:id",function(a,r){var n,t,i,s,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=a.params.id,t=a.body.catatan_admin,e.next=5,regeneratorRuntime.awrap(Model_Pembayaran.confirmPayment(n,"rejected",t));case 5:return e.next=7,regeneratorRuntime.awrap(Model_Pembayaran.getById(n));case 7:if(0<(i=e.sent).length)return e.next=11,regeneratorRuntime.awrap(Model_Reservasi.Update(i[0].id_reservasi,{status:"ditolak"}));e.next=15;break;case 11:return s=require("../models/Model_Notifikasi_new"),o={id_user:i[0].id_user,judul:"Pembayaran Ditolak",pesan:"Pembayaran Anda untuk arena ".concat(i[0].nama_arena," ditolak. ").concat(t),tipe:"payment",dibaca:0},e.next=15,regeneratorRuntime.awrap(s.Store(o));case 15:a.flash("error_msg","Pembayaran berhasil ditolak."),r.redirect("/admin/pembayaran"),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(0),console.error(e.t0),a.flash("error_msg","Gagal menolak pembayaran."),r.redirect("/admin/pembayaran");case 24:case"end":return e.stop()}},null,null,[[0,19]])}),module.exports=router;
//# sourceMappingURL=pembayaran_new.min.js.map
