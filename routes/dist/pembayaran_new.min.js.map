{"version":3,"sources":["pembayaran_new.js"],"names":["express","require","router","Router","Model_Reservasi","use","isAuthenticated","isAdmin","get","req","res","getPendingPayments","render","title","data","console","error","_context","t0","flash","redirect","post","id_pembayaran","catatan_admin","pembayaranData","Model_Notifikasi","notifData","regeneratorRuntime","async","_context2","prev","next","params","id","pembayaran","body","awrap","Model_Pembayaran","getById","sent","length","Update","id_reservasi","status","id_user","judul","pesan","concat","nama_arena","tipe","dibaca","Store","stop","_context3","confirmPayment","module","exports"],"mappings":"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","file":"pembayaran_new.min.js","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst Model_Pembayaran = require('../models/Model_Pembayaran');\r\nconst Model_Reservasi = require('../models/Model_Reservasi');\r\nconst { isAuthenticated, isAdmin } = require('../middleware/authMiddleware');\r\n\r\n// Lindungi semua rute, hanya Admin\r\nrouter.use(isAuthenticated, isAdmin);\r\n\r\n// GET: Tampilkan daftar pembayaran yang pending\r\nrouter.get('/', async (req, res) => {\r\n  try {\r\n    const pembayaran = await Model_Pembayaran.getPendingPayments();\r\n    res.render('admin/pembayaran/index', {\r\n      title: 'Konfirmasi Pembayaran',\r\n      data: pembayaran\r\n    });\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Gagal memuat data pembayaran.');\r\n    res.redirect('/admin/dashboard');\r\n  }\r\n});\r\n\r\n// POST: Konfirmasi pembayaran\r\nrouter.post('/confirm/:id', async (req, res) => {\r\n  try {\r\n    const id_pembayaran = req.params.id;\r\n    const { catatan_admin } = req.body;\r\n\r\n    // Konfirmasi pembayaran\r\n    await Model_Pembayaran.confirmPayment(id_pembayaran, 'confirmed', catatan_admin);\r\n\r\n    // Update status reservasi menjadi 'disetujui' jika pembayaran dikonfirmasi\r\n    const pembayaranData = await Model_Pembayaran.getById(id_pembayaran);\r\n    if (pembayaranData.length > 0) {\r\n      await Model_Reservasi.Update(pembayaranData[0].id_reservasi, { status: 'disetujui' });\r\n\r\n      // Kirim notifikasi ke pemain\r\n      const Model_Notifikasi = require('../models/Model_Notifikasi_new');\r\n      const notifData = {\r\n        id_user: pembayaranData[0].id_user,\r\n        judul: 'Pembayaran Dikonfirmasi',\r\n        pesan: `Pembayaran Anda untuk arena ${pembayaranData[0].nama_arena} telah dikonfirmasi.`,\r\n        tipe: 'payment',\r\n        dibaca: 0\r\n      };\r\n      await Model_Notifikasi.Store(notifData);\r\n    }\r\n\r\n    req.flash('success_msg', 'Pembayaran berhasil dikonfirmasi.');\r\n    res.redirect('/admin/pembayaran');\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Gagal mengkonfirmasi pembayaran.');\r\n    res.redirect('/admin/pembayaran');\r\n  }\r\n});\r\n\r\n// POST: Tolak pembayaran\r\nrouter.post('/reject/:id', async (req, res) => {\r\n  try {\r\n    const id_pembayaran = req.params.id;\r\n    const { catatan_admin } = req.body;\r\n\r\n    // Update status pembayaran menjadi 'rejected'\r\n    await Model_Pembayaran.confirmPayment(id_pembayaran, 'rejected', catatan_admin);\r\n\r\n    // Update status reservasi menjadi 'ditolak'\r\n    const pembayaranData = await Model_Pembayaran.getById(id_pembayaran);\r\n    if (pembayaranData.length > 0) {\r\n      await Model_Reservasi.Update(pembayaranData[0].id_reservasi, { status: 'ditolak' });\r\n\r\n      // Kirim notifikasi ke pemain\r\n      const Model_Notifikasi = require('../models/Model_Notifikasi_new');\r\n      const notifData = {\r\n        id_user: pembayaranData[0].id_user,\r\n        judul: 'Pembayaran Ditolak',\r\n        pesan: `Pembayaran Anda untuk arena ${pembayaranData[0].nama_arena} ditolak. ${catatan_admin}`,\r\n        tipe: 'payment',\r\n        dibaca: 0\r\n      };\r\n      await Model_Notifikasi.Store(notifData);\r\n    }\r\n\r\n    req.flash('error_msg', 'Pembayaran berhasil ditolak.');\r\n    res.redirect('/admin/pembayaran');\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Gagal menolak pembayaran.');\r\n    res.redirect('/admin/pembayaran');\r\n  }\r\n});\r\n\r\nmodule.exports = router;\r\n"]}