{"version":3,"sources":["arena.js"],"names":["express","require","router","Router","Model_Arena","Model_FotoArena","isAuthenticated","isAdmin","fs","path","use","get","req","res","getAll","arena","render","title","data","flash","redirect","post","body","nama_arena","jenis_olahraga","lokasi","harga","jam_buka","jam_tutup","status","dataArena","Store","result","newArenaId","insertId","code","getById","params","id","length","dataUpdate","Update","getByArenaId","fotoList","forEach","foto","url_foto","filePath","join","__dirname","existsSync","unlinkSync","Delete","json","message","console","error","module","exports"],"mappings":"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","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst Model_Arena = require('../models/Model_Arena');\r\nconst Model_FotoArena = require('../models/Model_FotoArena'); // Kita perlu ini untuk Hapus\r\nconst { isAuthenticated, isAdmin } = require('../middleware/authMiddleware');\r\nconst fs = require('fs'); // Kita perlu ini untuk Hapus\r\nconst path = require('path'); // Kita perlu ini untuk Hapus\r\n\r\n// HAPUS: 'upload' (multer) sudah tidak dipakai di sini\r\n\r\nrouter.use(isAuthenticated, isAdmin);\r\n\r\n// GET: Menampilkan daftar arena\r\nrouter.get('/', async (req, res) => {\r\n  try {\r\n    const arena = await Model_Arena.getAll();\r\n    res.render('admin/arena/index', {\r\n      title: 'Manajemen Arena',\r\n      data: arena\r\n    });\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal memuat data arena.');\r\n    res.redirect('/admin/dashboard');\r\n  }\r\n});\r\n\r\n// GET: Form tambah arena\r\nrouter.get('/create', (req, res) => {\r\n  res.render('admin/arena/create', { title: 'Tambah Arena Baru' });\r\n});\r\n\r\n// POST: Simpan arena baru (Sudah Benar)\r\nrouter.post('/store', async (req, res) => {\r\n  try {\r\n    const { nama_arena, jenis_olahraga, lokasi, harga, jam_buka, jam_tutup, status } = req.body;\r\n    let dataArena = { nama_arena, jenis_olahraga, lokasi, harga, jam_buka, jam_tutup, status };\r\n    const result = await Model_Arena.Store(dataArena);\r\n    const newArenaId = result.insertId; \r\n    req.flash('success_msg', 'Arena baru berhasil ditambahkan. Sekarang, silakan upload foto galeri.');\r\n    res.redirect(`/foto/manage/${newArenaId}`); \r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal menyimpan arena: ' + err.code);\r\n    res.redirect('/arena/create');\r\n  }\r\n});\r\n\r\n// GET: Form edit arena (Sudah Benar)\r\nrouter.get('/edit/:id', async (req, res) => {\r\n  try {\r\n    const arena = await Model_Arena.getById(req.params.id);\r\n    if (arena.length === 0) {\r\n      req.flash('error_msg', 'Arena tidak ditemukan.');\r\n      return res.redirect('/arena');\r\n    }\r\n    res.render('admin/arena/edit', {\r\n      title: 'Edit Arena',\r\n      arena: arena[0]\r\n    });\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal memuat data arena.');\r\n    res.redirect('/arena');\r\n  }\r\n});\r\n\r\n// ===================================\r\n// POST: Update arena (INI PERBAIKANNYA)\r\n// ===================================\r\nrouter.post('/update/:id', async (req, res) => {\r\n  const id = req.params.id;\r\n  try {\r\n    // 1. Ambil data teks dari form\r\n    const { nama_arena, jenis_olahraga, lokasi, harga, jam_buka, jam_tutup, status } = req.body;\r\n    \r\n    // 2. Buat variabel dengan nama yang benar (misal: 'dataUpdate')\r\n    let dataUpdate = { nama_arena, jenis_olahraga, lokasi, harga, jam_buka, jam_tutup, status };\r\n\r\n    // 3. Kirim variabel 'dataUpdate' ke model\r\n    await Model_Arena.Update(id, dataUpdate); // <-- DIUBAH\r\n    \r\n    req.flash('success_msg', 'Data arena berhasil diperbarui.');\r\n    res.redirect('/arena');\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal memperbarui arena: ' + err.code);\r\n    res.redirect('/arena/edit/' + id);\r\n  }\r\n});\r\n// ===================================\r\n// AKHIR PERBAIKAN\r\n// ===================================\r\n\r\n// GET: Hapus arena (Sudah Benar)\r\nrouter.get('/delete/:id', async (req, res) => {\r\n  const id = req.params.id;\r\n  try {\r\n    const fotoList = await Model_FotoArena.getByArenaId(id);\r\n    if (fotoList.length > 0) {\r\n      fotoList.forEach(foto => {\r\n        if (foto.url_foto) {\r\n          const filePath = path.join(__dirname, '../public', foto.url_foto);\r\n          if (fs.existsSync(filePath)) {\r\n            fs.unlinkSync(filePath); \r\n          }\r\n        }\r\n      });\r\n    }\r\n    await Model_Arena.Delete(id);\r\n    req.flash('success_msg', 'Data arena dan semua fotonya berhasil dihapus.');\r\n    res.redirect('/arena');\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal menghapus arena: ' + err.code);\r\n    res.redirect('/arena');\r\n  }\r\n});\r\n\r\nrouter.get('/api/:id', async (req, res) => {\r\n  try {\r\n    const arena = await Model_Arena.getById(req.params.id);\r\n    if (arena.length > 0) {\r\n      return res.json(arena[0]); // ✅ gunakan return untuk hentikan eksekusi setelah kirim respons\r\n    } else {\r\n      return res.status(404).json({ message: 'Arena tidak ditemukan' });\r\n    }\r\n  } catch (err) {\r\n    console.error('Error API /arena/api/:id:', err);\r\n    return res.status(500).json({ message: 'Terjadi kesalahan server' });\r\n  }\r\n});\r\n\r\nmodule.exports = router;"],"file":"arena.dev.js"}