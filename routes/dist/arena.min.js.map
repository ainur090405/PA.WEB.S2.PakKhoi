{"version":3,"sources":["arena.js"],"names":["express","require","router","Router","Model_FotoArena","fs","Model_Arena","use","isAuthenticated","isAdmin","arena","regeneratorRuntime","async","_context","prev","next","awrap","getAll","sent","res","render","title","path","t0","req","flash","stop","get","post","_req$body","nama_arena","jenis_olahraga","lokasi","harga","jam_buka","jam_tutup","status","dataArena","result","newArenaId","_context2","body","Store","insertId","data","redirect","concat","code","_context3","getById","params","id","length","abrupt","_req$body2","dataUpdate","_context4","fotoList","_context5","getByArenaId","foto","url_foto","filePath","join","__dirname","existsSync","unlinkSync","Delete","_context6","json","message","console","error"],"mappings":"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","file":"arena.min.js","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst Model_Arena = require('../models/Model_Arena');\r\nconst Model_FotoArena = require('../models/Model_FotoArena'); // Kita perlu ini untuk Hapus\r\nconst { isAuthenticated, isAdmin } = require('../middleware/authMiddleware');\r\nconst fs = require('fs'); // Kita perlu ini untuk Hapus\r\nconst path = require('path'); // Kita perlu ini untuk Hapus\r\n\r\n// HAPUS: 'upload' (multer) sudah tidak dipakai di sini\r\n\r\nrouter.use(isAuthenticated, isAdmin);\r\n\r\n// GET: Menampilkan daftar arena\r\nrouter.get('/', async (req, res) => {\r\n  try {\r\n    const arena = await Model_Arena.getAll();\r\n    res.render('admin/arena/index', {\r\n      title: 'Manajemen Arena',\r\n      data: arena\r\n    });\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal memuat data arena.');\r\n    res.redirect('/admin/dashboard');\r\n  }\r\n});\r\n\r\n// GET: Form tambah arena\r\nrouter.get('/create', (req, res) => {\r\n  res.render('admin/arena/create', { title: 'Tambah Arena Baru' });\r\n});\r\n\r\n// POST: Simpan arena baru (Sudah Benar)\r\nrouter.post('/store', async (req, res) => {\r\n  try {\r\n    const { nama_arena, jenis_olahraga, lokasi, harga, jam_buka, jam_tutup, status } = req.body;\r\n    let dataArena = { nama_arena, jenis_olahraga, lokasi, harga, jam_buka, jam_tutup, status };\r\n    const result = await Model_Arena.Store(dataArena);\r\n    const newArenaId = result.insertId; \r\n    req.flash('success_msg', 'Arena baru berhasil ditambahkan. Sekarang, silakan upload foto galeri.');\r\n    res.redirect(`/foto/manage/${newArenaId}`); \r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal menyimpan arena: ' + err.code);\r\n    res.redirect('/arena/create');\r\n  }\r\n});\r\n\r\n// GET: Form edit arena (Sudah Benar)\r\nrouter.get('/edit/:id', async (req, res) => {\r\n  try {\r\n    const arena = await Model_Arena.getById(req.params.id);\r\n    if (arena.length === 0) {\r\n      req.flash('error_msg', 'Arena tidak ditemukan.');\r\n      return res.redirect('/arena');\r\n    }\r\n    res.render('admin/arena/edit', {\r\n      title: 'Edit Arena',\r\n      arena: arena[0]\r\n    });\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal memuat data arena.');\r\n    res.redirect('/arena');\r\n  }\r\n});\r\n\r\n// ===================================\r\n// POST: Update arena (INI PERBAIKANNYA)\r\n// ===================================\r\nrouter.post('/update/:id', async (req, res) => {\r\n  const id = req.params.id;\r\n  try {\r\n    // 1. Ambil data teks dari form\r\n    const { nama_arena, jenis_olahraga, lokasi, harga, jam_buka, jam_tutup, status } = req.body;\r\n    \r\n    // 2. Buat variabel dengan nama yang benar (misal: 'dataUpdate')\r\n    let dataUpdate = { nama_arena, jenis_olahraga, lokasi, harga, jam_buka, jam_tutup, status };\r\n\r\n    // 3. Kirim variabel 'dataUpdate' ke model\r\n    await Model_Arena.Update(id, dataUpdate); // <-- DIUBAH\r\n    \r\n    req.flash('success_msg', 'Data arena berhasil diperbarui.');\r\n    res.redirect('/arena');\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal memperbarui arena: ' + err.code);\r\n    res.redirect('/arena/edit/' + id);\r\n  }\r\n});\r\n// ===================================\r\n// AKHIR PERBAIKAN\r\n// ===================================\r\n\r\n// GET: Hapus arena (Sudah Benar)\r\nrouter.get('/delete/:id', async (req, res) => {\r\n  const id = req.params.id;\r\n  try {\r\n    const fotoList = await Model_FotoArena.getByArenaId(id);\r\n    if (fotoList.length > 0) {\r\n      fotoList.forEach(foto => {\r\n        if (foto.url_foto) {\r\n          const filePath = path.join(__dirname, '../public', foto.url_foto);\r\n          if (fs.existsSync(filePath)) {\r\n            fs.unlinkSync(filePath); \r\n          }\r\n        }\r\n      });\r\n    }\r\n    await Model_Arena.Delete(id);\r\n    req.flash('success_msg', 'Data arena dan semua fotonya berhasil dihapus.');\r\n    res.redirect('/arena');\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal menghapus arena: ' + err.code);\r\n    res.redirect('/arena');\r\n  }\r\n});\r\n\r\nrouter.get('/api/:id', async (req, res) => {\r\n  try {\r\n    const arena = await Model_Arena.getById(req.params.id);\r\n    if (arena.length > 0) {\r\n      return res.json(arena[0]); // ✅ gunakan return untuk hentikan eksekusi setelah kirim respons\r\n    } else {\r\n      return res.status(404).json({ message: 'Arena tidak ditemukan' });\r\n    }\r\n  } catch (err) {\r\n    console.error('Error API /arena/api/:id:', err);\r\n    return res.status(500).json({ message: 'Terjadi kesalahan server' });\r\n  }\r\n});\r\n\r\nmodule.exports = router;"]}