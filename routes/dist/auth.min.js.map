{"version":3,"sources":["auth.js"],"names":["express","require","router","Router","Model_Users","get","req","res","bcrypt","title","_req$body","nama","email","password","konfirmasi_password","no_hp","hash","dataUser","regeneratorRuntime","async","_context","prev","next","body","render","flash","abrupt","redirect","awrap","sent","length","password_hash","role","tanggal_daftar","Date","Store","t0","console","error","code","stop","post","_req$body2","users","user","_context2","getByEmail","compare","session","id","id_user","destroy","err","module","exports"],"mappings":"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","file":"auth.min.js","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst bcrypt = require('bcryptjs');\r\nconst Model_Users = require('../models/Model_Users'); \r\n\r\nrouter.get('/register', (req, res) => {\r\n  res.render('auth/register', { title: 'Daftar Akun' });\r\n});\r\n\r\n\r\nrouter.post('/register', async (req, res) => {\r\n  const { nama, email, password, konfirmasi_password, no_hp } = req.body;\r\n\r\n  if (!nama || !email || !password || !no_hp) {\r\n    req.flash('error_msg', 'Semua field wajib diisi.');\r\n    return res.redirect('/auth/register');\r\n  }\r\n\r\n  if (password !== konfirmasi_password) {\r\n    req.flash('error_msg', 'Password dan konfirmasi password tidak cocok.');\r\n    return res.redirect('/auth/register');\r\n  }\r\n\r\n  try {\r\n    const users = await Model_Users.getByEmail(email);\r\n    if (users.length > 0) {\r\n      req.flash('error_msg', 'Email sudah terdaftar.');\r\n      return res.redirect('/auth/register');\r\n    }\r\n\r\n    const hash = await bcrypt.hash(password, 10);\r\n    const dataUser = {\r\n      nama, email, no_hp,\r\n      password_hash: hash,\r\n      role: 'pemain',\r\n      tanggal_daftar: new Date()\r\n    };\r\n    \r\n    await Model_Users.Store(dataUser);\r\n    \r\n    req.flash('success_msg', 'Registrasi berhasil. Silakan login.');\r\n    res.redirect('/auth/login');\r\n\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Terjadi kesalahan server: ' + err.code);\r\n    res.redirect('/auth/register');\r\n  }\r\n});\r\n\r\nrouter.get('/login', (req, res) => {\r\n  res.render('auth/login', { title: 'Login' });\r\n});\r\n\r\n\r\nrouter.post('/login', async (req, res) => {\r\n  const { email, password } = req.body;\r\n\r\n  try {\r\n    const users = await Model_Users.getByEmail(email);\r\n    if (users.length === 0) {\r\n      req.flash('error_msg', 'Email atau Password salah.');\r\n      return res.redirect('/auth/login');\r\n    }\r\n    \r\n    const user = users[0];\r\n    const isMatch = await bcrypt.compare(password, user.password_hash);\r\n    if (!isMatch) {\r\n      req.flash('error_msg', 'Email atau Password salah.');\r\n      return res.redirect('/auth/login');\r\n    }\r\n\r\n    req.session.user = {\r\n      id: user.id_user,\r\n      nama: user.nama,\r\n      email: user.email,\r\n      role: user.role\r\n    };\r\n\r\n    req.flash('success_msg', 'Login berhasil! Selamat datang, ' + user.nama);\r\n\r\n    if (user.role === 'admin') {\r\n      res.redirect('/admin/dashboard');\r\n    } else {\r\n      res.redirect('/');\r\n    }\r\n    \r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Terjadi kesalahan server.');\r\n    res.redirect('/auth/login');\r\n  }\r\n});\r\n\r\n\r\nrouter.get('/logout', (req, res) => {\r\n  req.flash('success_msg', 'Anda berhasil logout.');\r\n  req.session.destroy((err) => {\r\n    if (err) console.error(err);\r\n    res.clearCookie('connect.sid'); \r\n    res.redirect('/auth/login');\r\n  });\r\n});\r\n\r\nmodule.exports = router;"]}