{"version":3,"sources":["auth.js"],"names":["express","require","router","Router","Model_Users","req","res","render","title","post","_req$body","nama","email","password","konfirmasi_password","no_hp","hash","dataUser","regeneratorRuntime","async","_context","prev","next","body","flash","abrupt","redirect","awrap","getByEmail","sent","length","bcrypt","password_hash","role","status","tanggal_daftar","Date","Store","t0","console","error","users","code","stop","get","_req$body2","user","_context2","compare","session","id","id_user","destroy","err","clearCookie","_context3","_req$body3","password_confirm","_context4","isMatch"],"mappings":"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","file":"auth.min.js","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst bcrypt = require('bcryptjs');\r\nconst Model_Users = require('../models/Model_Users'); \r\n\r\n// =====================\r\n// REGISTER\r\n// =====================\r\nrouter.get('/register', (req, res) => {\r\n  res.render('auth/register', { title: 'Daftar Akun' });\r\n});\r\n\r\nrouter.post('/register', async (req, res) => {\r\n  const { nama, email, password, konfirmasi_password, no_hp } = req.body;\r\n\r\n  if (!nama || !email || !password || !no_hp) {\r\n    req.flash('error_msg', 'Semua field wajib diisi.');\r\n    return res.redirect('/auth/register');\r\n  }\r\n\r\n  if (password !== konfirmasi_password) {\r\n    req.flash('error_msg', 'Password dan konfirmasi password tidak cocok.');\r\n    return res.redirect('/auth/register');\r\n  }\r\n\r\n  try {\r\n    const users = await Model_Users.getByEmail(email);\r\n    if (users.length > 0) {\r\n      req.flash('error_msg', 'Email sudah terdaftar.');\r\n      return res.redirect('/auth/register');\r\n    }\r\n\r\n    const hash = await bcrypt.hash(password, 10);\r\n    const dataUser = {\r\n      nama,\r\n      email,\r\n      no_hp,\r\n      password_hash: hash,\r\n      role: 'pemain',\r\n      status: 'aktif',                 // âœ… default akun baru = aktif\r\n      tanggal_daftar: new Date()\r\n    };\r\n    \r\n    await Model_Users.Store(dataUser);\r\n    \r\n    req.flash('success_msg', 'Registrasi berhasil. Silakan login.');\r\n    res.redirect('/auth/login');\r\n\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Terjadi kesalahan server: ' + err.code);\r\n    res.redirect('/auth/register');\r\n  }\r\n});\r\n\r\n// =====================\r\n// LOGIN\r\n// =====================\r\nrouter.get('/login', (req, res) => {\r\n  res.render('auth/login', { title: 'Login' });\r\n});\r\n\r\nrouter.post('/login', async (req, res) => {\r\n  const { email, password } = req.body;\r\n\r\n  try {\r\n    const users = await Model_Users.getByEmail(email);\r\n    if (users.length === 0) {\r\n      req.flash('error_msg', 'Email atau Password salah.');\r\n      return res.redirect('/auth/login');\r\n    }\r\n    \r\n    const user = users[0];\r\n\r\n    // âœ… BLOKIR USER NONAKTIF\r\n    if (user.status === 'nonaktif') {\r\n      req.flash('error_msg', 'Akun Anda tidak aktif. Silakan hubungi admin.');\r\n      return res.redirect('/auth/login');\r\n    }\r\n\r\n    const isMatch = await bcrypt.compare(password, user.password_hash);\r\n    if (!isMatch) {\r\n      req.flash('error_msg', 'Email atau Password salah.');\r\n      return res.redirect('/auth/login');\r\n    }\r\n\r\n    req.session.user = {\r\n      id: user.id_user,\r\n      nama: user.nama,\r\n      email: user.email,\r\n      role: user.role\r\n    };\r\n\r\n    req.flash('success_msg', 'Login berhasil! Selamat datang, ' + user.nama);\r\n\r\n    if (user.role === 'admin') {\r\n      res.redirect('/admin/dashboard');\r\n    } else {\r\n      res.redirect('/');\r\n    }\r\n    \r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Terjadi kesalahan server.');\r\n    res.redirect('/auth/login');\r\n  }\r\n});\r\n\r\n// =====================\r\n// LOGOUT\r\n// =====================\r\nrouter.get('/logout', (req, res) => {\r\n  req.flash('success_msg', 'Anda berhasil logout.');\r\n  req.session.destroy((err) => {\r\n    if (err) console.error(err);\r\n    res.clearCookie('connect.sid'); \r\n    res.redirect('/auth/login');\r\n  });\r\n});\r\n// Lupa Password - Form Email\r\nrouter.get('/lupa-password', (req, res) => {\r\n  res.render('auth/lupa_password', {\r\n    title: 'Lupa Password'\r\n  });\r\n});\r\nrouter.post('/lupa-password', async (req, res) => {\r\n  const { email } = req.body;\r\n\r\n  const user = await Model_Users.getByEmail(email);\r\n\r\n  if (!user || user.length === 0) {\r\n    req.flash('error', 'Email tidak ditemukan.');\r\n    return res.redirect('/auth/lupa-password');\r\n  }\r\n\r\n  res.render('auth/reset_password_simple', {\r\n    title: 'Reset Password',\r\n    id_user: user[0].id_user,\r\n    email: user[0].email    \r\n  });\r\n});\r\n\r\nrouter.post('/reset-password-simple', async (req, res) => {\r\n  const { id_user, password, password_confirm } = req.body;\r\n\r\n  if (password !== password_confirm) {\r\n    req.flash('error', 'Konfirmasi password tidak sama.');\r\n    return res.redirect('back');\r\n  }\r\n\r\n  if (password.length < 6) {\r\n    req.flash('error', 'Password minimal 6 karakter.');\r\n    return res.redirect('back');\r\n  }\r\n\r\n  const bcrypt = require('bcryptjs');\r\n  const hash = await bcrypt.hash(password, 10);\r\n\r\n  // ðŸ”¥ GUNAKAN KOLOM YANG BENAR\r\n  await Model_Users.Update(id_user, { password_hash: hash });\r\n\r\n  req.flash('success', 'Password berhasil diubah. Silakan login kembali.');\r\n  res.redirect('/auth/login');\r\n});\r\n\r\n\r\nmodule.exports = router;\r\n"]}