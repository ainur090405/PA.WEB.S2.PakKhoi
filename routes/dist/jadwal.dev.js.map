{"version":3,"sources":["jadwal.js"],"names":["express","require","router","Router","Model_Jadwal","Model_Arena","Model_Reservasi","isAuthenticated","isAdmin","use","get","req","res","getAll","arenaList","render","title","flash","redirect","post","body","id_arena","hari","jam_buka_operasi","jam_tutup_operasi","durasi_sesi","jumlah_minggu","daftarSesiBaru","hariInput","Array","isArray","durasiMs","parseInt","totalHari","namaHariJS","i","currentDate","Date","setDate","getDate","namaHariIni","getDay","includes","setTime","date","timeStr","split","hours","minutes","newDate","getTime","setHours","sesiMulai","jamTutupOperasi","sesiSelesai","dataSesi","tanggal","toISOString","slice","jam_mulai","toTimeString","jam_selesai","status_slot","push","length","StoreMany","console","error","message","jadwal","data","dataJadwal","Store","code","id","params","Promise","all","getById","jadwalData","Update","id_reservasi","status","reservasiData","reservasi","log","id_jadwal","Delete","module","exports"],"mappings":"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","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst Model_Jadwal = require('../models/Model_Jadwal');\r\nconst Model_Arena = require('../models/Model_Arena'); \r\nconst Model_Reservasi = require('../models/Model_Reservasi');// <-- Ini sudah benar, dibutuhkan\r\nconst { isAuthenticated, isAdmin } = require('../middleware/authMiddleware');\r\n\r\n// Lindungi semua rute, hanya Admin\r\nrouter.use(isAuthenticated, isAdmin);\r\n\r\n// =============================================\r\n// RUTE BARU: Menampilkan Halaman Generator\r\n// (Ini adalah Langkah 3A)\r\n// =============================================\r\nrouter.get('/generator', async (req, res) => {\r\n  try {\r\n    const arenaList = await Model_Arena.getAll(); // Ambil daftar arena\r\n    res.render('admin/jadwal/generator', {\r\n      title: 'Generator Jadwal Massal',\r\n      arenaList: arenaList // Kirim ke EJS untuk dropdown\r\n    });\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal memuat data arena.');\r\n    res.redirect('/jadwal');\r\n  }\r\n});\r\n\r\n// =============================================\r\n// RUTE BARU: Memproses Logika \"Pabrik\"\r\n// (Ini adalah Langkah 3B)\r\n// =============================================\r\nrouter.post('/generator', async (req, res) => {\r\n  try {\r\n    const { id_arena, hari, jam_buka_operasi, jam_tutup_operasi, durasi_sesi, jumlah_minggu } = req.body;\r\n    \r\n    if (!hari) {\r\n      req.flash('error_msg', 'Anda harus memilih minimal satu hari.');\r\n      return res.redirect('/jadwal/generator');\r\n    }\r\n\r\n    const daftarSesiBaru = [];\r\n    const hariInput = Array.isArray(hari) ? hari : [hari];\r\n    const durasiMs = parseInt(durasi_sesi) * 60000; \r\n    const totalHari = parseInt(jumlah_minggu) * 7;\r\n    const namaHariJS = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];\r\n\r\n    for (let i = 0; i < totalHari; i++) {\r\n      let currentDate = new Date();\r\n      currentDate.setDate(currentDate.getDate() + i);\r\n      const namaHariIni = namaHariJS[currentDate.getDay()]; \r\n\r\n      if (hariInput.includes(namaHariIni)) {\r\n        \r\n        const setTime = (date, timeStr) => {\r\n          const [hours, minutes] = timeStr.split(':');\r\n          const newDate = new Date(date.getTime()); \r\n          newDate.setHours(hours, minutes, 0, 0);\r\n          return newDate;\r\n        };\r\n        \r\n        let sesiMulai = setTime(currentDate, jam_buka_operasi);\r\n        let jamTutupOperasi = setTime(currentDate, jam_tutup_operasi);\r\n\r\n        while (sesiMulai < jamTutupOperasi) {\r\n          let sesiSelesai = new Date(sesiMulai.getTime() + durasiMs);\r\n\r\n          if (sesiSelesai > jamTutupOperasi) {\r\n            break;\r\n          }\r\n\r\n          const dataSesi = {\r\n            id_arena: id_arena,\r\n            tanggal: sesiMulai.toISOString().slice(0, 10), \r\n            jam_mulai: sesiMulai.toTimeString().slice(0, 5), \r\n            jam_selesai: sesiSelesai.toTimeString().slice(0, 5), \r\n            status_slot: 'kosong'\r\n          };\r\n          \r\n          daftarSesiBaru.push(dataSesi);\r\n          sesiMulai = sesiSelesai;\r\n        }\r\n      }\r\n    }\r\n    \r\n    if (daftarSesiBaru.length > 0) {\r\n      await Model_Jadwal.StoreMany(daftarSesiBaru); // Memanggil fungsi dari Langkah 2\r\n      req.flash('success_msg', `${daftarSesiBaru.length} slot jadwal baru berhasil di-generate!`);\r\n    } else {\r\n      req.flash('error_msg', 'Tidak ada jadwal yang di-generate. Cek kembali input Anda.');\r\n    }\r\n    \r\n    res.redirect('/jadwal'); \r\n\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Terjadi error saat generate jadwal: ' + err.message);\r\n    res.redirect('/jadwal/generator');\r\n  }\r\n});\r\n\r\n\r\n// =============================================\r\n// RUTE-RUTE LAMA ANDA (CRUD MANUAL)\r\n// (Ini adalah kode yang Anda kirim - TIDAK DIHAPUS)\r\n// =============================================\r\n\r\n// GET: Tampilkan daftar jadwal\r\nrouter.get('/', async (req, res) => {\r\n  try {\r\n    const jadwal = await Model_Jadwal.getAll();\r\n    res.render('admin/jadwal/index', {\r\n      title: 'Manajemen Jadwal',\r\n      data: jadwal\r\n    });\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal memuat data jadwal.');\r\n    res.redirect('/admin/dashboard');\r\n  }\r\n});\r\n\r\n// GET: Form tambah jadwal\r\nrouter.get('/create', async (req, res) => {\r\n  try {\r\n    const arenaList = await Model_Arena.getAll(); // Ambil daftar arena\r\n    res.render('admin/jadwal/create', {\r\n      title: 'Tambah Jadwal Baru',\r\n      arenaList: arenaList // Kirim ke EJS\r\n    });\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal memuat data arena.');\r\n    res.redirect('/jadwal');\r\n  }\r\n});\r\n\r\n// POST: Simpan jadwal baru\r\nrouter.post('/store', async (req, res) => {\r\n  try {\r\n    const { id_arena, tanggal, jam_mulai, jam_selesai, status_slot } = req.body;\r\n    const dataJadwal = { id_arena, tanggal, jam_mulai, jam_selesai, status_slot };\r\n    \r\n    await Model_Jadwal.Store(dataJadwal);\r\n    req.flash('success_msg', 'Jadwal baru berhasil ditambahkan.');\r\n    res.redirect('/jadwal');\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal menyimpan jadwal: ' + err.code);\r\n    res.redirect('/jadwal/create');\r\n  }\r\n});\r\n\r\n// GET: Form edit jadwal\r\nrouter.get('/edit/:id', async (req, res) => {\r\n  try {\r\n    const id = req.params.id;\r\n    const [jadwalData, arenaList] = await Promise.all([\r\n      Model_Jadwal.getById(id),\r\n      Model_Arena.getAll()\r\n    ]);\r\n    \r\n    if (jadwalData.length === 0) {\r\n      req.flash('error_msg', 'Jadwal tidak ditemukan.');\r\n      return res.redirect('/jadwal');\r\n    }\r\n    \r\n    res.render('admin/jadwal/edit', {\r\n      title: 'Edit Jadwal',\r\n      jadwal: jadwalData[0], \r\n      arenaList: arenaList\r\n    });\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal memuat data.');\r\n    res.redirect('/jadwal');\r\n  }\r\n});\r\n\r\n// POST: Update jadwal\r\nrouter.post('/update/:id', async (req, res) => {\r\n  const id = req.params.id;\r\n  try {\r\n    const { id_arena, tanggal, jam_mulai, jam_selesai, status_slot } = req.body;\r\n    const dataJadwal = { id_arena, tanggal, jam_mulai, jam_selesai, status_slot };\r\n\r\n    await Model_Jadwal.Update(id, dataJadwal);\r\n    req.flash('success_msg', 'Data jadwal berhasil diperbarui.');\r\n    res.redirect('/jadwal');\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal memperbarui jadwal: ' + err.code);\r\n    res.redirect('/jadwal/edit/' + id);\r\n  }\r\n});\r\n\r\nrouter.post('/update-status/:id', async (req, res) => {\r\n  try {\r\n    const id_reservasi = req.params.id;\r\n    const { status } = req.body;\r\n    const reservasiData = await Model_Reservasi.getById(id_reservasi);\r\n    const reservasi = Array.isArray(reservasiData) ? reservasiData[0] : reservasiData;\r\n\r\n    console.log('[DEBUG] Reservasi Ditemukan:', reservasi);\r\n\r\n    if (!reservasi || !reservasi.id_jadwal) {\r\n      console.log('[DEBUG] Reservasi kosong atau tidak punya id_jadwal.');\r\n      req.flash('error_msg', 'Data reservasi tidak ditemukan atau tidak valid.');\r\n      return res.redirect('/reservasi');\r\n    }\r\n\r\n    // Update status reservasi\r\n    await Model_Reservasi.Update(id_reservasi, { status });\r\n    console.log(`[DEBUG] Reservasi ${id_reservasi} → status ${status}`);\r\n\r\n    // Sinkronisasi slot jadwal\r\n    const id_jadwal = reservasi.id_jadwal;\r\n    if (status === 'disetujui') {\r\n      console.log(`[DEBUG] Jadwal ${id_jadwal} → terisi`);\r\n      await Model_Jadwal.Update(id_jadwal, { status_slot: 'terisi' });\r\n\r\n    } else if (status === 'ditolak' || status === 'batal') {\r\n      console.log(`[DEBUG] Jadwal ${id_jadwal} → kosong`);\r\n      await Model_Jadwal.Update(id_jadwal, { status_slot: 'kosong' });\r\n    }\r\n\r\n    req.flash('success_msg', `Status reservasi berhasil diperbarui menjadi ${status}`);\r\n    res.redirect('/reservasi');\r\n\r\n  } catch (err) {\r\n    console.error('[DEBUG ERROR] Gagal update status:', err);\r\n    req.flash('error_msg', 'Gagal memperbarui status reservasi');\r\n    res.redirect('/reservasi');\r\n  }\r\n});\r\n\r\n// GET: Hapus jadwal\r\nrouter.get('/delete/:id', async (req, res) => {\r\n  try {\r\n    await Model_Jadwal.Delete(req.params.id);\r\n    req.flash('success_msg', 'Data jadwal berhasil dihapus.');\r\n    res.redirect('/jadwal');\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal menghapus jadwal: ' + err.code);\r\n    res.redirect('/jadwal');\r\n  }\r\n});\r\n\r\nmodule.exports = router;"],"file":"jadwal.dev.js"}