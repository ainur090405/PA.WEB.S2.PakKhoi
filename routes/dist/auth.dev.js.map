{"version":3,"sources":["auth.js"],"names":["express","require","router","Router","bcrypt","Model_Users","get","req","res","render","title","post","body","nama","email","password","konfirmasi_password","no_hp","flash","redirect","getByEmail","users","length","hash","dataUser","password_hash","role","tanggal_daftar","Date","Store","console","error","code","user","compare","isMatch","session","id","id_user","destroy","err","clearCookie","module","exports"],"mappings":"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","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst bcrypt = require('bcryptjs');\r\nconst Model_Users = require('../models/Model_Users'); \r\n\r\nrouter.get('/register', (req, res) => {\r\n  res.render('auth/register', { title: 'Daftar Akun' });\r\n});\r\n\r\n\r\nrouter.post('/register', async (req, res) => {\r\n  const { nama, email, password, konfirmasi_password, no_hp } = req.body;\r\n\r\n  if (!nama || !email || !password || !no_hp) {\r\n    req.flash('error_msg', 'Semua field wajib diisi.');\r\n    return res.redirect('/auth/register');\r\n  }\r\n\r\n  if (password !== konfirmasi_password) {\r\n    req.flash('error_msg', 'Password dan konfirmasi password tidak cocok.');\r\n    return res.redirect('/auth/register');\r\n  }\r\n\r\n  try {\r\n    const users = await Model_Users.getByEmail(email);\r\n    if (users.length > 0) {\r\n      req.flash('error_msg', 'Email sudah terdaftar.');\r\n      return res.redirect('/auth/register');\r\n    }\r\n\r\n    const hash = await bcrypt.hash(password, 10);\r\n    const dataUser = {\r\n      nama, email, no_hp,\r\n      password_hash: hash,\r\n      role: 'pemain',\r\n      tanggal_daftar: new Date()\r\n    };\r\n    \r\n    await Model_Users.Store(dataUser);\r\n    \r\n    req.flash('success_msg', 'Registrasi berhasil. Silakan login.');\r\n    res.redirect('/auth/login');\r\n\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Terjadi kesalahan server: ' + err.code);\r\n    res.redirect('/auth/register');\r\n  }\r\n});\r\n\r\nrouter.get('/login', (req, res) => {\r\n  res.render('auth/login', { title: 'Login' });\r\n});\r\n\r\n\r\nrouter.post('/login', async (req, res) => {\r\n  const { email, password } = req.body;\r\n\r\n  try {\r\n    const users = await Model_Users.getByEmail(email);\r\n    if (users.length === 0) {\r\n      req.flash('error_msg', 'Email atau Password salah.');\r\n      return res.redirect('/auth/login');\r\n    }\r\n    \r\n    const user = users[0];\r\n    const isMatch = await bcrypt.compare(password, user.password_hash);\r\n    if (!isMatch) {\r\n      req.flash('error_msg', 'Email atau Password salah.');\r\n      return res.redirect('/auth/login');\r\n    }\r\n\r\n    req.session.user = {\r\n      id: user.id_user,\r\n      nama: user.nama,\r\n      email: user.email,\r\n      role: user.role\r\n    };\r\n\r\n    req.flash('success_msg', 'Login berhasil! Selamat datang, ' + user.nama);\r\n\r\n    if (user.role === 'admin') {\r\n      res.redirect('/admin/dashboard');\r\n    } else {\r\n      res.redirect('/');\r\n    }\r\n    \r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Terjadi kesalahan server.');\r\n    res.redirect('/auth/login');\r\n  }\r\n});\r\n\r\n\r\nrouter.get('/logout', (req, res) => {\r\n  req.flash('success_msg', 'Anda berhasil logout.');\r\n  req.session.destroy((err) => {\r\n    if (err) console.error(err);\r\n    res.clearCookie('connect.sid'); \r\n    res.redirect('/auth/login');\r\n  });\r\n});\r\n\r\nmodule.exports = router;"],"file":"auth.dev.js"}