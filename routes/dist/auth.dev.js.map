{"version":3,"sources":["auth.js"],"names":["express","require","router","Router","bcrypt","Model_Users","get","req","res","render","title","post","body","nama","email","password","konfirmasi_password","no_hp","flash","redirect","getByEmail","users","length","hash","dataUser","password_hash","role","status","tanggal_daftar","Date","Store","console","error","code","user","compare","isMatch","session","id","id_user","destroy","err","clearCookie","module","exports"],"mappings":"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","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst bcrypt = require('bcryptjs');\r\nconst Model_Users = require('../models/Model_Users'); \r\n\r\n// =====================\r\n// REGISTER\r\n// =====================\r\nrouter.get('/register', (req, res) => {\r\n  res.render('auth/register', { title: 'Daftar Akun' });\r\n});\r\n\r\nrouter.post('/register', async (req, res) => {\r\n  const { nama, email, password, konfirmasi_password, no_hp } = req.body;\r\n\r\n  if (!nama || !email || !password || !no_hp) {\r\n    req.flash('error_msg', 'Semua field wajib diisi.');\r\n    return res.redirect('/auth/register');\r\n  }\r\n\r\n  if (password !== konfirmasi_password) {\r\n    req.flash('error_msg', 'Password dan konfirmasi password tidak cocok.');\r\n    return res.redirect('/auth/register');\r\n  }\r\n\r\n  try {\r\n    const users = await Model_Users.getByEmail(email);\r\n    if (users.length > 0) {\r\n      req.flash('error_msg', 'Email sudah terdaftar.');\r\n      return res.redirect('/auth/register');\r\n    }\r\n\r\n    const hash = await bcrypt.hash(password, 10);\r\n    const dataUser = {\r\n      nama,\r\n      email,\r\n      no_hp,\r\n      password_hash: hash,\r\n      role: 'pemain',\r\n      status: 'aktif',                 // ✅ default akun baru = aktif\r\n      tanggal_daftar: new Date()\r\n    };\r\n    \r\n    await Model_Users.Store(dataUser);\r\n    \r\n    req.flash('success_msg', 'Registrasi berhasil. Silakan login.');\r\n    res.redirect('/auth/login');\r\n\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Terjadi kesalahan server: ' + err.code);\r\n    res.redirect('/auth/register');\r\n  }\r\n});\r\n\r\n// =====================\r\n// LOGIN\r\n// =====================\r\nrouter.get('/login', (req, res) => {\r\n  res.render('auth/login', { title: 'Login' });\r\n});\r\n\r\nrouter.post('/login', async (req, res) => {\r\n  const { email, password } = req.body;\r\n\r\n  try {\r\n    const users = await Model_Users.getByEmail(email);\r\n    if (users.length === 0) {\r\n      req.flash('error_msg', 'Email atau Password salah.');\r\n      return res.redirect('/auth/login');\r\n    }\r\n    \r\n    const user = users[0];\r\n\r\n    // ✅ BLOKIR USER NONAKTIF\r\n    if (user.status === 'nonaktif') {\r\n      req.flash('error_msg', 'Akun Anda tidak aktif. Silakan hubungi admin.');\r\n      return res.redirect('/auth/login');\r\n    }\r\n\r\n    const isMatch = await bcrypt.compare(password, user.password_hash);\r\n    if (!isMatch) {\r\n      req.flash('error_msg', 'Email atau Password salah.');\r\n      return res.redirect('/auth/login');\r\n    }\r\n\r\n    req.session.user = {\r\n      id: user.id_user,\r\n      nama: user.nama,\r\n      email: user.email,\r\n      role: user.role\r\n    };\r\n\r\n    req.flash('success_msg', 'Login berhasil! Selamat datang, ' + user.nama);\r\n\r\n    if (user.role === 'admin') {\r\n      res.redirect('/admin/dashboard');\r\n    } else {\r\n      res.redirect('/');\r\n    }\r\n    \r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Terjadi kesalahan server.');\r\n    res.redirect('/auth/login');\r\n  }\r\n});\r\n\r\n// =====================\r\n// LOGOUT\r\n// =====================\r\nrouter.get('/logout', (req, res) => {\r\n  req.flash('success_msg', 'Anda berhasil logout.');\r\n  req.session.destroy((err) => {\r\n    if (err) console.error(err);\r\n    res.clearCookie('connect.sid'); \r\n    res.redirect('/auth/login');\r\n  });\r\n});\r\n\r\nmodule.exports = router;\r\n"],"file":"auth.dev.js"}