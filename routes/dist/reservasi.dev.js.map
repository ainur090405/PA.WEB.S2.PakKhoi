{"version":3,"sources":["reservasi.js"],"names":["express","require","router","Router","Model_Reservasi","Model_Jadwal","Model_Notifikasi","Model_LogReservasi","isAuthenticated","isAdmin","use","get","req","res","getAll","reservasi","render","title","data","console","error","flash","redirect","id","parseInt","params","getById","rows","length","logs","getByReservasi","warn","post","id_reservasi","status","body","rowsBefore","reservasiBefore","status_awal","rejectAndFreeSlot","Update","r","id_jadwal","status_slot","catatStatus","id_user","tanggalMain","tanggal","Date","toLocaleDateString","weekday","day","month","year","jamMulai","jam_mulai","substring","jamSelesai","jam_selesai","metodeText","pembayaran_metode","isi_pesan","nama_arena","notif","judul","toUpperCase","jenis_notif","tipe","dibaca","Store","catatan","dataToUpdate","message","Delete","code","csv","forEach","jam","tanggalPesan","tanggal_pesan","metode","metode_pembayaran","statusPemb","status_pembayaran","jumlah","bukti","pembayaran_bukti","nama_user","replace","header","attachment","send","module","exports"],"mappings":"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","sourcesContent":["// routes/reservasi.js\r\nconst express = require('express');\r\nconst router = express.Router();\r\n\r\nconst Model_Reservasi = require('../models/Model_Reservasi');\r\nconst Model_Jadwal = require('../models/Model_Jadwal');\r\nconst Model_Notifikasi = require('../models/Model_Notifikasi');\r\nconst Model_LogReservasi = require('../models/Model_LogReservasi'); \r\nconst { isAuthenticated, isAdmin } = require('../middleware/authMiddleware');\r\n\r\n// Semua route di sini khusus admin\r\nrouter.use(isAuthenticated, isAdmin);\r\n\r\n// ============================\r\n// LIST RESERVASI (ADMIN)\r\n// ============================\r\nrouter.get('/', async (req, res) => {\r\n  try {\r\n    const reservasi = await Model_Reservasi.getAll();\r\n    res.render('admin/reservasi/index', {\r\n      title: 'Manajemen Reservasi',\r\n      data: reservasi\r\n    });\r\n  } catch (err) {\r\n    console.error('ERR GET /admin/reservasi:', err);\r\n    req.flash('error_msg', 'Gagal memuat data reservasi.');\r\n    return res.redirect('/admin/dashboard');\r\n  }\r\n});\r\n\r\n// GET: form edit reservasi\r\nrouter.get('/edit/:id', async (req, res) => {\r\n  try {\r\n    const id = parseInt(req.params.id, 10);\r\n\r\n    const rows = await Model_Reservasi.getById(id);\r\n    if (!rows || rows.length === 0) {\r\n      req.flash('error_msg', 'Data reservasi tidak ditemukan.');\r\n      return res.redirect('/admin/reservasi');\r\n    }\r\n\r\n    const reservasi = rows[0];\r\n\r\n    // ⬇️ AMBIL RIWAYAT LOG UNTUK RESERVASI INI\r\n    let logs = [];\r\n    try {\r\n      logs = await Model_LogReservasi.getByReservasi(id);\r\n    } catch (logErr) {\r\n      console.warn('Gagal mengambil log reservasi:', logErr);\r\n    }\r\n\r\n    res.render('admin/reservasi/edit', {\r\n      title: 'Update Status Reservasi',\r\n      reservasi,\r\n      logs   // dikirim ke view (kalau mau dipakai)\r\n    });\r\n  } catch (err) {\r\n    console.error('ERR GET /admin/reservasi/edit:', err);\r\n    req.flash('error_msg', 'Gagal memuat data reservasi.');\r\n    res.redirect('/admin/reservasi');\r\n  }\r\n});\r\n\r\n// ============================\r\n// UPDATE STATUS (SINGLE FIELD)\r\n// ============================\r\nrouter.post('/update-status/:id', async (req, res) => {\r\n  try {\r\n    const id_reservasi = req.params.id;\r\n    const { status } = req.body;\r\n\r\n    // ⬇️ AMBIL STATUS AWAL UNTUK LOG\r\n    const rowsBefore = await Model_Reservasi.getById(id_reservasi);\r\n    if (!rowsBefore || rowsBefore.length === 0) {\r\n      req.flash('error_msg', 'Reservasi tidak ditemukan.');\r\n      return res.redirect('/admin/reservasi');\r\n    }\r\n    const reservasiBefore = rowsBefore[0];\r\n    const status_awal = reservasiBefore.status;\r\n\r\n    // =======================\r\n    // LOGIKA LAMA (TIDAK DIUBAH)\r\n    // =======================\r\n    if (status === 'ditolak') {\r\n      if (typeof Model_Reservasi.rejectAndFreeSlot === 'function') {\r\n        await Model_Reservasi.rejectAndFreeSlot(id_reservasi);\r\n      } else {\r\n        await Model_Reservasi.Update(id_reservasi, { status: 'ditolak' });\r\n        const r = await Model_Reservasi.getById(id_reservasi);\r\n        if (r && r[0] && r[0].id_jadwal) {\r\n          await Model_Jadwal.Update(r[0].id_jadwal, { status_slot: 'kosong' });\r\n        }\r\n      }\r\n    } else {\r\n      // Status lain: cukup update status reservasi + sinkron jadwal\r\n      await Model_Reservasi.Update(id_reservasi, { status });\r\n\r\n      const rows = await Model_Reservasi.getById(id_reservasi);\r\n      if (rows && rows[0]) {\r\n        const id_jadwal = rows[0].id_jadwal;\r\n        if (id_jadwal) {\r\n          if (status === 'disetujui') {\r\n            await Model_Jadwal.Update(id_jadwal, { status_slot: 'terisi' });\r\n          } else if (status === 'batal' || status === 'ditolak') {\r\n            await Model_Jadwal.Update(id_jadwal, { status_slot: 'kosong' });\r\n          } else if (status === 'selesai') {\r\n            await Model_Jadwal.Update(id_jadwal, { status_slot: 'terisi' });\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // ⬇️ CATAT LOG PERUBAHAN STATUS\r\n    try {\r\n      await Model_LogReservasi.catatStatus(\r\n        id_reservasi,\r\n        status_awal,\r\n        status,\r\n        'Update via tombol cepat /update-status'\r\n      );\r\n    } catch (logErr) {\r\n      console.warn('Gagal mencatat log reservasi (update-status):', logErr);\r\n    }\r\n\r\n    // ⬇️ KIRIM NOTIFIKASI KE USER (DIPERKAYA DENGAN TANGGAL/JAM/METODE)\r\n    try {\r\n      const rows = await Model_Reservasi.getById(id_reservasi);\r\n      if (rows && rows[0] && rows[0].id_user) {\r\n        const r = rows[0];\r\n\r\n        const tanggalMain = r.tanggal\r\n          ? new Date(r.tanggal).toLocaleDateString('id-ID', {\r\n              weekday: 'long',\r\n              day: 'numeric',\r\n              month: 'long',\r\n              year: 'numeric'\r\n            })\r\n          : '-';\r\n\r\n        const jamMulai   = r.jam_mulai   ? r.jam_mulai.substring(0, 5)   : '-';\r\n        const jamSelesai = r.jam_selesai ? r.jam_selesai.substring(0, 5) : '-';\r\n\r\n        let metodeText = '';\r\n        if (r.pembayaran_metode === 'cod') {\r\n          metodeText = ' dengan metode COD (bayar di tempat)';\r\n        } else if (r.pembayaran_metode === 'transaksi') {\r\n          metodeText = ' dengan metode Transfer Bank';\r\n        } else {\r\n          metodeText = '';\r\n        }\r\n\r\n        let isi_pesan;\r\n        if (status === 'disetujui') {\r\n          isi_pesan =\r\n            `Booking Anda untuk arena ${r.nama_arena} pada ${tanggalMain} ` +\r\n            `pukul ${jamMulai}–${jamSelesai}${metodeText} telah disetujui.`;\r\n        } else if (status === 'ditolak') {\r\n          isi_pesan =\r\n            `Maaf, booking Anda untuk arena ${r.nama_arena} pada ${tanggalMain} ` +\r\n            `pukul ${jamMulai}–${jamSelesai}${metodeText} ditolak. ` +\r\n            `Silakan hubungi admin untuk informasi lebih lanjut.`;\r\n        } else if (status === 'selesai') {\r\n          isi_pesan =\r\n            `Terima kasih telah bermain di ${r.nama_arena} pada ${tanggalMain} ` +\r\n            `pukul ${jamMulai}–${jamSelesai}.`;\r\n        } else {\r\n          isi_pesan =\r\n            `Status booking Anda untuk arena ${r.nama_arena} pada ${tanggalMain} ` +\r\n            `pukul ${jamMulai}–${jamSelesai}${metodeText} telah berubah menjadi ${status}.`;\r\n        }\r\n\r\n        const notif = {\r\n          id_user: r.id_user,\r\n          judul: `Status Booking: ${status.toUpperCase()}`,\r\n          isi_pesan,\r\n          jenis_notif: 'status',\r\n          tipe: 'booking',\r\n          dibaca: 0\r\n        };\r\n\r\n        if (typeof Model_Notifikasi.Store === 'function') {\r\n          await Model_Notifikasi.Store(notif);\r\n        }\r\n      }\r\n    } catch (notifErr) {\r\n      console.warn('Gagal kirim notifikasi (non blocking):', notifErr);\r\n    }\r\n\r\n    req.flash('success_msg', `Status reservasi berhasil diperbarui menjadi ${status}.`);\r\n    return res.redirect('/admin/reservasi');\r\n\r\n  } catch (err) {\r\n    console.error('ERR POST /admin/reservasi/update-status:', err);\r\n    req.flash('error_msg', 'Gagal memperbarui status reservasi.');\r\n    return res.redirect('/admin/reservasi');\r\n  }\r\n});\r\n\r\n// ============================\r\n// UPDATE FORM LENGKAP (STATUS + CATATAN)\r\n// ============================\r\nrouter.post('/update/:id', async (req, res) => {\r\n  const id = req.params.id;\r\n  try {\r\n    const { status, catatan } = req.body;\r\n    const dataToUpdate = { status, catatan };\r\n\r\n    // ⬇️ AMBIL DATA & STATUS AWAL UNTUK LOG\r\n    const rows = await Model_Reservasi.getById(id);\r\n    if (!rows || rows.length === 0) {\r\n      req.flash('error_msg', 'Reservasi tidak ditemukan.');\r\n      return res.redirect('/admin/reservasi');\r\n    }\r\n    const r = rows[0];\r\n    const status_awal = r.status;\r\n    const id_jadwal = r.id_jadwal;\r\n\r\n    // Update status & catatan (LOGIKA LAMA)\r\n    await Model_Reservasi.Update(id, dataToUpdate);\r\n\r\n    // Sinkron jadwal (LOGIKA LAMA)\r\n    if (id_jadwal) {\r\n      if (status === 'disetujui') {\r\n        await Model_Jadwal.Update(id_jadwal, { status_slot: 'terisi' });\r\n      } else if (status === 'ditolak' || status === 'batal') {\r\n        await Model_Jadwal.Update(id_jadwal, { status_slot: 'kosong' });\r\n      } else if (status === 'selesai') {\r\n        await Model_Jadwal.Update(id_jadwal, { status_slot: 'terisi' });\r\n      }\r\n    }\r\n\r\n    // ⬇️ CATAT LOG PERUBAHAN STATUS + CATATAN\r\n    try {\r\n      await Model_LogReservasi.catatStatus(\r\n        id,\r\n        status_awal,\r\n        status,\r\n        catatan || null\r\n      );\r\n    } catch (logErr) {\r\n      console.warn('Gagal mencatat log reservasi (update form):', logErr);\r\n    }\r\n\r\n    // ⬇️ NOTIFIKASI DIPERKAYA (UNTUK COD JUGA)\r\n    if (r.id_user) {\r\n      const tanggalMain = r.tanggal\r\n        ? new Date(r.tanggal).toLocaleDateString('id-ID', {\r\n            weekday: 'long',\r\n            day: 'numeric',\r\n            month: 'long',\r\n            year: 'numeric'\r\n          })\r\n        : '-';\r\n\r\n      const jamMulai   = r.jam_mulai   ? r.jam_mulai.substring(0, 5)   : '-';\r\n      const jamSelesai = r.jam_selesai ? r.jam_selesai.substring(0, 5) : '-';\r\n\r\n      let metodeText = '';\r\n      if (r.pembayaran_metode === 'cod') {\r\n        metodeText = ' dengan metode COD (bayar di tempat)';\r\n      } else if (r.pembayaran_metode === 'transaksi') {\r\n        metodeText = ' dengan metode Transfer Bank';\r\n      }\r\n\r\n      let isi_pesan;\r\n      if (status === 'disetujui') {\r\n        isi_pesan =\r\n          `Booking Anda untuk arena ${r.nama_arena} pada ${tanggalMain} ` +\r\n          `pukul ${jamMulai}–${jamSelesai}${metodeText} telah disetujui.`;\r\n      } else if (status === 'ditolak') {\r\n        isi_pesan =\r\n          `Maaf, booking Anda untuk arena ${r.nama_arena} pada ${tanggalMain} ` +\r\n          `pukul ${jamMulai}–${jamSelesai}${metodeText} ditolak.` +\r\n          (catatan ? ` Alasan: ${catatan}` : '');\r\n      } else if (status === 'selesai') {\r\n        isi_pesan =\r\n          `Terima kasih telah bermain di ${r.nama_arena} pada ${tanggalMain} ` +\r\n          `pukul ${jamMulai}–${jamSelesai}.`;\r\n      } else {\r\n        isi_pesan =\r\n          `Status booking Anda untuk arena ${r.nama_arena} pada ${tanggalMain} ` +\r\n          `pukul ${jamMulai}–${jamSelesai}${metodeText} telah berubah menjadi ${status}.`;\r\n      }\r\n\r\n      const notif = {\r\n        id_user: r.id_user,\r\n        judul: `Status Booking: ${status.toUpperCase()}`,\r\n        isi_pesan,\r\n        jenis_notif: 'status',\r\n        tipe: 'booking',\r\n        dibaca: 0\r\n      };\r\n\r\n      if (typeof Model_Notifikasi.Store === 'function') {\r\n        await Model_Notifikasi.Store(notif);\r\n      }\r\n    }\r\n\r\n    req.flash('success_msg', 'Status reservasi berhasil diperbarui.');\r\n    return res.redirect('/admin/reservasi');\r\n  } catch (err) {\r\n    console.error('ERR POST /admin/reservasi/update:', err);\r\n    req.flash('error_msg', 'Gagal memperbarui reservasi: ' + err.message);\r\n    return res.redirect('/admin/reservasi/edit/' + id);\r\n  }\r\n});\r\n\r\n// ============================\r\n// DELETE RESERVASI\r\n// ============================\r\nrouter.get('/delete/:id', async (req, res) => {\r\n  try {\r\n    await Model_Reservasi.Delete(req.params.id);\r\n    req.flash('success_msg', 'Data reservasi berhasil dihapus.');\r\n    return res.redirect('/admin/reservasi');\r\n  } catch (err) {\r\n    console.error('ERR GET /admin/reservasi/delete:', err);\r\n    req.flash('error_msg', 'Gagal menghapus reservasi: ' + (err.message || err.code));\r\n    return res.redirect('/admin/reservasi');\r\n  }\r\n});\r\n\r\n// ============================\r\n// DOWNLOAD CSV\r\n// ============================\r\nrouter.get('/download', async (req, res) => {\r\n  try {\r\n    const reservasi = await Model_Reservasi.getAll();\r\n    let csv = 'ID,Pemesan,Arena,Tanggal Main,Jam,Tanggal Pesan,Status,Metode Pembayaran,Status Pembayaran,Jumlah,Bukti\\n';\r\n\r\n    reservasi.forEach(r => {\r\n      const tanggalMain = r.tanggal ? new Date(r.tanggal).toLocaleDateString('id-ID') : '';\r\n      const jam = r.jam_mulai ? r.jam_mulai.substring(0, 5) : '';\r\n      const tanggalPesan = r.tanggal_pesan ? new Date(r.tanggal_pesan).toLocaleDateString('id-ID') : '';\r\n\r\n      const metode = r.metode_pembayaran || '';          // dari join pembayaran\r\n      const statusPemb = r.status_pembayaran || '';\r\n      const jumlah = r.jumlah || 0;                       // alias di model\r\n      const bukti = r.pembayaran_bukti || '';\r\n\r\n      csv += `${r.id_reservasi},\"${(r.nama_user || '').replace(/\"/g,'\"\"')}\",\"${(r.nama_arena || '').replace(/\"/g,'\"\"')}\",${tanggalMain},${jam},${tanggalPesan},${r.status || ''},${metode},${statusPemb},${jumlah},${bukti}\\n`;\r\n    });\r\n\r\n    res.header('Content-Type', 'text/csv');\r\n    res.attachment('reservasi.csv');\r\n    return res.send(csv);\r\n  } catch (err) {\r\n    console.error('ERR GET /admin/reservasi/download:', err);\r\n    req.flash('error_msg', 'Gagal mendownload data reservasi.');\r\n    return res.redirect('/admin/reservasi');\r\n  }\r\n});\r\n\r\nmodule.exports = router;\r\n"],"file":"reservasi.dev.js"}