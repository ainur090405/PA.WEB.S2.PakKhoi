"use strict";var express=require("express"),router=express.Router(),Model_Reservasi=require("../models/Model_Reservasi"),Model_Jadwal=require("../models/Model_Jadwal"),Model_Pembayaran=require("../models/Model_Pembayaran"),Model_Arena=require("../models/Model_Arena");router.post("/create",function(a,r){var t,n,s,o,d,i,u,l,m,p,c,_,g;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=a.body,n=t.id_jadwal,s=t.payment_method,o=t.amount,d=a.session.user.id,e.next=5,regeneratorRuntime.awrap(Model_Jadwal.getById(n));case 5:if(0===(i=e.sent).length)throw new Error("Jadwal tidak ditemukan atau sudah dipesan.");e.next=8;break;case 8:if("kosong"!==i[0].status_slot)return a.flash("error_msg","Maaf, slot ini baru saja dipesan orang lain."),e.abrupt("return",r.redirect("back"));e.next=11;break;case 11:return u=i[0].id_arena,e.next=14,regeneratorRuntime.awrap(Model_Arena.getById(u));case 14:return l=e.sent,m=l[0].harga||0,p={id_user:d,id_arena:u,id_jadwal:n,status:"menunggu",payment_method:s,payment_status:"cod"===s?"pending":"unpaid",amount:"midtrans"===s?parseFloat(o):m},e.next=19,regeneratorRuntime.awrap(Model_Reservasi.Store(p));case 19:return c=e.sent,_=c.insertId,g={id_reservasi:_,metode_pembayaran:s,status_pembayaran:"cod"===s?"pending":"unpaid",jumlah:p.amount},e.next=24,regeneratorRuntime.awrap(Model_Pembayaran.Store(g));case 24:return e.next=26,regeneratorRuntime.awrap(Model_Jadwal.Update(n,{status_slot:"terisi"}));case 26:a.flash("success_msg","Booking berhasil! Menunggu konfirmasi Admin."),r.redirect("/pemain/profile"),e.next=35;break;case 30:e.prev=30,e.t0=e.catch(0),console.error(e.t0),a.flash("error_msg","Maaf, terjadi kesalahan saat melakukan booking."),r.redirect("back");case 35:case"end":return e.stop()}},null,null,[[0,30]])}),module.exports=router;
//# sourceMappingURL=booking_new.min.js.map
