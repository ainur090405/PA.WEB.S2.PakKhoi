{"version":3,"sources":["pemain.js"],"names":["express","require","router","Router","fs","path","PDFDocument","Model_Users","Model_Reservasi","Model_Ulasan","Model_Notifikasi","Model_Pembayaran","isAuthenticated","isPemain","uploadBuktiPembayaran","use","isBusy","autoUpdateStatus","console","log","Date","toISOString","error","setInterval","req","res","next","flash","redirect","get","userId","session","user","id","Promise","all","getByUser","reservasiData","notifications","stats","totalBookings","length","activeBookings","filter","r","status","totalSpent","reduce","sum","pembayaran_jumlah","render","title","recentBookings","slice","getById","userData","ulasanData","ulasan","reservasi","post","Store","id_user","id_reservasi","params","rating","body","komentar","UpdateByReservasi","parseInt","single","err","msg","code","message","reservasiRows","file","unlink","uploadBuktiByReservasi","filename","rows","json","success","pembayaran","metode_pembayaran","pembayaran_metode","jumlah","status_pembayaran","pembayaran_status","status_bukti","pembayaran_status_bukti","tanggal_pembayaran","pembayaran_tanggal","bukti_pembayaran","pembayaran_bukti","catatan_admin","pembayaran_catatan","buktiFilename","buktiPath","join","__dirname","doc","margin","autoFirstPage","setHeader","pipe","fontSize","text","align","moveDown","toLocaleString","underline","nama_user","nama_arena","tanggal","toLocaleDateString","jam_mulai","substring","jam_selesai","metode","statusPemb","Number","existsSync","addPage","image","fit","valign","imgErr","warn","fillColor","catatan","end","module","exports"],"mappings":"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","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst fs = require('fs');\r\nconst path = require('path');\r\nconst PDFDocument = require('pdfkit');\r\n\r\nconst Model_Users = require('../models/Model_Users');\r\nconst Model_Reservasi = require('../models/Model_Reservasi');\r\nconst Model_Ulasan = require('../models/Model_Ulasan');\r\nconst Model_Notifikasi = require('../models/Model_Notifikasi');\r\nconst Model_Pembayaran = require('../models/Model_Pembayaran');\r\n\r\nconst { isAuthenticated, isPemain } = require('../middleware/authMiddleware');\r\nconst { uploadBuktiPembayaran } = require('../middleware/uploadMiddleware');\r\n\r\nrouter.use(isAuthenticated, isPemain);\r\n\r\n// AUTO UPDATE STATUS (tetap sama)\r\nlet isBusy = false;\r\nasync function autoUpdateStatus() {\r\n  if (isBusy) return;\r\n  isBusy = true;\r\n  try {\r\n    await Model_Reservasi.autoUpdateStatus();\r\n    console.log(`AUTO UPDATE OK - ${new Date().toISOString()}`);\r\n  } catch (err) {\r\n    console.error('AUTO UPDATE ERROR:', err);\r\n  } finally {\r\n    isBusy = false;\r\n  }\r\n}\r\nsetInterval(autoUpdateStatus, 60 * 1000);\r\n\r\nrouter.use((req, res, next) => {\r\n  if (isBusy) {\r\n    req.flash('error_msg', 'Server sedang update, coba sebentar lagi.');\r\n    return res.redirect('back');\r\n  }\r\n  next();\r\n});\r\n\r\n// DASHBOARD\r\nrouter.get('/dashboard', async (req, res) => {\r\n  try {\r\n    const userId = req.session.user.id;\r\n\r\n    const [reservasiData, notifications] = await Promise.all([\r\n      Model_Reservasi.getByUser(userId),\r\n      Model_Notifikasi.getByUser(userId)\r\n    ]);\r\n\r\n    const stats = {\r\n      totalBookings: reservasiData.length,\r\n      activeBookings: reservasiData.filter(r => r.status === 'disetujui' || r.status === 'menunggu').length,\r\n      totalSpent: reservasiData.reduce((sum, r) => sum + (r.pembayaran_jumlah || 0), 0)\r\n    };\r\n\r\n    res.render('pemain/dashboard', {\r\n      title: 'Dashboard Pemain',\r\n      stats,\r\n      recentBookings: reservasiData.slice(0, 5),\r\n      notifications\r\n    });\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Gagal memuat dashboard.');\r\n    res.redirect('/');\r\n  }\r\n});\r\n\r\n// ========================\r\n// Profil\r\n// ========================\r\nrouter.get('/profile', async (req, res) => {\r\n  try {\r\n    const userId = req.session.user.id;\r\n\r\n    const [userData, ulasanData, reservasiData] = await Promise.all([\r\n      Model_Users.getById(userId),\r\n      Model_Ulasan.getByUser(userId),\r\n      Model_Reservasi.getByUser(userId)\r\n    ]);\r\n\r\n    if (!userData || userData.length === 0) {\r\n      req.flash('error_msg', 'User tidak ditemukan.');\r\n      return res.redirect('/pemain/dashboard');\r\n    }\r\n\r\n    res.render('pemain/profile', {\r\n      title: 'Profil Saya',\r\n      user: userData[0],\r\n      ulasan: ulasanData,\r\n      reservasi: reservasiData\r\n    });\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Gagal memuat halaman profil.');\r\n    res.redirect('/pemain/dashboard');\r\n  }\r\n});\r\n\r\n// ========================\r\n// CREATE ULASAN\r\n// ========================\r\nrouter.post('/ulasan/create/:id', async (req, res) => {\r\n  try {\r\n    await Model_Ulasan.Store({\r\n      id_user: req.session.user.id,\r\n      id_reservasi: req.params.id,\r\n      rating: req.body.rating,\r\n      komentar: req.body.komentar\r\n    });\r\n\r\n    req.flash('success_msg', 'Ulasan berhasil disimpan!');\r\n    res.redirect('/pemain/riwayat-ulasan');\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Gagal menyimpan ulasan');\r\n    res.redirect('/pemain/riwayat-ulasan');\r\n  }\r\n});\r\n\r\n// ========================\r\n// UPDATE ULASAN\r\n// ========================\r\nrouter.post('/ulasan/update/:id', async (req, res) => {\r\n  try {\r\n    await Model_Ulasan.UpdateByReservasi(req.params.id, {\r\n      rating: req.body.rating,\r\n      komentar: req.body.komentar\r\n    });\r\n\r\n    req.flash('success_msg', 'Ulasan berhasil diperbarui!');\r\n    res.redirect('/pemain/riwayat-ulasan');\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Gagal memperbarui ulasan');\r\n    res.redirect('/pemain/riwayat-ulasan');\r\n  }\r\n});\r\n\r\n// ========================\r\n// Halaman Riwayat\r\n// ========================\r\nrouter.get('/riwayat-ulasan', async (req, res) => {\r\n  try {\r\n    const userId = req.session.user.id;\r\n\r\n    const [userData, ulasanData, reservasiData] = await Promise.all([\r\n      Model_Users.getById(userId),\r\n      Model_Ulasan.getByUser(userId),\r\n      Model_Reservasi.getByUser(userId)\r\n    ]);\r\n\r\n    res.render('pemain/riwayat-ulasan', {\r\n      title: 'Riwayat & Ulasan',\r\n      user: userData[0] || null,\r\n      ulasan: ulasanData || [],\r\n      reservasi: reservasiData || []\r\n    });\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Gagal memuat halaman.');\r\n    res.redirect('/pemain/dashboard');\r\n  }\r\n});\r\n\r\nrouter.post('/upload-bukti/:id_reservasi', (req, res) => {\r\n  const id_reservasi = parseInt(req.params.id_reservasi, 10);\r\n  const userId = req.session.user.id;\r\n\r\n  uploadBuktiPembayaran.single('bukti_pembayaran')(req, res, async function (err) {\r\n    try {\r\n      if (err) {\r\n        console.error('MULTER ERROR:', err);\r\n        const msg = err.code === 'LIMIT_FILE_SIZE'\r\n          ? 'File terlalu besar (maks 5MB).'\r\n          : (err.message || 'Gagal mengupload file.');\r\n        req.flash('error_msg', msg);\r\n        return res.redirect('/pemain/riwayat-ulasan');\r\n      }\r\n\r\n      // validasi reservasi & owner\r\n      const reservasiRows = await Model_Reservasi.getById(id_reservasi);\r\n      if (!reservasiRows || reservasiRows.length === 0 || reservasiRows[0].id_user !== userId) {\r\n        if (req.file && req.file.path) fs.unlink(req.file.path, () => {});\r\n        req.flash('error_msg', 'Reservasi tidak valid atau tidak memiliki akses.');\r\n        return res.redirect('/pemain/riwayat-ulasan');\r\n      }\r\n\r\n      if (!req.file) {\r\n        req.flash('error_msg', 'Silakan pilih file bukti pembayaran.');\r\n        return res.redirect('/pemain/riwayat-ulasan');\r\n      }\r\n\r\n      // CUKUP: langsung simpan ke tabel pembayaran\r\n      await Model_Pembayaran.uploadBuktiByReservasi(id_reservasi, req.file.filename);\r\n\r\n      req.flash('success_msg', 'Bukti berhasil diupload! Menunggu konfirmasi admin.');\r\n      return res.redirect('/pemain/riwayat-ulasan');\r\n\r\n    } catch (catchErr) {\r\n      console.error('UPLOAD HANDLER ERROR:', catchErr);\r\n      if (req.file && req.file.path) fs.unlink(req.file.path, () => {});\r\n      req.flash('error_msg', 'Terjadi kesalahan saat mengupload bukti.');\r\n      return res.redirect('/pemain/riwayat-ulasan');\r\n    }\r\n  });\r\n});\r\n\r\n// ========================\r\n// DETAIL PEMBAYARAN (AJAX/modal)\r\n// ========================\r\nrouter.get('/detail-pembayaran/:id_reservasi', async (req, res) => {\r\n  try {\r\n    const id_reservasi = parseInt(req.params.id_reservasi, 10);\r\n    const userId = req.session.user.id;\r\n\r\n    const rows = await Model_Reservasi.getById(id_reservasi);\r\n    if (!rows || rows.length === 0 || rows[0].id_user !== userId) {\r\n      return res.json({ success: false, message: 'Akses ditolak' });\r\n    }\r\n\r\n    const r = rows[0];\r\n\r\n    const pembayaran = {\r\n      metode_pembayaran: r.pembayaran_metode,\r\n      jumlah: r.pembayaran_jumlah,\r\n      status_pembayaran: r.pembayaran_status,\r\n      status_bukti: r.pembayaran_status_bukti,\r\n      tanggal_pembayaran: r.pembayaran_tanggal,\r\n      bukti_pembayaran: r.pembayaran_bukti,\r\n      catatan_admin: r.pembayaran_catatan\r\n    };\r\n\r\n    return res.json({ success: true, pembayaran, reservasi: r });\r\n  } catch (err) {\r\n    console.error('Detail pembayaran error:', err);\r\n    return res.json({ success: false, message: 'Error server' });\r\n  }\r\n});\r\n\r\n// ========================\r\n// DOWNLOAD PDF PEMBAYARAN\r\n// ========================\r\nrouter.get('/download-pdf/:id_reservasi', async (req, res) => {\r\n  try {\r\n    const userId = req.session.user.id;\r\n    const id = parseInt(req.params.id_reservasi, 10);\r\n\r\n    const rows = await Model_Reservasi.getById(id);\r\n    if (!rows || rows.length === 0 || rows[0].id_user !== userId) {\r\n      req.flash('error_msg', 'Akses ditolak.');\r\n      return res.redirect('/pemain/riwayat-ulasan');\r\n    }\r\n\r\n    const r = rows[0];\r\n\r\n    const buktiFilename = r.pembayaran_bukti || null;\r\n    const buktiPath = buktiFilename\r\n      ? path.join(__dirname, '..', 'public', 'uploads', 'bukti_pembayaran', buktiFilename)\r\n      : null;\r\n\r\n    const doc = new PDFDocument({ margin: 40, autoFirstPage: true });\r\n    const filename = `detail_pembayaran_${id}.pdf`;\r\n    res.setHeader('Content-Disposition', `attachment; filename=\"${filename}\"`);\r\n    res.setHeader('Content-Type', 'application/pdf');\r\n    doc.pipe(res);\r\n\r\n    // Header\r\n    doc.fontSize(18).text('Detail Pembayaran', { align: 'center' });\r\n    doc.moveDown(0.5);\r\n    doc.fontSize(10).text(`Tanggal Cetak: ${new Date().toLocaleString('id-ID')}`, { align: 'right' });\r\n    doc.moveDown(1);\r\n\r\n    // Informasi reservasi\r\n    doc.fontSize(12).text('Informasi Reservasi', { underline: true });\r\n    doc.moveDown(0.3);\r\n    doc.fontSize(11)\r\n      .text(`ID Reservasi: ${r.id_reservasi}`)\r\n      .text(`Pemesan     : ${r.nama_user || '-'}`)\r\n      .text(`Arena       : ${r.nama_arena || '-'}`)\r\n      .text(`Tanggal     : ${r.tanggal ? new Date(r.tanggal).toLocaleDateString('id-ID') : '-'}`)\r\n      .text(`Jam         : ${r.jam_mulai ? r.jam_mulai.substring(0,5) : '-'} - ${r.jam_selesai ? r.jam_selesai.substring(0,5) : '-'}`)\r\n      .text(`Status      : ${r.status || '-'}`)\r\n      .moveDown(0.8);\r\n\r\n    // Informasi pembayaran\r\n    doc.fontSize(12).text('Detail Pembayaran', { underline: true });\r\n    doc.moveDown(0.3);\r\n    const metode = r.pembayaran_metode || 'transaksi';\r\n    const jumlah = r.pembayaran_jumlah || 0;\r\n    const statusPemb = r.pembayaran_status || '-';\r\n    doc.fontSize(11)\r\n      .text(`Metode Pembayaran : ${metode}`)\r\n      .text(`Jumlah            : Rp ${Number(jumlah).toLocaleString('id-ID')}`)\r\n      .text(`Status Pembayaran : ${statusPemb}`)\r\n      .text(`Tanggal Pembayaran: ${r.pembayaran_tanggal ? new Date(r.pembayaran_tanggal).toLocaleString('id-ID') : '-'}`)\r\n      .moveDown(0.8);\r\n\r\n    // Rekening tujuan â€” opsional, kalau nanti kamu isi di tabel pembayaran\r\n    doc.fontSize(12).text('Rekening Tujuan', { underline: true });\r\n    doc.moveDown(0.3);\r\n    doc.fontSize(11)\r\n      .text(`Bank        : -`)\r\n      .text(`No. Rekening: -`)\r\n      .text(`Atas Nama   : -`)\r\n      .moveDown(0.8);\r\n\r\n    // Bukti pembayaran (gambar)\r\n    if (buktiPath && fs.existsSync(buktiPath)) {\r\n      try {\r\n        doc.addPage();\r\n        doc.fontSize(14).text('Bukti Pembayaran', { align: 'center' });\r\n        doc.moveDown(0.5);\r\n        doc.image(buktiPath, {\r\n          fit: [450, 650],\r\n          align: 'center',\r\n          valign: 'center'\r\n        });\r\n        doc.moveDown(0.5);\r\n      } catch (imgErr) {\r\n        console.warn('Gagal sisipkan gambar ke PDF:', imgErr);\r\n        doc.moveDown(0.5);\r\n        doc.fontSize(10).fillColor('red').text('Gagal memuat gambar bukti ke PDF.', { align: 'center' });\r\n        doc.fillColor('black');\r\n      }\r\n    } else {\r\n      doc.moveDown(0.3);\r\n      doc.fontSize(10).fillColor('gray').text('Bukti pembayaran: -', { align: 'left' });\r\n      doc.fillColor('black');\r\n    }\r\n\r\n    // Catatan admin\r\n    const catatan = r.pembayaran_catatan || null;\r\n    if (catatan) {\r\n      doc.addPage();\r\n      doc.fontSize(12).text('Catatan Admin', { underline: true });\r\n      doc.moveDown(0.3);\r\n      doc.fontSize(11).text(catatan);\r\n    }\r\n\r\n    doc.end();\r\n  } catch (err) {\r\n    console.error('Download PDF error:', err);\r\n    req.flash('error_msg', 'Gagal membuat PDF. Silakan coba lagi.');\r\n    return res.redirect('/pemain/riwayat-ulasan');\r\n  }\r\n});\r\n\r\nmodule.exports = router;\r\n"],"file":"pemain.dev.js"}