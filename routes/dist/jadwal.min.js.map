{"version":3,"sources":["jadwal.js"],"names":["express","require","router","Router","Model_Jadwal","Model_Arena","Model_Reservasi","isAuthenticated","isAdmin","use","req","res","getAll","render","arenaList","get","_req$body","id_arena","hari","jam_buka_operasi","jam_tutup_operasi","durasi_sesi","jumlah_minggu","daftarSesiBaru","hariInput","durasiMs","totalHari","namaHariJS","i","currentDate","namaHariIni","setTime","sesiMulai","jamTutupOperasi","sesiSelesai","dataSesi","regeneratorRuntime","async","_context2","prev","next","body","flash","abrupt","redirect","Array","isArray","parseInt","Date","setDate","getDate","getDay","includes","date","timeStr","_timeStr$split2","_slicedToArray","split","hours","minutes","getTime","newDate","tanggal","toISOString","slice","jam_mulai","toTimeString","jam_selesai","status_slot","push","length","awrap","StoreMany","concat","t0","console","error","message","stop","jadwal","_context3","sent","title","data","post","_req$body2","dataJadwal","_context5","Store","code","id","_ref","_ref2","jadwalData","_context6","params","Promise","all","getById","_req$body3","_context7","Update","id_reservasi","status","reservasiData","reservasi","id_jadwal","_context8","log","_context9","Delete","module","exports"],"mappings":"mnBAAA,IAAMA,QAAUC,QAAQ,WAClBC,OAASF,QAAQG,SACjBC,aAAeH,QAAQ,0BACvBI,YAAcJ,QAAQ,yBACtBK,gBAAkBL,QAAQ,sCACKA,QAAQ,gCAArCM,yBAAAA,gBAAiBC,iBAAAA,QAGzBN,OAAOO,IAAIF,gBAAiBC,SAN5BN,OAAME,IAAAA,aAAeH,SAAQS,EAAAC,GAARV,IAAAA,EAAAA,OAAAA,mBAAAA,MAAAA,SAAAA,GAAAA,OAAAA,OAAAA,EAAAA,KAAAA,EAAAA,MAAAA,KAAAA,EAAAA,OAAAA,EAAAA,KAAAA,EAAAA,EAAAA,KAAAA,EAAAA,mBAAAA,MACOI,YAAAO,UADPX,KAAAA,EACfI,EADeJ,EAAAA,KAejBU,EAAIE,OAAO,yBAA0B,CAbnCP,MAAAA,0BAeAQ,UAAWA,IAjBIb,EAAAA,KAAAA,GAAAA,MAAAA,KAAAA,EAAAA,EAAAA,KAAAA,EAAAA,EAAAA,GAAAA,EAAAA,MAAAA,GAGbM,EAAAA,MAAAA,YAiBmB,4BAjBFC,EAAAA,SAkBR,WArBIP,KAAAA,GAAAA,IAAAA,MAAAA,OAAAA,EAAAA,SAAAA,KAAAA,KAAAA,CAAAA,CAAAA,EAAAA,OAYrBC,OAAOa,KAAI,aAAc,SAAAL,EAAAC,GAAA,IAAAK,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAC,mBAAAC,MAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,GAAAF,EAAAC,KAAA,EAAAvB,EAAAN,EAAA+B,KAAAxB,EAAAD,EAAAC,SAAAC,EAAAF,EAAAE,KAAAC,EAAAH,EAAAG,iBAAAC,EAAAJ,EAAAI,kBAAAC,EAAAL,EAAAK,YAAAC,EAAAN,EAAAM,cAAAJ,EAAA,CAAAoB,EAAAE,KAAA,EAAA,MAAA,OAAA9B,EAAAgC,MAAA,YAAA,yCAAAJ,EAAAK,OAAA,SAAAhC,EAAAiC,SAAA,sBAAA,KAAA,EA0BfrB,EAAiB,GA1BFC,EAAAqB,MAAAC,QAAA5B,GAAAA,EAAA,CAAAA,GAEfJ,EAFe,IAAAiC,SAAA1B,GAEyBK,EAAA,EAAAqB,SAAAzB,GAC9CX,EAAW,CAAA,SAAA,QAAA,SAA0B,OAAA,QAAA,QAAA,SAEnCG,EAAAA,EALmB,KAAA,GAAA,KAKnBA,EAAWA,GALQ,CAAAwB,EAAAE,KAAA,GAAA,MAAA,IAiCfX,EAAc,IAAImB,MA9BxBC,QAAApB,EAAAqB,UAAAtB,GAHqBE,EAAAH,EAAAE,EAAAsB,WAqCf3B,EAAU4B,SAAStB,GArCJ,CAAAQ,EAAAE,KAAA,GAAA,MAAAR,GAAAD,EAAA,SAAAsB,EAAAC,GAAA,IAAAC,EAAAC,eAAAF,EAAAG,MAAA,KAAA,GAAAC,EAAAH,EAAA,GAAAI,EAAAJ,EAAA,GAQjBb,EAAM,IAAAM,KAAaK,EAAAO,WAmCjB,OAlCNjD,EAAIiC,SAASc,EAAbC,EAAA,EAAA,GAkCaE,IA3CQhC,EAAAV,GAAAc,EAAAF,EAAAF,EAAAT,GAAA,KAAA,GAAA,KAAAY,EAAAC,GAAA,CAAAK,EAAAE,KAAA,GAAA,MAAA,GAazBN,EAAA,IAAAc,KAAAhB,EAAA4B,UAAAnC,GAEAQ,EAAAC,EAfyB,OAAAI,EAAAK,OAAA,QAAA,IAAAL,EAAAE,KAAA,GAAA,MAAA,KAAA,GAiBCL,EAAA,CAwCdlB,SAAUA,EAxCI6C,QAAA9B,EAAA+B,cAAAC,MAAA,EAAA,IAAAC,UAAAjC,EAAAkC,eAAAF,MAAA,EAAA,GAAAG,YAAAjC,EAAAgC,eAAAF,MAAA,EAAA,GAAAI,YAAA,UA+ChB7C,EAAe8C,KAAKlC,GA/CJH,EAAAE,EAjBDI,EAAAE,KAAA,GAAA,MAAA,KAAA,GAKEZ,IALFU,EAAAE,KAAA,GAAA,MAAA,KAAA,GAAA,GAsBnB,EAAA9B,EAAU4D,OAtBS,OAAAhC,EAAAE,KAAA,GAAAJ,mBAAAmC,MAiBCnE,aAAAoE,UAAAjD,IAjBDe,EAAAE,KAAA,GAAA,MAAA,KAAA,GAwEnB9B,EAAIgC,MAAM,cAAV,GAAA+B,OAA4BlD,EAAe+C,OAA3C,4CAxEmBhC,EAAAE,KAAA,GAAA,MAAA,KAAA,GA0BfjB,EAAAA,MAAAA,YATgB,8DAjBD,KAAA,GA6BfG,EAAAA,SAAAA,WA7BeY,EAAAE,KAAA,GAAA,MAAA,KAAA,GAAAF,EAAAC,KAAA,GAAAD,EAAAoC,GAAApC,EAAA,MAAA,GAgFrBqC,QAAQC,MAARtC,EAAAoC,IA/DsBhE,EAAAgC,MAAA,YAAA,uCAAAJ,EAAAoC,GAAAG,SAAAlE,EAAAiC,SAeL,qBAhCI,KAAA,GAAA,IAAA,MAAA,OAAAN,EAAAwC,SAAA,KAAA,KAAA,CAAA,CAAA,EAAA,QAiBC5E,OAAAa,IAAA,IAAA,SAAAL,EAAAC,GAAA,IAAAoE,EAAA,OAAA3C,mBAAAC,MAAA,SAAA2C,GAAA,OAAA,OAAAA,EAAAzC,KAAAyC,EAAAxC,MAAA,KAAA,EAAA,OAAAwC,EAAAzC,KAAA,EAAAyC,EAAAxC,KAAA,EAAAJ,mBAAAmC,MA8EDnE,aAAaQ,UA9EZ,KAAA,EA8EhBmE,EA9EgBC,EAAAC,KAsBZlD,EAAAA,OAAAA,qBAAWsB,CAAkB6B,MAAA,mBAAAC,KAAAJ,IAtBjBC,EAAAxC,KAAA,GAAA,MAAA,KAAA,EAAAwC,EAAAzC,KAAA,EAAAyC,EAAAN,GAAAM,EAAA,MAAA,GAoFtBtE,EAAIgC,MAAM,YAAa,6BA5DjB/B,EAAAiC,SAAMiB,oBAxBU,KAAA,GAAA,IAAA,MAAA,OAAAmB,EAAAF,SAAA,KAAA,KAAA,CAAA,CAAA,EAAA,OA6Bd9C,OAAAA,IAAAA,UAAYD,SAAOrB,EAACmB,GAARE,IAAAA,EAAAA,OAAAA,mBAAAA,MAAAA,SAAAA,GAAAA,OAAAA,OAAAA,EAAAA,KAAAA,EAAAA,MAAAA,KAAAA,EAAAA,OAAAA,EAAAA,KAAAA,EAAAA,EAAAA,KAAAA,EAAAA,mBAAAA,MA+DI1B,YAAYO,UA/DhBmB,KAAAA,EA+DdjB,EA/DciB,EAAAA,KA7BEpB,EAAAE,OAAA,sBAAA,CAAAqE,MAAA,qBAAApE,UAAAA,IA6BFiB,EAAAA,KAAAA,GAAAA,MAAAA,KAAAA,EAAAA,EAAAA,KAAAA,EAAAA,EAAAA,GAAAA,EAAAA,MAAAA,GAqEpBrB,EAAIgC,MAAM,YAAa,4BAjEbR,EAAAA,SAAAA,WAJUH,KAAAA,GAAAA,IAAAA,MAAAA,OAAAA,EAAAA,SAAAA,KAAAA,KAAAA,CAAAA,CAAAA,EAAAA,OA7BE7B,OAAAkF,KAAA,SAAA,SAAA1E,EAAAC,GAAA,IAAA0E,EAAApE,EAAA6C,EAAAG,EAAAE,EAAAC,EAAAkB,EAAA,OAAAlD,mBAAAC,MAAA,SAAAkD,GAAA,OAAA,OAAAA,EAAAhD,KAAAgD,EAAA/C,MAAA,KAAA,EAAA,OAAA+C,EAAAhD,KAAA,EAAA8C,EAAA3E,EAAA+B,KAAAxB,EAAAoE,EAAApE,SAAA6C,EAAAuB,EAAAvB,QAAAG,EAAAoB,EAAApB,UAAAE,EAAAkB,EAAAlB,YAAAC,EAAAiB,EAAAjB,YA2GhBkB,EAAa,CAAErE,SAAAA,EAAU6C,QAAAA,EAASG,UAAAA,EAAWE,YAAAA,EAAaC,YAAAA,GA3G1CmB,EAAA/C,KAAA,EAAAJ,mBAAAmC,MAuCVpC,aAAWqD,MAAAF,IAvCD,KAAA,EAwCdrE,EAAAA,MAAAA,cAAUA,qCACV6C,EAAAA,SAAAA,WAzCcyB,EAAA/C,KAAA,GAAA,MAAA,KAAA,EAAA+C,EAAAhD,KAAA,EAAAgD,EAAAb,GAAAa,EAAA,MAAA,GA2CdpB,EAAAA,MAAAA,YAAajC,2BAA2B8B,EAAAA,GAA3ByB,MACbrB,EAAAA,SAAAA,kBA5Cc,KAAA,GAAA,IAAA,MAAA,OAAAmB,EAAAT,SAAA,KAAA,KAAA,CAAA,CAAA,EAAA,OAAA5E,OAAAa,IAAA,YAAA,SAAAL,EAAAC,GAAA,IAAA+E,EAAAC,EAAAC,EAAAC,EAAA/E,EAAA,OAAAsB,mBAAAC,MAAA,SAAAyD,GAAA,OAAA,OAAAA,EAAAvD,KAAAuD,EAAAtD,MAAA,KAAA,EAAA,OAAAsD,EAAAvD,KAAA,EAAAmD,EAAAhF,EAAAqF,OAAAL,GAAAI,EAAAtD,KAAA,EAAAJ,mBAAAmC,MAAAyB,QAAAC,IAAA,CAAA7F,aAAA8F,QAAAR,GAAArF,YAAAO,YAAA,KAAA,EAAA,GAAA+E,EAAAG,EAAAb,KAAAW,EAAApC,eAAAmC,EAAA,GAeUE,EAfVD,EAAA,GAAA9E,EAAA8E,EAAA,GAqDJ,IArDIC,EAqDlBtE,OArDkB,OAAAb,EAAAgC,MAAA,YAAA,2BAAAoD,EAAAnD,OAAA,SAAAhC,EAAAiC,SAAA,YAAAkD,EAAAtD,KAAA,GAAA,MAAA,KAAA,GAAA7B,EAAAE,OAAA,oBAAA,CAAAqE,MAAA,cAsIpBH,OAAQc,EAAW,GAtIC/E,UAAAA,IAAAgF,EAAAtD,KAAA,GAAA,MAAA,KAAA,GAAAsD,EAAAvD,KAAA,GAAAuD,EAAApB,GAAAoB,EAAA,MAAA,GAAApF,EAAAgC,MAAA,YAAA,sBAAA/B,EAAAiC,SAAA,WAAA,KAAA,GAAA,IAAA,MAAA,OAAAkD,EAAAhB,SAAA,KAAA,KAAA,CAAA,CAAA,EAAA,QAAA5E,OAAAkF,KAAA,cAAA,SAAA1E,EAAAC,GAAA,IAAA+E,EAAAS,EAAAlF,EAAA6C,EAAAG,EAAAE,EAAAC,EAAAkB,EAAA,OAAAlD,mBAAAC,MAAA,SAAA+D,GAAA,OAAA,OAAAA,EAAA7D,KAAA6D,EAAA5D,MAAA,KAAA,EAAA,OA4DtB7B,EAAGD,EAACkC,OAAS8C,GA5DSU,EAAA7D,KAAA,EAAA4D,EAAAzF,EAAA+B,KAAAxB,EAAAkF,EAAAlF,SAAA6C,EAAAqC,EAAArC,QAAAG,EAAAkC,EAAAlC,UAAAE,EAAAgC,EAAAhC,YAAAC,EAAA+B,EAAA/B,YAoJhBkB,EAAa,CAAErE,SAAAA,EAAU6C,QAAAA,EAASG,UAAAA,EAAWE,YAAAA,EAAaC,YAAAA,GApJ1CgC,EAAA5D,KAAA,EAAAJ,mBAAAmC,MAAAnE,aAAAiG,OAAAX,EAAAJ,IAAA,KAAA,EAAA5E,EAAAgC,MAAA,cAAA,oCA+DtBiC,EAAAA,SAAO,WA/DeyB,EAAA5D,KAAA,GAAA,MAAA,KAAA,GAAA4D,EAAA7D,KAAA,GAAA6D,EAAA1B,GAAA0B,EAAA,MAAA,GAiEtBzF,EAAAA,MAAIiC,YAAS,6BAAbwD,EAAA1B,GAAAe,MA0FA9E,EAAIiC,SAAS,gBAAkB8C,GA3JT,KAAA,GAAA,IAAA,MAAA,OAAAU,EAAAtB,SAAA,KAAA,KAAA,CAAA,CAAA,EAAA,QAAA5E,OAAAkF,KAAA,qBAAA,SAAA1E,EAAAC,GAAA,IAAA2F,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAtE,mBAAAC,MAAA,SAAAsE,GAAA,OAAA,OAAAA,EAAApE,KAAAoE,EAAAnE,MAAA,KAAA,EAAA,OAAAmE,EAAApE,KAAA,EAAA+D,EAAA5F,EAAAqF,OAAAL,GAsE1Ba,EAAA7F,EAAA+B,KAAA8D,OAtE0BI,EAAAnE,KAAA,EAAAJ,mBAAAmC,MAuE1BjE,gBAAA4F,QAAAI,IAvE0B,KAAA,EAAA,GAuE1BE,EAvE0BG,EAAA1B,KAwE1BwB,EAAA5D,MAAAC,QAAA0D,GAAAA,EAAA,GAAAA,EAGA7B,QAAAiC,IAAA,+BAAAH,GACO1F,GAAS0F,EAAAC,UA5EU,CAAAC,EAAAnE,KAAA,GAAA,MAAA,OA4EVmC,QAAAiC,IAAA,wDAAAlG,EAAAgC,MAAA,YAAA,oDA5EUiE,EAAAhE,OAAA,SA4EVhC,EAAAiC,SAAA,eA5EU,KAAA,GAAA,OAAA+D,EAAAnE,KAAA,GAAAJ,mBAAAmC,MA4EVjE,gBAAA+F,OAAAC,EAAA,CAAAC,OAAAA,KA5EU,KAAA,GAAA,GA4EV5B,QAAAiC,IAAA,qBAAAnC,OAAA6B,EAAA,cAAA7B,OAES8B,IAAfxB,EAFM0B,EAAAC,UAGR7F,cAAJF,EA/EsB,OAgFpBuE,QAAAA,IAAAA,kBAAAA,OAAOwB,EAAPxB,cAhFoByB,EAAAnE,KAAA,GAAAJ,mBAAAmC,MAiFpBY,aAAMJ,OAAAA,EAAAA,CAAAA,YAAAA,YAjFc4B,EAAAnE,KAAA,GAAA,MAAA,KAAA,GAAAmE,EAAAnE,KAAA,GAAA,MAAA,KAAA,GAAA,GA4EV,YAAA+D,GAAA,UAAAA,EA5EU,OA4EV5B,QAAAiC,IAAA,kBAAAnC,OAAAiC,EAAA,cA5EUC,EAAAnE,KAAA,GAAAJ,mBAAAmC,MA0LdnE,aAAaiG,OAAOK,EAAW,CAAEtC,YAAa,YA1LhCuC,EAAAnE,KAAA,GAAA,MAAA,KAAA,GA4EV9B,EAAAgC,MAAA,cAAA,gDAAA+B,OAAA8B,IAQZ7F,EAAAA,SAAIgC,cApFkBiE,EAAAnE,KAAA,GAAA,MAAA,KAAA,GAAAmE,EAAApE,KAAA,GAAAoE,EAAAjC,GAAAiC,EAAA,MAAA,GA4EVhC,QAAAC,MAAA,qCAAA+B,EAAAjC,IAAAhE,EAAAgC,MAAA,YAAA,sCAAA/B,EAAAiC,SAAA,cA5EU,KAAA,GAAA,IAAA,MAAA,OAAA+D,EAAA7B,SAAA,KAAA,KAAA,CAAA,CAAA,EAAA,QAwM1B5E,OAAOa,IAAI,cAAe,SAAOL,EAAKC,GAAZ,OAAAyB,mBAAAC,MAAA,SAAAwE,GAAA,OAAA,OAAAA,EAAAtE,KAAAsE,EAAArE,MAAA,KAAA,EAAA,OAAAqE,EAAAtE,KAAA,EAAAsE,EAAArE,KAAA,EAAAJ,mBAAAmC,MA9GJnE,aAAA0G,OAAApG,EAAAqF,OAAAL,KA8GI,KAAA,EA9GJhF,EAAAgC,MAAA,cAAA,iCAAA/B,EAAAiC,SAAA,WA8GIiE,EAAArE,KAAA,GAAA,MAAA,KAAA,EAAAqE,EAAAtE,KAAA,EAAAsE,EAAAnC,GAAAmC,EAAA,MAAA,GA9GJnG,EAAAgC,MAAA,YAAA,2BAAAmE,EAAAnC,GAAAe,MAAA9E,EAAAiC,SAAA,WA8GI,KAAA,GAAA,IAAA,MAAA,OAAAiE,EAAA/B,SAAA,KAAA,KAAA,CAAA,CAAA,EAAA,OA9GJiC,OAAAC,QAAA9G","file":"jadwal.min.js","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst Model_Jadwal = require('../models/Model_Jadwal');\r\nconst Model_Arena = require('../models/Model_Arena'); \r\nconst Model_Reservasi = require('../models/Model_Reservasi');// <-- Ini sudah benar, dibutuhkan\r\nconst { isAuthenticated, isAdmin } = require('../middleware/authMiddleware');\r\n\r\n// Lindungi semua rute, hanya Admin\r\nrouter.use(isAuthenticated, isAdmin);\r\n\r\n// =============================================\r\n// RUTE BARU: Menampilkan Halaman Generator\r\n// (Ini adalah Langkah 3A)\r\n// =============================================\r\nrouter.get('/generator', async (req, res) => {\r\n  try {\r\n    const arenaList = await Model_Arena.getAll(); // Ambil daftar arena\r\n    res.render('admin/jadwal/generator', {\r\n      title: 'Generator Jadwal Massal',\r\n      arenaList: arenaList // Kirim ke EJS untuk dropdown\r\n    });\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal memuat data arena.');\r\n    res.redirect('/jadwal');\r\n  }\r\n});\r\n\r\n// =============================================\r\n// RUTE BARU: Memproses Logika \"Pabrik\"\r\n// (Ini adalah Langkah 3B)\r\n// =============================================\r\nrouter.post('/generator', async (req, res) => {\r\n  try {\r\n    const { id_arena, hari, jam_buka_operasi, jam_tutup_operasi, durasi_sesi, jumlah_minggu } = req.body;\r\n    \r\n    if (!hari) {\r\n      req.flash('error_msg', 'Anda harus memilih minimal satu hari.');\r\n      return res.redirect('/jadwal/generator');\r\n    }\r\n\r\n    const daftarSesiBaru = [];\r\n    const hariInput = Array.isArray(hari) ? hari : [hari];\r\n    const durasiMs = parseInt(durasi_sesi) * 60000; \r\n    const totalHari = parseInt(jumlah_minggu) * 7;\r\n    const namaHariJS = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];\r\n\r\n    for (let i = 0; i < totalHari; i++) {\r\n      let currentDate = new Date();\r\n      currentDate.setDate(currentDate.getDate() + i);\r\n      const namaHariIni = namaHariJS[currentDate.getDay()]; \r\n\r\n      if (hariInput.includes(namaHariIni)) {\r\n        \r\n        const setTime = (date, timeStr) => {\r\n          const [hours, minutes] = timeStr.split(':');\r\n          const newDate = new Date(date.getTime()); \r\n          newDate.setHours(hours, minutes, 0, 0);\r\n          return newDate;\r\n        };\r\n        \r\n        let sesiMulai = setTime(currentDate, jam_buka_operasi);\r\n        let jamTutupOperasi = setTime(currentDate, jam_tutup_operasi);\r\n\r\n        while (sesiMulai < jamTutupOperasi) {\r\n          let sesiSelesai = new Date(sesiMulai.getTime() + durasiMs);\r\n\r\n          if (sesiSelesai > jamTutupOperasi) {\r\n            break;\r\n          }\r\n\r\n          const dataSesi = {\r\n            id_arena: id_arena,\r\n            tanggal: sesiMulai.toISOString().slice(0, 10), \r\n            jam_mulai: sesiMulai.toTimeString().slice(0, 5), \r\n            jam_selesai: sesiSelesai.toTimeString().slice(0, 5), \r\n            status_slot: 'kosong'\r\n          };\r\n          \r\n          daftarSesiBaru.push(dataSesi);\r\n          sesiMulai = sesiSelesai;\r\n        }\r\n      }\r\n    }\r\n    \r\n    if (daftarSesiBaru.length > 0) {\r\n      await Model_Jadwal.StoreMany(daftarSesiBaru); // Memanggil fungsi dari Langkah 2\r\n      req.flash('success_msg', `${daftarSesiBaru.length} slot jadwal baru berhasil di-generate!`);\r\n    } else {\r\n      req.flash('error_msg', 'Tidak ada jadwal yang di-generate. Cek kembali input Anda.');\r\n    }\r\n    \r\n    res.redirect('/jadwal'); \r\n\r\n  } catch (err) {\r\n    console.error(err);\r\n    req.flash('error_msg', 'Terjadi error saat generate jadwal: ' + err.message);\r\n    res.redirect('/jadwal/generator');\r\n  }\r\n});\r\n\r\n\r\n// =============================================\r\n// RUTE-RUTE LAMA ANDA (CRUD MANUAL)\r\n// (Ini adalah kode yang Anda kirim - TIDAK DIHAPUS)\r\n// =============================================\r\n\r\n// GET: Tampilkan daftar jadwal\r\nrouter.get('/', async (req, res) => {\r\n  try {\r\n    const jadwal = await Model_Jadwal.getAll();\r\n    res.render('admin/jadwal/index', {\r\n      title: 'Manajemen Jadwal',\r\n      data: jadwal\r\n    });\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal memuat data jadwal.');\r\n    res.redirect('/admin/dashboard');\r\n  }\r\n});\r\n\r\n// GET: Form tambah jadwal\r\nrouter.get('/create', async (req, res) => {\r\n  try {\r\n    const arenaList = await Model_Arena.getAll(); // Ambil daftar arena\r\n    res.render('admin/jadwal/create', {\r\n      title: 'Tambah Jadwal Baru',\r\n      arenaList: arenaList // Kirim ke EJS\r\n    });\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal memuat data arena.');\r\n    res.redirect('/jadwal');\r\n  }\r\n});\r\n\r\n// POST: Simpan jadwal baru\r\nrouter.post('/store', async (req, res) => {\r\n  try {\r\n    const { id_arena, tanggal, jam_mulai, jam_selesai, status_slot } = req.body;\r\n    const dataJadwal = { id_arena, tanggal, jam_mulai, jam_selesai, status_slot };\r\n    \r\n    await Model_Jadwal.Store(dataJadwal);\r\n    req.flash('success_msg', 'Jadwal baru berhasil ditambahkan.');\r\n    res.redirect('/jadwal');\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal menyimpan jadwal: ' + err.code);\r\n    res.redirect('/jadwal/create');\r\n  }\r\n});\r\n\r\n// GET: Form edit jadwal\r\nrouter.get('/edit/:id', async (req, res) => {\r\n  try {\r\n    const id = req.params.id;\r\n    const [jadwalData, arenaList] = await Promise.all([\r\n      Model_Jadwal.getById(id),\r\n      Model_Arena.getAll()\r\n    ]);\r\n    \r\n    if (jadwalData.length === 0) {\r\n      req.flash('error_msg', 'Jadwal tidak ditemukan.');\r\n      return res.redirect('/jadwal');\r\n    }\r\n    \r\n    res.render('admin/jadwal/edit', {\r\n      title: 'Edit Jadwal',\r\n      jadwal: jadwalData[0], \r\n      arenaList: arenaList\r\n    });\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal memuat data.');\r\n    res.redirect('/jadwal');\r\n  }\r\n});\r\n\r\n// POST: Update jadwal\r\nrouter.post('/update/:id', async (req, res) => {\r\n  const id = req.params.id;\r\n  try {\r\n    const { id_arena, tanggal, jam_mulai, jam_selesai, status_slot } = req.body;\r\n    const dataJadwal = { id_arena, tanggal, jam_mulai, jam_selesai, status_slot };\r\n\r\n    await Model_Jadwal.Update(id, dataJadwal);\r\n    req.flash('success_msg', 'Data jadwal berhasil diperbarui.');\r\n    res.redirect('/jadwal');\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal memperbarui jadwal: ' + err.code);\r\n    res.redirect('/jadwal/edit/' + id);\r\n  }\r\n});\r\n\r\nrouter.post('/update-status/:id', async (req, res) => {\r\n  try {\r\n    const id_reservasi = req.params.id;\r\n    const { status } = req.body;\r\n    const reservasiData = await Model_Reservasi.getById(id_reservasi);\r\n    const reservasi = Array.isArray(reservasiData) ? reservasiData[0] : reservasiData;\r\n\r\n    console.log('[DEBUG] Reservasi Ditemukan:', reservasi);\r\n\r\n    if (!reservasi || !reservasi.id_jadwal) {\r\n      console.log('[DEBUG] Reservasi kosong atau tidak punya id_jadwal.');\r\n      req.flash('error_msg', 'Data reservasi tidak ditemukan atau tidak valid.');\r\n      return res.redirect('/reservasi');\r\n    }\r\n\r\n    // Update status reservasi\r\n    await Model_Reservasi.Update(id_reservasi, { status });\r\n    console.log(`[DEBUG] Reservasi ${id_reservasi} → status ${status}`);\r\n\r\n    // Sinkronisasi slot jadwal\r\n    const id_jadwal = reservasi.id_jadwal;\r\n    if (status === 'disetujui') {\r\n      console.log(`[DEBUG] Jadwal ${id_jadwal} → terisi`);\r\n      await Model_Jadwal.Update(id_jadwal, { status_slot: 'terisi' });\r\n\r\n    } else if (status === 'ditolak' || status === 'batal') {\r\n      console.log(`[DEBUG] Jadwal ${id_jadwal} → kosong`);\r\n      await Model_Jadwal.Update(id_jadwal, { status_slot: 'kosong' });\r\n    }\r\n\r\n    req.flash('success_msg', `Status reservasi berhasil diperbarui menjadi ${status}`);\r\n    res.redirect('/reservasi');\r\n\r\n  } catch (err) {\r\n    console.error('[DEBUG ERROR] Gagal update status:', err);\r\n    req.flash('error_msg', 'Gagal memperbarui status reservasi');\r\n    res.redirect('/reservasi');\r\n  }\r\n});\r\n\r\n// GET: Hapus jadwal\r\nrouter.get('/delete/:id', async (req, res) => {\r\n  try {\r\n    await Model_Jadwal.Delete(req.params.id);\r\n    req.flash('success_msg', 'Data jadwal berhasil dihapus.');\r\n    res.redirect('/jadwal');\r\n  } catch (err) {\r\n    req.flash('error_msg', 'Gagal menghapus jadwal: ' + err.code);\r\n    res.redirect('/jadwal');\r\n  }\r\n});\r\n\r\nmodule.exports = router;"]}