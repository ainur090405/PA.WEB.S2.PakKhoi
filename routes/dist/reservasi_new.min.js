"use strict";var express=require("express"),router=express.Router(),Model_Reservasi=require("../models/Model_Reservasi"),_require=require("../middleware/authMiddleware"),isAuthenticated=_require.isAuthenticated,isAdmin=_require.isAdmin;router.use(isAuthenticated,isAdmin),router.get("/",function(r,a){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(Model_Reservasi.getAll());case 3:t=e.sent,a.render("admin/reservasi/index",{title:"Manajemen Reservasi",data:t}),e.next=12;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0),r.flash("error_msg","Gagal memuat data reservasi."),a.redirect("/admin/dashboard");case 12:case"end":return e.stop()}},null,null,[[0,7]])}),router.get("/edit/:id",function(r,a){var t,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=r.params.id,e.next=4,regeneratorRuntime.awrap(Model_Reservasi.getById(t));case 4:if(0===(s=e.sent).length)return r.flash("error_msg","Reservasi tidak ditemukan."),e.abrupt("return",a.redirect("/reservasi"));e.next=8;break;case 8:a.render("admin/reservasi/edit",{title:"Update Status Reservasi",reservasi:s[0]}),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),r.flash("error_msg","Gagal memuat data reservasi."),a.redirect("/reservasi");case 15:case"end":return e.stop()}},null,null,[[0,11]])}),router.post("/update/:id",function(r,a){var t,s,n,i,u,c,o,d;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.params.id,e.prev=1,s=r.body,n=s.status,i=s.catatan,u={status:n,catatan:i},e.next=6,regeneratorRuntime.awrap(Model_Reservasi.Update(t,u));case 6:if("disetujui"===n||"selesai"===n)return c=require("../models/Model_Notifikasi_new"),e.next=10,regeneratorRuntime.awrap(Model_Reservasi.getById(t));e.next=15;break;case 10:if(0<(o=e.sent).length)return d={id_user:o[0].id_user,judul:"disetujui"===n?"Booking Disetujui":"Booking Selesai",pesan:"Booking Anda untuk arena ".concat(o[0].nama_arena," telah ").concat("disetujui"===n?"disetujui":"selesai","."),tipe:"booking",dibaca:0},e.next=15,regeneratorRuntime.awrap(c.Store(d));e.next=15;break;case 15:r.flash("success_msg","Status reservasi berhasil diperbarui."),a.redirect("/admin/reservasi"),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(1),r.flash("error_msg","Gagal memperbarui reservasi: "+e.t0.code),a.redirect("/admin/reservasi/edit/"+t);case 23:case"end":return e.stop()}},null,null,[[1,19]])}),router.get("/delete/:id",function(r,a){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(Model_Reservasi.Delete(r.params.id));case 3:r.flash("success_msg","Data reservasi berhasil dihapus."),a.redirect("/reservasi"),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),r.flash("error_msg","Gagal menghapus reservasi: "+e.t0.code),a.redirect("/reservasi");case 11:case"end":return e.stop()}},null,null,[[0,7]])}),router.get("/download",function(r,a){var t,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(Model_Reservasi.getAll());case 3:t=e.sent,s="ID,Pemesan,Arena,Tanggal Main,Jam,Tanggal Pesan,Status,Pembayaran,Jumlah\n",t.forEach(function(e){s+="".concat(e.id_reservasi,",").concat(e.nama_user,",").concat(e.nama_arena,",").concat(new Date(e.tanggal).toLocaleDateString("id-ID"),",").concat(e.jam_mulai.substring(0,5),",").concat(new Date(e.tanggal_pesan).toLocaleDateString("id-ID"),",").concat(e.status,",").concat(e.payment_method||"",",").concat(e.amount||0,"\n")}),a.header("Content-Type","text/csv"),a.attachment("reservasi.csv"),a.send(s),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0),r.flash("error_msg","Gagal mendownload data reservasi."),a.redirect("/reservasi");case 16:case"end":return e.stop()}},null,null,[[0,11]])}),module.exports=router;
//# sourceMappingURL=reservasi_new.min.js.map
